(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,o=window.lodash;var n=e.n(o);const i=window.wp.i18n,a=window.wp.plugins,r=window.wp.data,l=window.wp.editPost,d=window.wp.components,s=window.wp.mediaUtils,{PRC_PLATFORM_FLASH_BRIEFING_TOKEN:c}=window,w=c,u=({blockContent:e})=>(0,t.createElement)(d.PanelBody,{title:(0,i.__)("Alexa Preview","alexa-preview")},(0,t.createElement)(d.PanelRow,null,(0,i.__)('A preview of the audio generated for the Amazon Alexa "Flash Briefing" skill.',"alexa-preview")),(0,t.createElement)(d.PanelRow,null,(0,t.createElement)("audio",{id:"audio-el",controls:!0},(0,t.createElement)("source",{id:"audio-source",src:"",type:"audio/mpeg"}),"Your browser does not support the audio element.")),(0,t.createElement)(d.PanelRow,null,(0,t.createElement)(d.Button,{onClick:()=>{const t=wp.data.select("core/editor").getCurrentPostId();(async function(e,t){const o=await fetch("https://polly.pewresearch.io/speak?voice=Joanna",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});return await o.blob()})(0,{TEXT:`${e} For more, visit pew research dot org.`,SECURITY_TOKEN:w}).then((e=>{((e,t)=>{(new wp.api.collections.Media).fetch({data:{parent:t}}).then((o=>{o.length>0&&o.forEach((e=>{const t=new wp.api.models.Media({id:e.id});t.fetch(),t.destroy()})),(0,s.uploadMedia)({filesList:[new File([e],`$brief-${t}-${Date.now()}.mp3`,{type:"audio/mpeg"})],additionalData:{post:t,foo:"bar"},onFileChange:([e])=>{document.getElementById("audio-source").src=e.url,document.getElementById("audio-el").load()},onError:console.error})}))})(e,t)}))},className:"components-button is-button is-default is-large"},(0,i.__)("Retrieve preview audio","alexa-preview"))));(0,a.registerPlugin)("flash-briefing-preview",{icon:"media-audio",render:function(){const e=(0,r.useSelect)((e=>e("core/editor").getBlocks())).map((e=>n().unescape(e.attributes.content))).join(" ");return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.PluginSidebarMoreMenuItem,{target:"flash-briefing-preview-audio"},(0,i.__)("Flash Briefing Preview Audio","flash-briefing-preview-audio")),(0,t.createElement)(l.PluginSidebar,{name:"flash-briefing-preview-audio",title:(0,i.__)("Flash Briefing Preview Audio","flash-briefing")},(0,t.createElement)(u,{blockContent:e})))}})})();
//# sourceMappingURL=index.js.map