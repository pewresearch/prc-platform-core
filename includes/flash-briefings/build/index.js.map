{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@pewresearch/prc-platform-flash-briefings/webpack/bootstrap","webpack://@pewresearch/prc-platform-flash-briefings/webpack/runtime/compat get default export","webpack://@pewresearch/prc-platform-flash-briefings/webpack/runtime/define property getters","webpack://@pewresearch/prc-platform-flash-briefings/webpack/runtime/hasOwnProperty shorthand","webpack://@pewresearch/prc-platform-flash-briefings/external window \"React\"","webpack://@pewresearch/prc-platform-flash-briefings/external window \"lodash\"","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"i18n\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"plugins\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"data\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"editPost\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"components\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"mediaUtils\"]","webpack://@pewresearch/prc-platform-flash-briefings/./src/alexa-preview.jsx","webpack://@pewresearch/prc-platform-flash-briefings/./src/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"React\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"lodash\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"i18n\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"plugins\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"data\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"editPost\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"components\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"mediaUtils\"];","import { __ } from '@wordpress/i18n';\nimport { uploadMedia } from '@wordpress/media-utils';\nimport { PanelBody, PanelRow, Button } from '@wordpress/components';\n\nconst SECURITY_TOKEN = ''; // @TODO need to add this to env vars @benwormald\n\nconst addMedia = (content, postId) => {\n    const mediaCollection = new wp.api.collections.Media();\n    const fetched = mediaCollection\n        .fetch({ data: { parent: postId } })\n        .then((res) => {\n            if (res.length > 0) {\n                //delete results as model\n                res.forEach((mediaObj) => {\n                    let mediaModel = new wp.api.models.Media({\n                        id: mediaObj.id,\n                    });\n                    mediaModel.fetch();\n                    mediaModel.destroy();\n                });\n            }\n            uploadMedia({\n                filesList: [\n                    new File([content], `$brief-${postId}-${Date.now()}.mp3`, {\n                        type: 'audio/mpeg',\n                    }),\n                ],\n                additionalData: {\n                    post: postId,\n                    foo: 'bar',\n                },\n                onFileChange: ([fileObj]) => {\n                    document.getElementById('audio-source').src = fileObj.url;\n                    document.getElementById('audio-el').load();\n                },\n                onError: console.error,\n            });\n        });\n};\n\nasync function postData(url, data) {\n    const res = await fetch(url, {\n        method: 'POST',\n        headers: {\n            Accept: 'application/json',\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n    });\n    const content = await res.blob();\n    return content;\n}\n\nconst AlexaPreview = ({ blockContent }) => {\n    return (\n\t\t<PanelBody title={__('Alexa Preview', 'alexa-preview')}>\n\t\t\t<PanelRow>\n\t\t\t\t{__(\n\t\t\t\t\t'A preview of the audio generated for the Amazon Alexa \"Daily Briefing\" skill.',\n\t\t\t\t\t'alexa-preview',\n\t\t\t\t)}\n\t\t\t</PanelRow>\n\t\t\t<PanelRow>\n\t\t\t\t<audio id=\"audio-el\" controls>\n\t\t\t\t\t<source\n\t\t\t\t\t\tid=\"audio-source\"\n\t\t\t\t\t\tsrc=\"\"\n\t\t\t\t\t\ttype=\"audio/mpeg\"\n\t\t\t\t\t/>\n\t\t\t\t\tYour browser does not support the audio element.\n\t\t\t\t</audio>\n\t\t\t</PanelRow>\n\t\t\t<PanelRow>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tconst postId = wp.data\n\t\t\t\t\t\t\t.select('core/editor')\n\t\t\t\t\t\t\t.getCurrentPostId();\n\n\t\t\t\t\t\tpostData(\n\t\t\t\t\t\t\t'https://polly.pewresearch.io/speak?voice=Joanna',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tTEXT:\n\t\t\t\t\t\t\t\t\tblockContent +\n\t\t\t\t\t\t\t\t\t' For more, visit pew research dot org.',\n\t\t\t\t\t\t\t\tSECURITY_TOKEN,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t).then((data) => {\n\t\t\t\t\t\t\taddMedia(data, postId);\n\t\t\t\t\t\t});\n\t\t\t\t\t}}\n\t\t\t\t\tclassName=\"components-button is-button is-default is-large\"\n\t\t\t\t>\n\t\t\t\t\t{__('Retrieve preview audio', 'alexa-preview')}\n\t\t\t\t</Button>\n\t\t\t</PanelRow>\n\t\t</PanelBody>\n    );\n};\n\nexport default AlexaPreview;\n","\n/**\n * WordPress Dependencies\n */\nimport _ from 'lodash';\nimport { __ } from '@wordpress/i18n';\nimport { registerPlugin } from '@wordpress/plugins';\nimport { Fragment } from 'react';\nimport { useSelect } from '@wordpress/data';\nimport { PluginSidebar, PluginSidebarMoreMenuItem } from '@wordpress/edit-post';\nimport { PanelBody } from '@wordpress/components';\n\n/**\n * Internal Dependencies\n */\nimport AlexaPreview from './alexa-preview';\nimport PrePublishPlayer from './pre-publish-player';\n\nfunction FlashBriefingPreview() {\n\tconst blocks = useSelect((select) => select('core/editor').getBlocks());\n\tconst blockContent = blocks\n\t\t.map((block) => _.unescape(block.attributes.content))\n\t\t.join(' ');\n\n\treturn (\n\t\t<Fragment>\n\t\t\t <PluginSidebarMoreMenuItem target=\"flash-briefing-preview-audio\">\n                {__('Flash Briefing Preview Audio', 'flash-briefing-preview-audio')}\n            </PluginSidebarMoreMenuItem>\n            <PluginSidebar\n                name=\"flash-briefing-preview-audio\"\n                title={__('Flash Briefing Preview Audio', 'flash-briefing')}\n            >\n\t\t\t\t<AlexaPreview blockContent={blockContent} />\n\t\t\t\t{/* <PanelBody title=\"Siri\">Siri Goes Here</PanelBody>\n\t\t\t\t<PanelBody title=\"Google\">Google Goes Here</PanelBody> */}\n            </PluginSidebar>\n\t\t</Fragment>\n\t);\n}\n\nregisterPlugin('flash-briefing-preview', {\n    icon: 'media-audio',\n    render: FlashBriefingPreview,\n});\n\n// const PPPWraper = withSelect((select, ownProps) => {\n//     console.log(ownProps);\n//     return {\n//         media: ownProps.value ? select('core').getMedia(ownProps.value) : null,\n//     };\n// })(PrePublishPlayer);\n\n// registerPlugin('pre-publish-alexa-player', { render: PPPWraper });\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","window","AlexaPreview","blockContent","createElement","PanelBody","title","__","PanelRow","id","controls","src","type","Button","onClick","postId","wp","data","select","getCurrentPostId","async","url","res","fetch","method","headers","Accept","body","JSON","stringify","blob","postData","TEXT","SECURITY_TOKEN","then","addMedia","content","api","collections","Media","parent","length","forEach","mediaObj","mediaModel","models","destroy","uploadMedia","filesList","File","Date","now","additionalData","post","foo","onFileChange","fileObj","document","getElementById","load","onError","console","error","className","registerPlugin","icon","render","useSelect","getBlocks","map","block","_","attributes","join","Fragment","PluginSidebarMoreMenuItem","target","PluginSidebar","name"],"sourceRoot":""}