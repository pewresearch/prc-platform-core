{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@pewresearch/prc-platform-flash-briefings/webpack/bootstrap","webpack://@pewresearch/prc-platform-flash-briefings/webpack/runtime/compat get default export","webpack://@pewresearch/prc-platform-flash-briefings/webpack/runtime/define property getters","webpack://@pewresearch/prc-platform-flash-briefings/webpack/runtime/hasOwnProperty shorthand","webpack://@pewresearch/prc-platform-flash-briefings/external window \"React\"","webpack://@pewresearch/prc-platform-flash-briefings/external window \"lodash\"","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"i18n\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"plugins\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"data\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"editPost\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"components\"]","webpack://@pewresearch/prc-platform-flash-briefings/external window [\"wp\",\"mediaUtils\"]","webpack://@pewresearch/prc-platform-flash-briefings/./src/alexa-preview.jsx","webpack://@pewresearch/prc-platform-flash-briefings/./src/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"React\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"lodash\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"i18n\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"plugins\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"data\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"editPost\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"components\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"mediaUtils\"];","import { __ } from '@wordpress/i18n';\nimport { uploadMedia } from '@wordpress/media-utils';\nimport { PanelBody, PanelRow, Button } from '@wordpress/components';\n\nconst { PRC_PLATFORM_FLASH_BRIEFING_TOKEN } = window;\n\nconst SECURITY_TOKEN = PRC_PLATFORM_FLASH_BRIEFING_TOKEN;\n\nconst addMedia = (content, postId) => {\n\tconst mediaCollection = new wp.api.collections.Media();\n\tconst fetched = mediaCollection\n\t\t.fetch({ data: { parent: postId } })\n\t\t.then((res) => {\n\t\t\tif (res.length > 0) {\n\t\t\t\t// delete results as model\n\t\t\t\tres.forEach((mediaObj) => {\n\t\t\t\t\tconst mediaModel = new wp.api.models.Media({\n\t\t\t\t\t\tid: mediaObj.id,\n\t\t\t\t\t});\n\t\t\t\t\tmediaModel.fetch();\n\t\t\t\t\tmediaModel.destroy();\n\t\t\t\t});\n\t\t\t}\n\t\t\tuploadMedia({\n\t\t\t\tfilesList: [\n\t\t\t\t\tnew File([content], `$brief-${postId}-${Date.now()}.mp3`, {\n\t\t\t\t\t\ttype: 'audio/mpeg',\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tadditionalData: {\n\t\t\t\t\tpost: postId,\n\t\t\t\t\tfoo: 'bar',\n\t\t\t\t},\n\t\t\t\tonFileChange: ([fileObj]) => {\n\t\t\t\t\tdocument.getElementById('audio-source').src = fileObj.url;\n\t\t\t\t\tdocument.getElementById('audio-el').load();\n\t\t\t\t},\n\t\t\t\tonError: console.error,\n\t\t\t});\n\t\t});\n};\n\nasync function postData(url, data) {\n\tconst res = await fetch(url, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\tAccept: 'application/json',\n\t\t\t'Content-Type': 'application/json',\n\t\t},\n\t\tbody: JSON.stringify(data),\n\t});\n\tconst content = await res.blob();\n\treturn content;\n}\n\nconst AlexaPreview = ({ blockContent }) => {\n\treturn (\n\t\t<PanelBody title={__('Alexa Preview', 'alexa-preview')}>\n\t\t\t<PanelRow>\n\t\t\t\t{__(\n\t\t\t\t\t'A preview of the audio generated for the Amazon Alexa \"Flash Briefing\" skill.',\n\t\t\t\t\t'alexa-preview'\n\t\t\t\t)}\n\t\t\t</PanelRow>\n\t\t\t<PanelRow>\n\t\t\t\t<audio id=\"audio-el\" controls>\n\t\t\t\t\t<source id=\"audio-source\" src=\"\" type=\"audio/mpeg\" />\n\t\t\t\t\tYour browser does not support the audio element.\n\t\t\t\t</audio>\n\t\t\t</PanelRow>\n\t\t\t<PanelRow>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tconst postId = wp.data\n\t\t\t\t\t\t\t.select('core/editor')\n\t\t\t\t\t\t\t.getCurrentPostId();\n\n\t\t\t\t\t\tpostData(\n\t\t\t\t\t\t\t'https://polly.pewresearch.io/speak?voice=Joanna',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tTEXT: `${blockContent} For more, visit pew research dot org.`,\n\t\t\t\t\t\t\t\tSECURITY_TOKEN,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t).then((data) => {\n\t\t\t\t\t\t\taddMedia(data, postId);\n\t\t\t\t\t\t});\n\t\t\t\t\t}}\n\t\t\t\t\tclassName=\"components-button is-button is-default is-large\"\n\t\t\t\t>\n\t\t\t\t\t{__('Retrieve preview audio', 'alexa-preview')}\n\t\t\t\t</Button>\n\t\t\t</PanelRow>\n\t\t</PanelBody>\n\t);\n};\n\nexport default AlexaPreview;\n","\n/**\n * WordPress Dependencies\n */\nimport _ from 'lodash';\nimport { __ } from '@wordpress/i18n';\nimport { registerPlugin } from '@wordpress/plugins';\nimport { Fragment } from 'react';\nimport { useSelect } from '@wordpress/data';\nimport { PluginSidebar, PluginSidebarMoreMenuItem } from '@wordpress/edit-post';\nimport { PanelBody } from '@wordpress/components';\n\n/**\n * Internal Dependencies\n */\nimport AlexaPreview from './alexa-preview';\nimport PrePublishPlayer from './pre-publish-player';\n\nfunction FlashBriefingPreview() {\n\tconst blocks = useSelect((select) => select('core/editor').getBlocks());\n\tconst blockContent = blocks\n\t\t.map((block) => _.unescape(block.attributes.content))\n\t\t.join(' ');\n\n\treturn (\n\t\t<Fragment>\n\t\t\t <PluginSidebarMoreMenuItem target=\"flash-briefing-preview-audio\">\n                {__('Flash Briefing Preview Audio', 'flash-briefing-preview-audio')}\n            </PluginSidebarMoreMenuItem>\n            <PluginSidebar\n                name=\"flash-briefing-preview-audio\"\n                title={__('Flash Briefing Preview Audio', 'flash-briefing')}\n            >\n\t\t\t\t<AlexaPreview blockContent={blockContent} />\n\t\t\t\t{/* <PanelBody title=\"Siri\">Siri Goes Here</PanelBody>\n\t\t\t\t<PanelBody title=\"Google\">Google Goes Here</PanelBody> */}\n            </PluginSidebar>\n\t\t</Fragment>\n\t);\n}\n\nregisterPlugin('flash-briefing-preview', {\n    icon: 'media-audio',\n    render: FlashBriefingPreview,\n});\n\n// const PPPWraper = withSelect((select, ownProps) => {\n//     console.log(ownProps);\n//     return {\n//         media: ownProps.value ? select('core').getMedia(ownProps.value) : null,\n//     };\n// })(PrePublishPlayer);\n\n// registerPlugin('pre-publish-alexa-player', { render: PPPWraper });\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","window","PRC_PLATFORM_FLASH_BRIEFING_TOKEN","SECURITY_TOKEN","AlexaPreview","blockContent","createElement","PanelBody","title","__","PanelRow","id","controls","src","type","Button","onClick","postId","wp","data","select","getCurrentPostId","async","url","res","fetch","method","headers","Accept","body","JSON","stringify","blob","postData","TEXT","then","addMedia","content","api","collections","Media","parent","length","forEach","mediaObj","mediaModel","models","destroy","uploadMedia","filesList","File","Date","now","additionalData","post","foo","onFileChange","fileObj","document","getElementById","load","onError","console","error","className","registerPlugin","icon","render","useSelect","getBlocks","map","block","_","attributes","join","Fragment","PluginSidebarMoreMenuItem","target","PluginSidebar","name"],"sourceRoot":""}