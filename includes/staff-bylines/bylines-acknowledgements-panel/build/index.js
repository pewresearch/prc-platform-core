!function(){"use strict";var e,t={279:function(e,t,s){var i=window.wp.element,n=window.wp.plugins,o=window.wp.editPost,r=window.wp.i18n,l=window.wp.data,a=window.wp.coreData;const h=(0,i.createContext)();function d({children:e}){const t=(()=>{const{postType:e}=(0,l.useSelect)((e=>({postType:e("core/editor").getCurrentPostType()})),[]),{editPost:t}=(0,l.useDispatch)("core/editor"),[s,n]=(0,i.useState)([]),[o,r]=(0,i.useState)([]),[h,d]=(0,i.useState)(!1),[c,u]=(0,a.useEntityProp)("postType",e,"meta");if(void 0===c)return console.warn("Bylines will not work correctly until meta can be loaded, ensure this post type supports `custom-fields`."),{displayBylines:!1,bylineItems:[],acknowledgementItems:[],reorder:null,append:null,remove:null,updateItem:null,toggleBylinesDisplay:null};const{bylines:p,acknowledgements:m,displayBylines:f}=c;return(0,i.useEffect)((()=>{h||(console.log("initializing bylines...",c),n([...p]),Array.isArray(m)&&r([...m]),d(!0))}),[p,m,h]),(0,i.useEffect)((()=>{if(h){console.log("Meta Save",[s,o]);const e={bylines:s};Array.isArray(o)&&(e.acknowledgements=o),u(e);const i=[...s,...o].map((e=>e.termId));t({bylines:i})}}),[h,s,o]),{displayBylines:f,bylineItems:s,acknowledgementItems:o,reorder:(e,t,i=!0)=>{const l=i?[...s]:[...o],a=l[e];l.splice(e,1),l.splice(t,0,a),i?n(l):r(l)},append:(e,t,i=!0)=>{const l=i?[...s]:[...o];l.push({key:e,termId:t}),i?n(l):r(l)},remove:(e,t=!0)=>{const i=t?[...s]:[...o];i.splice(e,1),t?n(i):r(i)},updateItem:(e,t,i,l=!0)=>{const a=l?[...s]:[...o];a[e][t]=i,l?n(a):r(a)},toggleBylinesDisplay:()=>{u({displayBylines:!f})}}})();return(0,i.createElement)(h.Provider,{value:t},e)}var c=window.prcComponents,u=window.React,p=window.ReactDOM;function m(e){const t=window.getComputedStyle(e);return Math.max(parseInt(t["margin-top"],10),parseInt(t["margin-bottom"],10))+e.getBoundingClientRect().height}function f(e,t=0,s=0){e&&(null!==t&&null!==s?e.style.transform=`translate(${s}px, ${t}px)`:e.style.removeProperty("transform"))}function g(e,t,s){e&&(e.style.transition=`transform ${t}ms${s?` ${s}`:""}`)}const v=e=>{let t=[],s=null;const i=(...i)=>{t=i,s||(s=requestAnimationFrame((()=>{s=null,e(...t)})))};return i.cancel=()=>{s&&cancelAnimationFrame(s)},i};function w(e,t){const s=["input","textarea","select","option","optgroup","video","audio","button","a"],i=["button","link","checkbox","tab"];for(;e!==t;){if(e.getAttribute("data-movable-handle"))return!1;if(s.includes(e.tagName.toLowerCase()))return!0;const t=e.getAttribute("role");if(t&&i.includes(t.toLowerCase()))return!0;if("label"===e.tagName.toLowerCase()&&e.hasAttribute("for"))return!0;e.tagName&&(e=e.parentElement)}return!1}const y=200;class O extends u.Component{constructor(e){super(e),this.listRef=u.createRef(),this.ghostRef=u.createRef(),this.topOffsets=[],this.itemTranslateOffsets=[],this.initialYOffset=0,this.lastScroll=0,this.lastYOffset=0,this.lastListYOffset=0,this.needle=-1,this.afterIndex=-2,this.state={itemDragged:-1,itemDraggedOutOfBounds:-1,selectedItem:-1,initialX:0,initialY:0,targetX:0,targetY:0,targetHeight:0,targetWidth:0,liveText:"",scrollingSpeed:0,scrollWindow:!1},this.doScrolling=()=>{const{scrollingSpeed:e,scrollWindow:t}=this.state,s=this.listRef.current;window.requestAnimationFrame((()=>{t?window.scrollTo(window.pageXOffset,window.pageYOffset+1.5*e):s.scrollTop+=e,0!==e&&this.doScrolling()}))},this.getChildren=()=>this.listRef&&this.listRef.current?Array.from(this.listRef.current.children):(console.warn("No items found in the List container. Did you forget to pass & spread the `props` param in renderList?"),[]),this.calculateOffsets=()=>{this.topOffsets=this.getChildren().map((e=>e.getBoundingClientRect().top)),this.itemTranslateOffsets=this.getChildren().map((e=>m(e)))},this.getTargetIndex=e=>this.getChildren().findIndex((t=>t===e.target||t.contains(e.target))),this.onMouseOrTouchStart=e=>{this.dropTimeout&&this.state.itemDragged>-1&&(window.clearTimeout(this.dropTimeout),this.finishDrop());const t=(s=e).touches&&s.touches.length||s.changedTouches&&s.changedTouches.length;var s;if(!t&&0!==e.button)return;const i=this.getTargetIndex(e);if(-1===i||this.props.values[i]&&this.props.values[i].disabled)return void(-1!==this.state.selectedItem&&(this.setState({selectedItem:-1}),this.finishDrop()));const n=this.getChildren()[i],o=n.querySelector("[data-movable-handle]");if((!o||o.contains(e.target))&&!w(e.target,n)){if(e.preventDefault(),this.props.beforeDrag&&this.props.beforeDrag({elements:this.getChildren(),index:i}),t){const e={passive:!1};n.style.touchAction="none",document.addEventListener("touchend",this.schdOnEnd,e),document.addEventListener("touchmove",this.schdOnTouchMove,e),document.addEventListener("touchcancel",this.schdOnEnd,e)}else{document.addEventListener("mousemove",this.schdOnMouseMove),document.addEventListener("mouseup",this.schdOnEnd);const e=this.getChildren()[this.state.itemDragged];e&&e.style&&(e.style.touchAction="")}this.onStart(n,t?e.touches[0].clientX:e.clientX,t?e.touches[0].clientY:e.clientY,i)}},this.getYOffset=()=>{const e=this.listRef.current?this.listRef.current.scrollTop:0;return window.pageYOffset+e},this.onStart=(e,t,s,i)=>{this.state.selectedItem>-1&&(this.setState({selectedItem:-1}),this.needle=-1);const n=e.getBoundingClientRect(),o=window.getComputedStyle(e);this.calculateOffsets(),this.initialYOffset=this.getYOffset(),this.lastYOffset=window.pageYOffset,this.lastListYOffset=this.listRef.current.scrollTop,this.setState({itemDragged:i,targetX:n.left-parseInt(o["margin-left"],10),targetY:n.top-parseInt(o["margin-top"],10),targetHeight:n.height,targetWidth:n.width,initialX:t,initialY:s})},this.onMouseMove=e=>{e.cancelable&&e.preventDefault(),this.onMove(e.clientX,e.clientY)},this.onTouchMove=e=>{e.cancelable&&e.preventDefault(),this.onMove(e.touches[0].clientX,e.touches[0].clientY)},this.onWheel=e=>{this.state.itemDragged<0||(this.lastScroll=this.listRef.current.scrollTop+=e.deltaY,this.moveOtherItems())},this.onMove=(e,t)=>{if(-1===this.state.itemDragged)return null;f(this.ghostRef.current,t-this.state.initialY,this.props.lockVertically?0:e-this.state.initialX),this.autoScrolling(t),this.moveOtherItems()},this.moveOtherItems=()=>{const e=this.ghostRef.current.getBoundingClientRect(),t=e.top+e.height/2,s=m(this.getChildren()[this.state.itemDragged]),i=this.getYOffset();this.initialYOffset!==i&&(this.topOffsets=this.topOffsets.map((e=>e-(i-this.initialYOffset))),this.initialYOffset=i),this.isDraggedItemOutOfBounds()&&this.props.removableByMove?this.afterIndex=this.topOffsets.length+1:this.afterIndex=function(e,t){let s,i=0,n=e.length-1;for(;i<=n;){if(s=Math.floor((n+i)/2),!e[s+1]||e[s]<=t&&e[s+1]>=t)return s;e[s]<t&&e[s+1]<t?i=s+1:n=s-1}return-1}(this.topOffsets,t),this.animateItems(-1===this.afterIndex?0:this.afterIndex,this.state.itemDragged,s)},this.autoScrolling=e=>{const{top:t,bottom:s,height:i}=this.listRef.current.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight;if(s>n&&n-e<y)this.setState({scrollingSpeed:Math.round((y-(n-e))/10),scrollWindow:!0});else if(t<0&&e<y)this.setState({scrollingSpeed:Math.round((y-e)/-10),scrollWindow:!0});else if(this.state.scrollWindow&&0!==this.state.scrollingSpeed&&this.setState({scrollingSpeed:0,scrollWindow:!1}),i+20<this.listRef.current.scrollHeight){let i=0;e-t<y?i=Math.round((y-(e-t))/-10):s-e<y&&(i=Math.round((y-(s-e))/10)),this.state.scrollingSpeed!==i&&this.setState({scrollingSpeed:i})}},this.animateItems=(e,t,s,i=!1)=>{this.getChildren().forEach(((n,o)=>{if(g(n,this.props.transitionDuration),t===o&&i){if(t===e)return f(n,null);f(n,t<e?this.itemTranslateOffsets.slice(t+1,e+1).reduce(((e,t)=>e+t),0):-1*this.itemTranslateOffsets.slice(e,t).reduce(((e,t)=>e+t),0))}else f(n,t<e&&o>t&&o<=e?-s:o<t&&t>e&&o>=e?s:null)}))},this.isDraggedItemOutOfBounds=()=>{const e=this.getChildren()[this.state.itemDragged].getBoundingClientRect(),t=this.ghostRef.current.getBoundingClientRect();return Math.abs(e.left-t.left)>t.width?(-1===this.state.itemDraggedOutOfBounds&&this.setState({itemDraggedOutOfBounds:this.state.itemDragged}),!0):(this.state.itemDraggedOutOfBounds>-1&&this.setState({itemDraggedOutOfBounds:-1}),!1)},this.onEnd=e=>{e.cancelable&&e.preventDefault(),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchup",this.schdOnEnd),document.removeEventListener("touchcancel",this.schdOnEnd);const t=this.props.removableByMove&&this.isDraggedItemOutOfBounds();!t&&this.props.transitionDuration>0&&-2!==this.afterIndex&&v((()=>{g(this.ghostRef.current,this.props.transitionDuration,"cubic-bezier(.2,1,.1,1)"),this.afterIndex<1&&0===this.state.itemDragged?f(this.ghostRef.current,0,0):f(this.ghostRef.current,-(window.pageYOffset-this.lastYOffset)-(this.listRef.current.scrollTop-this.lastListYOffset)+(this.state.itemDragged<this.afterIndex?this.itemTranslateOffsets.slice(this.state.itemDragged+1,this.afterIndex+1).reduce(((e,t)=>e+t),0):-1*this.itemTranslateOffsets.slice(this.afterIndex<0?0:this.afterIndex,this.state.itemDragged).reduce(((e,t)=>e+t),0)),0)}))(),this.dropTimeout=window.setTimeout(this.finishDrop,t||-2===this.afterIndex?0:this.props.transitionDuration)},this.finishDrop=()=>{const e=this.props.removableByMove&&this.isDraggedItemOutOfBounds();(e||this.afterIndex>-2&&this.state.itemDragged!==this.afterIndex)&&this.props.onChange({oldIndex:this.state.itemDragged,newIndex:e?-1:Math.max(this.afterIndex,0),targetRect:this.ghostRef.current.getBoundingClientRect()}),this.getChildren().forEach((e=>{g(e,0),f(e,null),e.style.touchAction=""})),this.setState({itemDragged:-1,scrollingSpeed:0}),this.afterIndex=-2,this.lastScroll>0&&(this.listRef.current.scrollTop=this.lastScroll,this.lastScroll=0)},this.onKeyDown=e=>{const t=this.state.selectedItem,s=this.getTargetIndex(e);if(!w(e.target,e.currentTarget)&&-1!==s){if(" "===e.key&&(e.preventDefault(),t===s?(t!==this.needle&&(this.getChildren().forEach((e=>{g(e,0),f(e,null)})),this.props.onChange({oldIndex:t,newIndex:this.needle,targetRect:this.getChildren()[this.needle].getBoundingClientRect()}),this.getChildren()[this.needle].focus()),this.setState({selectedItem:-1,liveText:this.props.voiceover.dropped(t+1,this.needle+1)}),this.needle=-1):(this.setState({selectedItem:s,liveText:this.props.voiceover.lifted(s+1)}),this.needle=s,this.calculateOffsets())),("ArrowDown"===e.key||"j"===e.key)&&t>-1&&this.needle<this.props.values.length-1){e.preventDefault();const s=m(this.getChildren()[t]);this.needle++,this.animateItems(this.needle,t,s,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!1)})}if(("ArrowUp"===e.key||"k"===e.key)&&t>-1&&this.needle>0){e.preventDefault();const s=m(this.getChildren()[t]);this.needle--,this.animateItems(this.needle,t,s,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!0)})}"Escape"===e.key&&t>-1&&(this.getChildren().forEach((e=>{g(e,0),f(e,null)})),this.setState({selectedItem:-1,liveText:this.props.voiceover.canceled(t+1)}),this.needle=-1),("Tab"===e.key||"Enter"===e.key)&&t>-1&&e.preventDefault()}},this.schdOnMouseMove=v(this.onMouseMove),this.schdOnTouchMove=v(this.onTouchMove),this.schdOnEnd=v(this.onEnd)}componentDidMount(){this.calculateOffsets(),document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1,capture:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart)}componentDidUpdate(e,t){t.scrollingSpeed!==this.state.scrollingSpeed&&0===t.scrollingSpeed&&this.doScrolling()}componentWillUnmount(){document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mousedown",this.onMouseOrTouchStart),this.dropTimeout&&window.clearTimeout(this.dropTimeout),this.schdOnMouseMove.cancel(),this.schdOnTouchMove.cancel(),this.schdOnEnd.cancel()}render(){const e={userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",boxSizing:"border-box",position:"relative"},t={...e,top:this.state.targetY,left:this.state.targetX,width:this.state.targetWidth,height:this.state.targetHeight,position:"fixed",marginTop:0};return u.createElement(u.Fragment,null,this.props.renderList({children:this.props.values.map(((t,s)=>{const i=s===this.state.itemDragged,n=s===this.state.selectedItem,o={key:s,tabIndex:this.props.values[s]&&this.props.values[s].disabled?-1:0,"aria-roledescription":this.props.voiceover.item(s+1),onKeyDown:this.onKeyDown,style:{...e,visibility:i?"hidden":void 0,zIndex:n?5e3:0}};return this.props.renderItem({value:t,props:o,index:s,isDragged:!1,isSelected:n,isOutOfBounds:!1})})),isDragged:this.state.itemDragged>-1,props:{ref:this.listRef}}),this.state.itemDragged>-1&&p.createPortal(this.props.renderItem({value:this.props.values[this.state.itemDragged],props:{ref:this.ghostRef,style:t,onWheel:this.onWheel},index:this.state.itemDragged,isDragged:!0,isSelected:!1,isOutOfBounds:this.state.itemDraggedOutOfBounds>-1}),this.props.container||document.body),u.createElement("div",{"aria-live":"assertive",role:"log","aria-atomic":"true",style:{position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0px",padding:"0px",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"}},this.state.liveText))}}O.defaultProps={transitionDuration:300,lockVertically:!1,removableByMove:!1,voiceover:{item:e=>`You are currently at a draggable item at position ${e}. Press space bar to lift.`,lifted:e=>`You have lifted item at position ${e}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,moved:(e,t)=>`You have moved the lifted item ${t?"up":"down"} to position ${e}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,dropped:(e,t)=>`You have dropped the item. It has moved from position ${e} to ${t}.`,canceled:e=>`You have cancelled the movement. The item has returned to its starting position of ${e}.`}};var I=O,b=window.wp.components;window.wp.blockEditor;var x=window.wp.primitives,E=(0,i.createElement)(x.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,i.createElement)(x.Path,{d:"M8 7h2V5H8v2zm0 6h2v-2H8v2zm0 6h2v-2H8v2zm6-14v2h2V5h-2zm0 8h2v-2h-2v2zm0 6h2v-2h-2v2z"})),D=window.wp.apiFetch,S=s.n(D);window.prcBylineTermIds=window.prcBylineTermIds||[];var T=function({value:e,onRemove:t,lastItem:s=!1}){const{termId:n}=e,[o,l]=(0,i.useState)(.5<Math.random()?"John Doe":"Jane Doe"),[a,h]=(0,i.useState)(.5<Math.random()?"Research Assistant":"Senior Researcher"),[d,c]=(0,i.useState)(!0);return(0,i.useEffect)((()=>{if(!1===n)return void c(!1);const e=window.prcBylineTermIds,t=e.find((e=>e.termId===n));t?(l(t.name),h(t.jobTitle)):S()({path:`/wp/v2/bylines/${n}`}).then((t=>{const{staffName:s,staffJobTitle:i}=t.staffInfo;l(s),h(i),e.find((e=>e.termId===n))||window.prcBylineTermIds.push({termId:n,name:s,jobTitle:i})}))}),[n]),(0,i.useEffect)((()=>{["John Doe","Jane Doe"].includes(o)||c(!1)}),[o]),(0,i.createElement)("div",{className:"prc-byline-item",style:{background:"white",paddingBottom:"0.5em",marginBottom:"0.5em",borderBottom:s?"none":"1px solid #EAEAEA"}},(0,i.createElement)("div",{style:{display:"flex",flexDirection:"row",width:"100%",alignItems:"center"}},(0,i.createElement)("div",{style:{display:"flex",cursor:"grab"}},(0,i.createElement)(b.Icon,{icon:E,size:20})),(0,i.createElement)("div",{style:{display:"flex",flexGrow:"1",paddingLeft:"1em",cursor:"grab"}},d?(0,i.createElement)("div",{style:{display:"flex",alignItems:"center"}},(0,i.createElement)(b.Spinner,null)," ",(0,i.createElement)("span",null,"Loading...")):(0,i.createElement)("span",null,(0,i.createElement)("strong",null,(0,r.__)(`${o}`)),0<a.length&&(0,i.createElement)("span",{style:{display:"block",fontSize:"0.8em",color:"#666"}},(0,r.__)(`${a}`)))),(0,i.createElement)("div",{style:{display:"flex"}},(0,i.createElement)(b.IconButton,{icon:"no-alt",onClick:()=>{t();const e=window.prcBylineTermIds.findIndex((e=>e.termId===n));-1<e&&window.prcBylineTermIds.splice(e,1)},size:20}))),!1===n&&(0,i.createElement)("p",{style:{color:"red"}},"Term not found"))},B=function(){const{bylineItems:e,reorder:t,remove:s,append:n,displayBylines:o,toggleBylinesDisplay:r}=(0,i.useContext)(h);return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(b.PanelRow,null,(0,i.createElement)(c.WPEntitySearch,{placeholder:"Add new byline...",entityType:"taxonomy",entitySubType:"bylines",onSelect:e=>{n(`_${Math.random().toString(36).substr(2,9)}`,e.id,!0)}},(0,i.createElement)("div",{style:{width:"100%",paddingTop:"1em"}},(0,i.createElement)(I,{lockVertically:!0,values:e,onChange:({oldIndex:e,newIndex:s})=>t(e,s),renderList:({children:e,props:t})=>(0,i.createElement)("div",{...t},e),renderItem:({value:t,props:n,index:o})=>(0,i.createElement)("div",{...n},(0,i.createElement)(T,{key:t.key,value:t,onRemove:()=>{s(o,!0)},lastItem:o===e.length-1}))})))),(0,i.createElement)(b.PanelRow,null,(0,i.createElement)("label",null,"Display Bylines"),(0,i.createElement)(b.FormToggle,{checked:o,onChange:()=>{r()}})))};(0,l.dispatch)("core/edit-post").removeEditorPanel("taxonomy-panel-bylines"),(0,n.registerPlugin)("prc-bylines",{render:function(){return(0,i.createElement)(o.PluginDocumentSettingPanel,{name:"prc-bylines",title:(0,r.__)("Bylines")},(0,i.createElement)(d,null,(0,i.createElement)(B,null)))},icon:null})}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.m=t,e=[],i.O=function(t,s,n,o){if(!s){var r=1/0;for(d=0;d<e.length;d++){s=e[d][0],n=e[d][1],o=e[d][2];for(var l=!0,a=0;a<s.length;a++)(!1&o||r>=o)&&Object.keys(i.O).every((function(e){return i.O[e](s[a])}))?s.splice(a--,1):(l=!1,o<r&&(r=o));if(l){e.splice(d--,1);var h=n();void 0!==h&&(t=h)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,n,o]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={826:0,431:0};i.O.j=function(t){return 0===e[t]};var t=function(t,s){var n,o,r=s[0],l=s[1],a=s[2],h=0;if(r.some((function(t){return 0!==e[t]}))){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(a)var d=a(i)}for(t&&t(s);h<r.length;h++)o=r[h],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},s=self.webpackChunk_pewresearch_prc_platform_bylines_acknowledgement_panel=self.webpackChunk_pewresearch_prc_platform_bylines_acknowledgement_panel||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var n=i.O(void 0,[431],(function(){return i(279)}));n=i.O(n)}();
//# sourceMappingURL=index.js.map