(function(){function i(e,n,r){this.svg=t.select(e).append("svg").attr("width",r||e.offsetWidth).attr("class","datamap").attr("height",n||e.offsetHeight).style("overflow","hidden");return this.svg}function s(e,n){var r=n.width||e.offsetWidth;var i=n.height||e.offsetHeight;var s,o;var u=this.svg;if(n&&typeof n.scope==="undefined"){n.scope="world"}if(n.scope==="usa"){s=t.geo.albersUsa().scale(r).translate([r/2,i/2])}else if(n.scope==="world"){s=t.geo[n.projection]().scale((r+1)/2/Math.PI).translate([r/2,i/(n.projection==="mercator"?1.45:1.8)])}if(n.projection==="orthographic"){u.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",o);u.append("use").attr("class","stroke").attr("xlink:href","#sphere");u.append("use").attr("class","fill").attr("xlink:href","#sphere");s.scale(250).clipAngle(90).rotate(n.projectionConfig.rotation)}o=t.geo.path().projection(s);return{path:o,projection:s}}function o(){if(t.select(".datamaps-style-block").empty()){t.select("head").append("style").attr("class","datamaps-style-block").html('.datamap path.datamaps-graticule { fill: none; stroke: #777; stroke-width: 0.5px; stroke-opacity: .5; pointer-events: none; } .datamap .labels {pointer-events: none;} .datamap path {stroke: #FFFFFF; stroke-width: 1px;} .datamaps-legend dt, .datamaps-legend dd { float: left; margin: 0 3px 0 0;} .datamaps-legend dd {width: 20px; margin-right: 6px; border-radius: 3px;} .datamaps-legend {padding-bottom: 20px; z-index: 1001; position: absolute; left: 4px; font-size: 12px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;} .datamaps-hoverover {display: none; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; } .hoverinfo {padding: 4px; border-radius: 1px; background-color: #FFF; box-shadow: 1px 1px 5px #CCC; font-size: 12px; border: 1px solid #CCC; } .hoverinfo hr {border:1px dotted #CCC; }')}}function u(e){var t=this.options.fills,r=this.options.data||{},i=this.options.geographyConfig;var s=this.svg.select("g.datamaps-subunits");if(s.empty()){s=this.addLayer("datamaps-subunits",null,true)}var o=n.feature(e,e.objects[this.options.scope]).features;if(i.hideAntarctica){o=o.filter(function(e){return e.id!=="ATA"})}var u=s.selectAll("path.datamaps-subunit").data(o);u.enter().append("path").attr("d",this.path).attr("class",function(e){return"datamaps-subunit "+e.id}).attr("data-info",function(e){return JSON.stringify(r[e.id])}).style("fill",function(e){var n;if(r[e.id]){n=t[r[e.id].fillKey]}return n||t.defaultFill}).style("stroke-width",i.borderWidth).style("stroke",i.borderColor)}function a(){function s(){this.parentNode.appendChild(this)}var e;var n=this.svg;var r=this;var i=this.options.geographyConfig;if(i.highlightOnHover||i.popupOnHover){n.selectAll(".datamaps-subunit").on("mouseover",function(e){var o=t.select(this);if(i.highlightOnHover){var u={fill:o.style("fill"),stroke:o.style("stroke"),"stroke-width":o.style("stroke-width"),"fill-opacity":o.style("fill-opacity")};o.style("fill",i.highlightFillColor).style("stroke",i.highlightBorderColor).style("stroke-width",i.highlightBorderWidth).style("fill-opacity",i.highlightFillOpacity).attr("data-previousAttributes",JSON.stringify(u));if(!/((MSIE)|(Trident))/.test){s.call(this)}}if(i.popupOnHover){r.updatePopup(o,e,i,n)}}).on("mouseout",function(){var e=t.select(this);if(i.highlightOnHover){var n=JSON.parse(e.attr("data-previousAttributes"));for(var r in n){e.style(r,n[r])}}e.on("mousemove",null);t.selectAll(".datamaps-hoverover").style("display","none")})}}function f(e,n,r){n=n||{};if(!this.options.fills){return}var i="<dl>";var s="";if(n.legendTitle){i="<h2>"+n.legendTitle+"</h2>"+i}for(var o in this.options.fills){if(o==="defaultFill"){if(!n.defaultFillName){continue}s=n.defaultFillName}else{if(n.labels&&n.labels[o]){s=n.labels[o]}else{s=o+": "}}i+="<dt>"+s+"</dt>";i+='<dd style="background-color:'+this.options.fills[o]+'">&nbsp;</dd>'}i+="</dl>";var u=t.select(this.options.element).append("div").attr("class","datamaps-legend").html(i)}function l(e,n){var r=t.geo.graticule();this.svg.insert("path",".datamaps-subunits").datum(r).attr("class","datamaps-graticule").attr("d",this.path)}function c(e,t,n){var i=this,s=this.svg;if(!t||t&&!t.slice){throw"Datamaps Error - arcs must be an array"}if(typeof n==="undefined"){n=r.arcConfig}var o=e.selectAll("path.datamaps-arc").data(t,JSON.stringify);o.enter().append("svg:path").attr("class","datamaps-arc").style("stroke-linecap","round").style("stroke",function(e){if(e.options&&e.options.strokeColor){return e.options.strokeColor}return n.strokeColor}).style("fill","none").style("stroke-width",function(e){if(e.options&&e.options.strokeWidth){return e.options.strokeWidth}return n.strokeWidth}).attr("d",function(e){var t=i.latLngToXY(e.origin.latitude,e.origin.longitude);var r=i.latLngToXY(e.destination.latitude,e.destination.longitude);var s=[(t[0]+r[0])/2,(t[1]+r[1])/2];return"M"+t[0]+","+t[1]+"S"+(s[0]+50*n.arcSharpness)+","+(s[1]-75*n.arcSharpness)+","+r[0]+","+r[1]}).transition().delay(100).style("fill",function(){var e=this.getTotalLength();this.style.transition=this.style.WebkitTransition="none";this.style.strokeDasharray=e+" "+e;this.style.strokeDashoffset=e;this.getBoundingClientRect();this.style.transition=this.style.WebkitTransition="stroke-dashoffset "+n.animationSpeed+"ms ease-out";this.style.strokeDashoffset="0";return"none"});o.exit().transition().style("opacity",0).remove()}function h(e,t){var n=this;t=t||{};var r=this.projection([-67.707617,42.722131]);this.svg.selectAll(".datamaps-subunit").attr("data-foo",function(i){var s=n.path.centroid(i);var o=7.5,u=5;if(["FL","KY","MI"].indexOf(i.id)>-1)o=-2.5;if(i.id==="NY")o=-1;if(i.id==="MI")u=18;if(i.id==="LA")o=13;var a,f;a=s[0]-o;f=s[1]+u;var l=["VT","NH","MA","RI","CT","NJ","DE","MD","DC"].indexOf(i.id);if(l>-1){var c=r[1];a=r[0];f=c+l*(2+(t.fontSize||12));e.append("line").attr("x1",a-3).attr("y1",f-5).attr("x2",s[0]).attr("y2",s[1]).style("stroke",t.labelColor||"#000").style("stroke-width",t.lineWidth||1)}e.append("text").attr("x",a).attr("y",f).style("font-size",(t.fontSize||10)+"px").style("font-family",t.fontFamily||"Verdana").style("fill",t.labelColor||"#000").text(i.id);return"bar"})}function p(e,n,r){function a(e){return typeof e!=="undefined"&&typeof e.latitude!=="undefined"&&typeof e.longitude!=="undefined"}var i=this,s=this.options.fills,o=this.svg;if(!n||n&&!n.slice){throw"Datamaps Error - bubbles must be an array"}var u=e.selectAll("circle.datamaps-bubble").data(n,JSON.stringify);u.enter().append("svg:circle").attr("class","datamaps-bubble").attr("cx",function(e){var t;if(a(e)){t=i.latLngToXY(e.latitude,e.longitude)}else if(e.centered){t=i.path.centroid(o.select("path."+e.centered).data()[0])}if(t)return t[0]}).attr("cy",function(e){var t;if(a(e)){t=i.latLngToXY(e.latitude,e.longitude)}else if(e.centered){t=i.path.centroid(o.select("path."+e.centered).data()[0])}if(t)return t[1];}).attr("r",0).attr("data-info",function(e){return JSON.stringify(e)}).style("stroke",function(e){return typeof e.borderColor!=="undefined"?e.borderColor:r.borderColor}).style("stroke-width",function(e){return typeof e.borderWidth!=="undefined"?e.borderWidth:r.borderWidth}).style("fill-opacity",function(e){return typeof e.fillOpacity!=="undefined"?e.fillOpacity:r.fillOpacity}).style("fill",function(e){var t=s[e.fillKey];return t||s.defaultFill}).on("mouseover",function(e){var n=t.select(this);if(r.highlightOnHover){var s={fill:n.style("fill"),stroke:n.style("stroke"),"stroke-width":n.style("stroke-width"),"fill-opacity":n.style("fill-opacity")};n.style("fill",r.highlightFillColor).style("stroke",r.highlightBorderColor).style("stroke-width",r.highlightBorderWidth).style("fill-opacity",r.highlightFillOpacity).attr("data-previousAttributes",JSON.stringify(s))}if(r.popupOnHover){i.updatePopup(n,e,r,o)}}).on("mouseout",function(e){var n=t.select(this);if(r.highlightOnHover){var i=JSON.parse(n.attr("data-previousAttributes"));for(var s in i){n.style(s,i[s])}}t.selectAll(".datamaps-hoverover").style("display","none")}).transition().duration(400).attr("r",function(e){return e.radius});u.exit().transition().delay(r.exitDelay).attr("r",0).remove()}function d(e){Array.prototype.slice.call(arguments,1).forEach(function(t){if(t){for(var n in t){if(e[n]==null)e[n]=t[n]}}});return e}function v(e){if(typeof t==="undefined"||typeof n==="undefined"){throw new Error("Include d3.js (v3.0.3 or greater) and topojson on this page before creating a new map")}this.options=d(e,r);this.options.geographyConfig=d(e.geographyConfig,r.geographyConfig);this.options.projectionConfig=d(e.projectionConfig,r.projectionConfig);this.options.bubblesConfig=d(e.bubblesConfig,r.bubblesConfig);this.options.arcConfig=d(e.arcConfig,r.arcConfig);if(t.select(this.options.element).select("svg").length>0){i.call(this,this.options.element,this.options.height,this.options.width)}this.addPlugin("bubbles",p);this.addPlugin("legend",f);this.addPlugin("arc",c);this.addPlugin("labels",h);this.addPlugin("graticule",l);if(!this.options.disableDefaultStyles){o()}return this.draw()}var e;var t=window.d3,n=window.topojson;var r={scope:"world",setProjection:s,projection:"equirectangular",dataType:"json",done:function(){},fills:{defaultFill:"#ABDDA4"},geographyConfig:{dataUrl:null,hideAntarctica:true,borderWidth:1,borderColor:"#FDFDFD",popupTemplate:function(e,t){return'<div class="hoverinfo"><strong>'+e.properties.name+"</strong></div>"},popupOnHover:true,highlightOnHover:true,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2},projectionConfig:{rotation:[97,0]},bubblesConfig:{borderWidth:2,borderColor:"#FFFFFF",popupOnHover:true,popupTemplate:function(e,t){return'<div class="hoverinfo"><strong>'+t.name+"</strong></div>"},fillOpacity:.75,animate:true,highlightOnHover:true,highlightFillColor:"#FC8D59",highlightBorderColor:"rgba(250, 15, 160, 0.2)",highlightBorderWidth:2,highlightFillOpacity:.85,exitDelay:100},arcConfig:{strokeColor:"#DD1C77",strokeWidth:1,arcSharpness:1,animationSpeed:600}};v.prototype.draw=function(){function i(n){if(e.options.dataUrl){t[e.options.dataType](e.options.dataUrl,function(t){if(e.options.dataType==="csv"&&t&&t.slice){var n={};for(var r=0;r<t.length;r++){n[t[r].id]=t[r]}t=n}Datamaps.prototype.updateChoropleth.call(e,t)})}u.call(e,n);a.call(e);if(e.options.geographyConfig.popupOnHover||e.options.bubblesConfig.popupOnHover){hoverover=t.select(e.options.element).append("div").attr("class","datamaps-hoverover").style("z-index",10001).style("position","absolute")}e.options.done(e)}var e=this;var n=e.options;var r=n.setProjection.apply(e,[n.element,n]);this.path=r.path;this.projection=r.projection;if(n.geographyConfig.dataUrl){t.json(n.geographyConfig.dataUrl,function(t,n){if(t)throw new Error(t);e.customTopo=n;i(n)})}else{i(this[n.scope+"Topo"]||n.geographyConfig.dataJson)}return this};v.prototype.worldTopo="__WORLD__";v.prototype.usaTopo="__USA__";v.prototype.latLngToXY=function(e,t){return this.projection([t,e])};v.prototype.addLayer=function(e,t,n){var r;if(n){r=this.svg.insert("g",":first-child")}else{r=this.svg.append("g")}return r.attr("id",t||"").attr("class",e||"")};v.prototype.updateChoropleth=function(e){var t=this.svg;for(var n in e){if(e.hasOwnProperty(n)){var r;var i=e[n];if(!n){continue}else if(typeof i==="string"){r=i}else if(typeof i.color==="string"){r=i.color}else{r=this.options.fills[i.fillKey]}if(i===Object(i)){this.options.data[n]=d(i,this.options.data[n]||{});var s=this.svg.select("."+n).attr("data-info",JSON.stringify(this.options.data[n]))}t.selectAll("."+n).transition().style("fill",r)}}};v.prototype.updatePopup=function(e,n,r){var i=this;e.on("mousemove",null);e.on("mousemove",function(){var s=t.mouse(this);t.select(i.svg[0][0].parentNode).select(".datamaps-hoverover").style("top",s[1]+30+"px").html(function(){var t=JSON.parse(e.attr("data-info"));return r.popupTemplate(n,t)}).style("left",s[0]+"px")});t.select(i.svg[0][0].parentNode).select(".datamaps-hoverover").style("display","block")};v.prototype.addPlugin=function(e,t){var n=this;if(typeof v.prototype[e]==="undefined"){v.prototype[e]=function(n,i,s,o){var u;if(typeof o==="undefined"){o=false}if(typeof i==="function"){s=i;i=undefined}i=d(i||{},r[e+"Config"]);if(!o&&this.options[e+"Layer"]){u=this.options[e+"Layer"];i=i||this.options[e+"Options"]}else{u=this.addLayer(e);this.options[e+"Layer"]=u;this.options[e+"Options"]=i}t.apply(this,[u,n,i]);if(s){s(u)}}}};if(typeof define==="function"&&define.amd){define("datamaps",function(e){t=e("d3");n=e("topojson");return v})}else{window.Datamap=window.Datamaps=v}if(window.jQuery){window.jQuery.fn.datamaps=function(e,t){e=e||{};e.element=this[0];var n=new v(e);if(typeof t==="function"){t(n,e)}return this}}})()