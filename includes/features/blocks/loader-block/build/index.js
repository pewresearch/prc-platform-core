(()=>{"use strict";var e,t={894:(e,t,a)=>{const l=window.React,n=window.wp.primitives,r=(0,l.createElement)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(n.Path,{d:"M14.103 7.128l2.26-2.26a4 4 0 00-5.207 4.804L5.828 15a2 2 0 102.828 2.828l5.329-5.328a4 4 0 004.804-5.208l-2.261 2.26-1.912-.512-.513-1.912zm-7.214 9.64a.5.5 0 11.707-.707.5.5 0 01-.707.707z"})),o=window.wp.blocks,s=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"prc-platform/feature-loader","version":"0.1.0","title":"Feature Loader","description":"Load a feature\'s JS and CSS files.","category":"media","keywords":["feature","loader"],"attributes":{"slug":{"type":"string"},"dataAttachmentId":{"type":"integer"},"featurePropType":{"type":"string"},"legacyWpackIo":{"type":"object","properties":{"appName":{"type":"string"},"path":{"type":"string"},"deps":{"type":"string"}}},"legacyS3":{"type":"object","properties":{"libraries":{"type":"string"},"path":{"type":"string"},"styles":{"type":"string"},"react":{"type":"boolean"}}}},"supports":{"anchor":true,"html":false},"usesContext":["queryId","query","queryContext","templateSlug","previewPostType","postId","postType"],"textdomain":"prc-platform-feature-loader","editorScript":"file:./index.js","style":"file:./style-index.css"}'),c=window.wp.i18n,i=window.wp.components,u=window.wp.element,p=window.wp.blockEditor,d=window.wp.apiFetch;var m=a.n(d);const h=window.prcComponents;function f({id:e,setNewId:t,disabled:a=!1,children:n}){return(0,l.createElement)(u.Fragment,null,(0,l.createElement)(h.MediaDropZone,{attachmentId:e,disabled:a,onUpdate:e=>{"function"==typeof t&&t(e.id)},onClear:()=>{"function"==typeof t&&t(null)},mediaType:["text/csv","application/json"],label:(0,c.__)("Drop or Select a Data File (CSV or JSON)"),singularLabel:(0,c.__)("Data File")},(0,l.createElement)(i.Button,{variant:"primary"},"Modify Data File")),e&&n)}function g(e,t){for(const a in e)if("object"==typeof e[a]){const l=g(e[a],t);if(l)return l}else if(e.hasOwnProperty("slug")&&e.slug===t)return e;return null}const v="prc-platform/feature-loader";function y({id:e,appName:t,path:a,deps:l,version:n}){return(0,o.createBlock)(v,{slug:e,legacyWpackIo:{appName:t,path:a,deps:l}})}function b({id:e,path:t,react:a,libraries:l,styles:n}){return(0,o.createBlock)(v,{slug:e,legacyAssetsS3:{path:t,react:a,libraries:l,styles:n}})}function w(e){console.log("converTextRaw()",e);const t=null!==e.match(/\[load_interactive/),a=null!==e.match(/\[js_interactive/),l=e.match(/id="([^"]+)"/),n=e.match(/appName="([^"]+)"/),r=e.match(/path="([^"]+)"/),o=e.match(/deps="([^"]+)"/),s=e.match(/version="([^"]+)"/),c=e.match(/react="([^"]+)"/),i=e.match(/libraries="([^"]+)"/),u=e.match(/styles="([^"]+)"/);return console.log("isLoadInteractive",t),console.log("isJsInteractive",a),console.log(e),t?y({id:null!==l?l[1]:null,appName:null!==n?n[1]:null,path:null!==r?r[1]:null,deps:null!==o?o[1]:"",version:null!==s?s[1]:null}):a?b({id:null!==l?l[1]:null,path:null!==r?r[1]:null,react:null!==c?c[1]:null,libraries:null!==i?i[1]:null,styles:null!==u?u[1]:null}):void 0}const E={from:[{type:"shortcode",tag:"load_interactive",transform:({named:{id:e,appName:t,path:a,deps:l,version:n}})=>(console.log("name",named),y({id:e,appName:t,path:a,deps:l,version:n})),isMatch:({named:{id:e,appName:t,path:a}})=>!!e&&!!t&&!!a},{type:"shortcode",tag:"js_interactive",transform:({named:{id:e,path:t,libraries:a,styles:l,react:n}})=>(console.log("name",named),b({id:e,path:t,react:n,libraries:a,styles:l})),isMatch:({named:{path:e,react:t}})=>t},{type:"block",blocks:["core/shortcode"],transform:({text:e})=>w(e)},{type:"block",blocks:["core/html"],transform:({content:e})=>w(e)}]},{name:S}=s,k={icon:r,edit:function({attributes:e,setAttributes:t,clientId:a,context:n}){const{postId:o}=n,s=(0,p.useBlockProps)(),[d,h]=(0,u.useState)(null),[v,y]=(0,u.useState)(null),[b,w]=(0,u.useState)(!1),{slug:E,dataAttachmentId:S,legacyWpackIo:k,legacyAssetsS3:x}=e,_=(0,u.useMemo)((()=>k||x),[k,x]),{features:I}=function(e,t){const[a,l]=(0,u.useState)([]);return(0,u.useEffect)((()=>{m()({path:"/prc-api/v3/feature/get-assets"}).then((e=>{console.log({data:e}),l(e)}))}),[]),{features:a}}(),C=(0,u.useMemo)((()=>I&&E?g(I,E):null),[I,E]),O=(0,u.useMemo)((()=>C?.title||(0,c.__)("Select Feature")),[C]),j=(0,u.useMemo)((()=>{const e=[{label:"Select Research Area",value:null}];return I&&Object.keys(I).forEach((t=>{const a=t.charAt(0).toUpperCase()+t.slice(1);e.push({label:a,value:t})})),e}),[I]),F=(0,u.useMemo)((()=>{const e=[{label:"Select Year",value:null}];return I&&d&&Object.keys(I[d]).forEach((t=>{e.push({label:t,value:t})})),e}),[I,d]),A=(0,u.useMemo)((()=>{const e={label:"Select Feature",value:null};if(null===d||null===v)return[e];const t=I?.[d]?.[v];if(!t)return[e];const a=t.map((e=>({label:e.title,value:e.slug})));return a.unshift(e),a}),[I,d,v]);return(0,l.createElement)("div",{...s},_&&(0,l.createElement)(p.Warning,null,(0,l.createElement)("p",null,"This feature is being loaded via legacy means:"," ",(0,l.createElement)("strong",null,void 0!==k?"WPackIo":"Assets S3"),"."),(0,l.createElement)("p",null,"Please update this feature's code and bring it into"," ",(0,l.createElement)("i",null,"/features")," and up to ",(0,l.createElement)("i",null,"@wordpress/scripts")," ","build and loading compliance at earliest convenience"),(0,l.createElement)(i.Button,{isDestructive:!0,variant:"primary",onClick:()=>t({slug:null,legacyAssetsS3:null,legacyWpackIo:null}),text:"Reset Feature Selection"})),!_&&(0,l.createElement)(i.Placeholder,{label:O,icon:r},null===C&&(0,l.createElement)(i.Flex,{gap:"5px"},(0,l.createElement)(i.FlexItem,null,(0,l.createElement)(i.SelectControl,{label:"Select Research Area",value:d,options:j,onChange:e=>{h(e)}})),(0,l.createElement)(i.FlexItem,null,(0,l.createElement)(i.SelectControl,{label:"Select Year",value:v,options:F,onChange:e=>{y(e)}})),(0,l.createElement)(i.FlexBlock,null,(0,l.createElement)(i.SelectControl,{label:"Select Feature",value:E,disabled:0===A.length,options:A,onChange:e=>{t({slug:e})}}))),C&&(0,l.createElement)("div",null,(0,l.createElement)(i.Button,{variant:"secondary",onClick:()=>t({slug:null}),text:"Reset Feature Selection"}),(0,l.createElement)(f,{id:S,setNewId:e=>{t({dataAttachmentId:e})}},(0,l.createElement)("p",null,"Data accessible via Rest API:"),(0,l.createElement)("p",null,(0,l.createElement)("pre",null,"/wp-json/prc-api/v3/feature/get-data/",`${S}`))))))},transforms:E};(0,o.registerBlockType)(S,{...s,...k})}},a={};function l(e){var n=a[e];if(void 0!==n)return n.exports;var r=a[e]={exports:{}};return t[e](r,r.exports,l),r.exports}l.m=t,e=[],l.O=(t,a,n,r)=>{if(!a){var o=1/0;for(u=0;u<e.length;u++){for(var[a,n,r]=e[u],s=!0,c=0;c<a.length;c++)(!1&r||o>=r)&&Object.keys(l.O).every((e=>l.O[e](a[c])))?a.splice(c--,1):(s=!1,r<o&&(o=r));if(s){e.splice(u--,1);var i=n();void 0!==i&&(t=i)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[a,n,r]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};l.O.j=t=>0===e[t];var t=(t,a)=>{var n,r,[o,s,c]=a,i=0;if(o.some((t=>0!==e[t]))){for(n in s)l.o(s,n)&&(l.m[n]=s[n]);if(c)var u=c(l)}for(t&&t(a);i<o.length;i++)r=o[i],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(u)},a=globalThis.webpackChunk_pewresearch_prc_platform_interactives_loader=globalThis.webpackChunk_pewresearch_prc_platform_interactives_loader||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var n=l.O(void 0,[350],(()=>l(894)));n=l.O(n)})();
//# sourceMappingURL=index.js.map