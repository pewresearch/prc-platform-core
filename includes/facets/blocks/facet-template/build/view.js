import*as e from"@wordpress/interactivity";var t={d:(e,o)=>{for(var c in o)t.o(o,c)&&!t.o(e,c)&&Object.defineProperty(e,c,{enumerable:!0,get:o[c]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const o=(c={getContext:()=>e.getContext,getElement:()=>e.getElement,getServerContext:()=>e.getServerContext,getServerState:()=>e.getServerState,store:()=>e.store},n={},t.d(n,c),n);var c,n;const{state:l,actions:r}=(0,o.store)("prc-platform/facets-context-provider",{state:{get label(){const e=(0,o.getContext)().choice,{facetSlug:t,label:c,value:n}=e;return`${c} (${function(e,t,o){const c=o.find((e=>e.value===t));return c?c.count:null}(0,n,(0,o.getServerState)().facets[t].choices)})`},get isSelected(){const{facetSlug:e,value:t}=(0,o.getContext)().choice;return l.selected[e].includes(t)},get checked(){const{facetSlug:e,value:t}=(0,o.getContext)().choice;return l.selected[e].includes(t)},get id(){const e=(0,o.getContext)();return`facet_${e.choice.slug}_${e.choice.term_id}`},get type(){return(0,o.getContext)().choice.type},get value(){return(0,o.getContext)().choice.value},get slug(){return(0,o.getContext)().choice.slug},get name(){return(0,o.getContext)().choice.slug},get facetSlug(){return(0,o.getContext)().choice.facetSlug},get hasExpandedChoices(){return(0,o.getServerContext)().expandedChoices&&(0,o.getServerContext)().expandedChoices.length>0},get placeholder(){const e=(0,o.getContext)(),{facetSlug:t,placeholder:c}=e,{selected:n}=l,r=n[t];let s=`Select ${c}`;return void 0!==r&&1<=r.length&&(s=r.map((e=>e.replace(/-/g," ").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "))).join(", ")),s},get facetChoices(){return(0,o.getServerContext)().choices},get facetExpandedChoices(){return(0,o.getServerContext)().expandedChoices},get filterableFacetChoices(){const{searchValue:e}=(0,o.getContext)(),{data:t}=(0,o.getServerContext)();return e?(console.log("filtering...",e,t),t.filter((t=>{const{label:o}=t;return o.toLowerCase().includes(e.toLowerCase())}))):t},get hasSelections(){const{facetSlug:e}=(0,o.getContext)(),{selected:t}=l;return t[e].length>0}},actions:{clearFacet:()=>{const{facetSlug:e}=(0,o.getContext)();r.onClear(e)},onCheckboxClick:()=>{const{value:e,facetSlug:t,getSelected:o}=l;o[t]&&0!==o[t].length?o[t].includes(e)?l.selected[t]=o[t].filter((t=>t!==e)):"radio"===l.type?l.selected[t]=[e]:l.selected[t]=[...o[t],e]:l.selected[t]=[e]},*onCheckboxMouseEnter(){const{facetSlug:e,value:t,getSelected:o}=l,c={...o[e]||[],[e]:t},n=r.constructNewUrl(c);yield r.prefetch(n)},onSelectClick:()=>{const e=(0,o.getContext)(),{facetSlug:t,value:c}=e.choice,n=l.getSelected,r=n;n[t]&&n[t].includes(c)?r[t]=r[t].filter((e=>e!==c)):r[t]=[c],l.selected=r,e.searchValue=""},onExpand:()=>{const e=(0,o.getContext)();e.expanded=!e.expanded},onCollapse:()=>{const e=(0,o.getContext)();let t=!1;t||(t=!0,setTimeout((()=>{e.expanded=!1,t=!1}),150))},moveThroughChoices:(e,t)=>{const{facetChoices:c}=l,{activeIndex:n}=(0,o.getContext)();let r=null;r=null===n||isNaN(n)?0:n+e,r<0&&(r=c.length-1),r>=c.length&&(r=0);const s=c[r].value,a=t.parentElement.parentElement.querySelector(".wp-block-prc-platform-facet-select-field__list"),g=a.querySelector(`[data-ref-value="${s}"]`);if(g){const e=a.querySelector(".is-selected");e&&e.classList.remove("is-selected"),g.classList.add("is-selected"),g.scrollIntoView({block:"nearest"})}console.log("NEXT ACTIVE",r,s,g),(0,o.getContext)().activeIndex=r},onSelectKeyUp:e=>{e.preventDefault();const t=(0,o.getContext)(),{facetSlug:c,activeIndex:n,choices:s}=t,{value:a}=e.target,{ref:g}=(0,o.getElement)();if("Escape"!==e.key){if(40===e.keyCode&&"ArrowDown"===e.key)return console.log("DOWN",e.target),void r.moveThroughChoices(1,e.target);if(38!==e.keyCode||"ArrowUp"!==e.key){if("Enter"===e.key){const e=s[n].value,o=l.selected,r=o;return o[c]&&o[c].includes(e)?r[c]=r[c].filter((t=>t!==e)):r[c]=[e],t.expanded=!1,void(l.selected=r)}(0,o.getContext)().searchValue=a.toLowerCase()}else r.moveThroughChoices(-1,e.target)}else!0===(0,o.getContext)().expanded&&g.blur()}},callbacks:{onUpdates:()=>{const e=(0,o.getContext)(),t=(0,o.getServerContext)();console.log("onUpdates",e,t,l)},onExpand:()=>{const e=(0,o.getContext)(),{expanded:t}=e;e.expandedLabel=t?"- Less":"+ More"}}});
//# sourceMappingURL=view.js.map