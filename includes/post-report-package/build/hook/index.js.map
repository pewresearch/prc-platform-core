{"version":3,"file":"index.js","mappings":"yBAAA,IAAI,EAA+BA,OAAW,GAAW,QCArD,EAA+BA,OAAW,GAAQ,KCAlD,EAA+BA,OAAW,GAAY,SCQ3C,SAASC,EAAgBC,EAAQC,GAC/C,MAAOC,EAAoBC,IAAyBC,EAAAA,EAAAA,UAAS,KAEvD,QAAEC,EAAO,YAAEC,EAAW,YAAEC,IAAgBC,EAAAA,EAAAA,kBAC7C,WACAP,EACA,CACCQ,SAAU,GACVC,QAAS,CAAE,KAAM,OAAQ,cAAe,QAAS,OAAQ,aAAc,kBACvEC,YAAaX,IAsBf,MAAO,CACNY,cAToBC,EAAAA,EAAAA,UAAQ,KAC5BC,QAAQC,IAAI,kBAAmBV,EAASC,EAAaN,EAAQC,IACxDI,GAAWC,EACR,GAEDD,IACL,CAACA,EAASC,IAIZJ,qBACAc,gBArBwBC,IACpBf,EAAmBgB,SAASD,GAC/Bd,EACCD,EAAmBiB,QAAQC,GAAOA,IAAOH,KAG1Cd,EAAsB,IAAID,EAAoBe,GAC/C,EAgBF,CCtCA,SAASI,EAAWC,EAAMC,GACpBzB,OAAO0B,yBAAyBF,KACpCxB,OAAO0B,yBAAyBF,GAAQC,EAE1C,CCVmCzB,OAAW,GAAO,ICAlBA,OAAW,GAAY,SFY1DA,OAAO0B,yBAA2B,CAAC,EAEnCH,EAAW,wBGCI,UAA+B,SAAEI,EAAQ,OAAEzB,EAAM,SAAEC,IACjE,MAAM,aAAEW,GAAiBb,EAAgBC,EAAQC,GAEjDa,QAAQC,IAAI,uBAAwBU,EAAUzB,EAAQC,EAAUW,GAEhE,MAAM,SAAEc,EAAW,KAAOC,EAAAA,EAAAA,YACxBC,IAEA,MAAMC,EAASD,EAAO,qBAAqBE,YAkBrCC,EAAgBF,EAAOV,QAC3Ba,GAAU,iBAAmBA,EAAMC,OAAwC,IAAhCD,EAAME,YAAYC,YAI/D,OAFArB,QAAQC,IAAI,qBAAsBgB,EAAeF,GAE1C,CACNH,SAAU,IAAMK,EAAcK,OAvBX,CACnB,CACCF,WAAY,CACXG,QAAS,iBAGX,CACCH,WAAY,CACXG,QAAS,iBAGX,CACCH,WAAY,CACXG,QAAS,kBAU0CN,EACrD,GAEF,CAACN,IA2CF,OAxCAX,QAAQC,IAAI,WAAYW,GACxBZ,QAAQC,IAAI,eAAgBH,GAuCrB,CACNc,UAlCwBb,EAAAA,EAAAA,UAAQ,IAC3Ba,EAGEA,EAASY,KAAKC,IAAO,CAC3Bd,SAAUc,GAASd,SACnBe,MAAOD,EAAQL,YAAYG,YAJpB,IAMN,CAACX,IA2BHd,cAzB4BC,EAAAA,EAAAA,UAAQ,IAC/BD,EAgBEA,EAAa0B,KAAKC,IAAO,CAC/BnB,GAAImB,EAAQnB,GACZoB,MAAOD,EAAQC,OAAOC,aAjBf,CACN,CACCrB,GAAI,EACJoB,MAAO,qBAER,CACCpB,GAAI,EACJoB,MAAO,qBAER,CACCpB,GAAI,EACJoB,MAAO,uBAQR,CAAC5B,IAML,IHlFAS,EAAW,kBAAmBtB,E","sources":["webpack://@pewresearch/prc-platform-post-report-package/external window [\"wp\",\"element\"]","webpack://@pewresearch/prc-platform-post-report-package/external window [\"wp\",\"data\"]","webpack://@pewresearch/prc-platform-post-report-package/external window [\"wp\",\"coreData\"]","webpack://@pewresearch/prc-platform-post-report-package/./src/hook/useBackChapters.js","webpack://@pewresearch/prc-platform-post-report-package/./src/hook/index.js","webpack://@pewresearch/prc-platform-post-report-package/external window [\"wp\",\"url\"]","webpack://@pewresearch/prc-platform-post-report-package/external window [\"wp\",\"apiFetch\"]","webpack://@pewresearch/prc-platform-post-report-package/./src/hook/usePostReportPackage.js"],"sourcesContent":["var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"element\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"data\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"coreData\"];","/**\n * WordPress Dependencies\n */\nimport { useState, useEffect, useRef, useMemo } from '@wordpress/element';\nimport { useEntityRecords } from '@wordpress/core-data';\nimport { addQueryArgs } from '@wordpress/url';\nimport apiFetch from '@wordpress/api-fetch';\n\nexport default function useBackChapters(postId, postType) {\n\tconst [hiddenBackChapters, setHiddenBackChapters] = useState([]);\n\n\tconst { records, isResolving, hasResolved } = useEntityRecords(\n\t\t'postType',\n\t\tpostType,\n\t\t{\n\t\t\tper_page: 25,\n\t\t\t_fields: [ 'id', 'link', 'post_parent', 'title', 'type', 'menu_order', 'report_package' ],\n\t\t\tpost_parent: postId,\n\t\t},\n\t);\n\n\tconst hideBackChapter = (chapterId) => {\n\t\tif (hiddenBackChapters.includes(chapterId)) {\n\t\t\tsetHiddenBackChapters(\n\t\t\t\thiddenBackChapters.filter((id) => id !== chapterId),\n\t\t\t);\n\t\t} else {\n\t\t\tsetHiddenBackChapters([...hiddenBackChapters, chapterId]);\n\t\t}\n\t};\n\n\tconst backChapters = useMemo(() => {\n\t\tconsole.log('useBackChapters', records, isResolving, postId, postType);\n\t\tif (!records || isResolving) {\n\t\t\treturn [];\n\t\t}\n\t\treturn records;\n\t}, [records, isResolving]);\n\n\treturn {\n\t\tbackChapters,\n\t\thiddenBackChapters,\n\t\thideBackChapter,\n\t}\n}\n","/**\n * Internal Dependencies\n */\nimport usePostReportPackage from './usePostReportPackage';\nimport useBackChapters from './useBackChapters';\n\nfunction loadScript(slug, script) {\n\tif (!window.prcPostReportPackageHook[slug]) {\n\t\twindow.prcPostReportPackageHook[slug] = script;\n\t}\n}\n\nwindow.prcPostReportPackageHook = {};\n\nloadScript('usePostReportPackage', usePostReportPackage);\nloadScript('useBackChapters', useBackChapters);\n","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"url\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"apiFetch\"];","/**\n * External Dependencies\n */\n\n/**\n * WordPress Dependencies\n */\nimport { useMemo } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal Dependencies\n */\nimport useBackChapters from './useBackChapters';\n\nexport default function usePostReportPackage( { clientId, postId, postType } ) {\n\tconst { backChapters } = useBackChapters(postId, postType);\n\n\tconsole.log('usePostReportPackage', clientId, postId, postType, backChapters);\n\n\tconst { chapters = [] } = useSelect(\n\t\t(select) => {\n\t\t\t// Currently we're just getting all blocks in the editor context, need to see what this brings in when on the site editor.\n\t\t\tconst blocks = select('core/block-editor').getBlocks();\n\t\t\tconst placeholder = [\n\t\t\t\t{\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tcontent: 'Chapter 1...',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tcontent: 'Chapter 2...',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tcontent: 'Chapter 3...',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t\tconst foundChapters = blocks.filter(\n\t\t\t\t(block) => 'core/heading' === block.name && block.attributes?.isChapter === true,\n\t\t\t);\n\t\t\tconsole.log(\"useCollectChapters\", foundChapters, blocks);\n\n\t\t\treturn {\n\t\t\t\tchapters: 0 === foundChapters.length ? placeholder : foundChapters,\n\t\t\t};\n\t\t},\n\t\t[clientId],\n\t);\n\n\tconsole.log('chapters', chapters);\n\tconsole.log('backChapters', backChapters);\n\n\t// Memoize chapters, so that we don't have to recalculate them on every render.\n\t// This is important because we're using the chapters in a useEffect hook.\n\t// If we didn't memoize, the useEffect would run on every render.\n\n\tconst memoizedChapters = useMemo(() => {\n\t\tif (!chapters) {\n\t\t\treturn [];\n\t\t}\n\t\treturn chapters.map((chapter) => ({\n\t\t\tclientId: chapter?.clientId,\n\t\t\ttitle: chapter.attributes?.content,\n\t\t}));\n\t}, [chapters]);\n\n\tconst memoizedBackChapters = useMemo(() => {\n\t\tif (!backChapters) {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: 1,\n\t\t\t\t\ttitle: 'Back Chapter 1...',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 2,\n\t\t\t\t\ttitle: 'Back Chapter 2...',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 3,\n\t\t\t\t\ttitle: 'Back Chapter 3...',\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn backChapters.map((chapter) => ({\n\t\t\tid: chapter.id,\n\t\t\ttitle: chapter.title?.rendered,\n\t\t}));\n\t}, [backChapters]);\n\n\treturn {\n\t\tchapters: memoizedChapters,\n\t\tbackChapters: memoizedBackChapters,\n\t};\n}\n"],"names":["window","useBackChapters","postId","postType","hiddenBackChapters","setHiddenBackChapters","useState","records","isResolving","hasResolved","useEntityRecords","per_page","_fields","post_parent","backChapters","useMemo","console","log","hideBackChapter","chapterId","includes","filter","id","loadScript","slug","script","prcPostReportPackageHook","clientId","chapters","useSelect","select","blocks","getBlocks","foundChapters","block","name","attributes","isChapter","length","content","map","chapter","title","rendered"],"sourceRoot":""}