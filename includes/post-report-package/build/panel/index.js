!function(){"use strict";var t=window.wp.element,e=window.wp.i18n,s=window.wp.plugins,i=window.wp.editPost,n=window.wp.data,o=window.wp.primitives,r=(0,t.createElement)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(o.Path,{d:"M7 13.8h6v-1.5H7v1.5zM18 16V4c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2zM5.5 16V4c0-.3.2-.5.5-.5h10c.3 0 .5.2.5.5v12c0 .3-.2.5-.5.5H6c-.3 0-.5-.2-.5-.5zM7 10.5h8V9H7v1.5zm0-3.3h8V5.8H7v1.4zM20.2 6v13c0 .7-.6 1.2-1.2 1.2H8v1.5h11c1.5 0 2.7-1.2 2.7-2.8V6h-1.5z"})),a=window.wp.coreData,l=window.React,h=window.ReactDOM;function d(t){const e=window.getComputedStyle(t);return Math.max(parseInt(e["margin-top"],10),parseInt(e["margin-bottom"],10))+t.getBoundingClientRect().height}function c(t,e=0,s=0){t&&(null!==e&&null!==s?t.style.transform=`translate(${s}px, ${e}px)`:t.style.removeProperty("transform"))}function u(t,e,s){t&&(t.style.transition=`transform ${e}ms${s?` ${s}`:""}`)}const p=t=>{let e=[],s=null;const i=(...i)=>{e=i,s||(s=requestAnimationFrame((()=>{s=null,t(...e)})))};return i.cancel=()=>{s&&cancelAnimationFrame(s)},i};function g(t,e){const s=["input","textarea","select","option","optgroup","video","audio","button","a"],i=["button","link","checkbox","tab"];for(;t!==e;){if(t.getAttribute("data-movable-handle"))return!1;if(s.includes(t.tagName.toLowerCase()))return!0;const e=t.getAttribute("role");if(e&&i.includes(e.toLowerCase()))return!0;if("label"===t.tagName.toLowerCase()&&t.hasAttribute("for"))return!0;t.tagName&&(t=t.parentElement)}return!1}const m=200;class f extends l.Component{constructor(t){super(t),this.listRef=l.createRef(),this.ghostRef=l.createRef(),this.topOffsets=[],this.itemTranslateOffsets=[],this.initialYOffset=0,this.lastScroll=0,this.lastYOffset=0,this.lastListYOffset=0,this.needle=-1,this.afterIndex=-2,this.state={itemDragged:-1,itemDraggedOutOfBounds:-1,selectedItem:-1,initialX:0,initialY:0,targetX:0,targetY:0,targetHeight:0,targetWidth:0,liveText:"",scrollingSpeed:0,scrollWindow:!1},this.doScrolling=()=>{const{scrollingSpeed:t,scrollWindow:e}=this.state,s=this.listRef.current;window.requestAnimationFrame((()=>{e?window.scrollTo(window.pageXOffset,window.pageYOffset+1.5*t):s.scrollTop+=t,0!==t&&this.doScrolling()}))},this.getChildren=()=>this.listRef&&this.listRef.current?Array.from(this.listRef.current.children):(console.warn("No items found in the List container. Did you forget to pass & spread the `props` param in renderList?"),[]),this.calculateOffsets=()=>{this.topOffsets=this.getChildren().map((t=>t.getBoundingClientRect().top)),this.itemTranslateOffsets=this.getChildren().map((t=>d(t)))},this.getTargetIndex=t=>this.getChildren().findIndex((e=>e===t.target||e.contains(t.target))),this.onMouseOrTouchStart=t=>{this.dropTimeout&&this.state.itemDragged>-1&&(window.clearTimeout(this.dropTimeout),this.finishDrop());const e=(s=t).touches&&s.touches.length||s.changedTouches&&s.changedTouches.length;var s;if(!e&&0!==t.button)return;const i=this.getTargetIndex(t);if(-1===i||this.props.values[i]&&this.props.values[i].disabled)return void(-1!==this.state.selectedItem&&(this.setState({selectedItem:-1}),this.finishDrop()));const n=this.getChildren()[i],o=n.querySelector("[data-movable-handle]");if((!o||o.contains(t.target))&&!g(t.target,n)){if(t.preventDefault(),this.props.beforeDrag&&this.props.beforeDrag({elements:this.getChildren(),index:i}),e){const t={passive:!1};n.style.touchAction="none",document.addEventListener("touchend",this.schdOnEnd,t),document.addEventListener("touchmove",this.schdOnTouchMove,t),document.addEventListener("touchcancel",this.schdOnEnd,t)}else{document.addEventListener("mousemove",this.schdOnMouseMove),document.addEventListener("mouseup",this.schdOnEnd);const t=this.getChildren()[this.state.itemDragged];t&&t.style&&(t.style.touchAction="")}this.onStart(n,e?t.touches[0].clientX:t.clientX,e?t.touches[0].clientY:t.clientY,i)}},this.getYOffset=()=>{const t=this.listRef.current?this.listRef.current.scrollTop:0;return window.pageYOffset+t},this.onStart=(t,e,s,i)=>{this.state.selectedItem>-1&&(this.setState({selectedItem:-1}),this.needle=-1);const n=t.getBoundingClientRect(),o=window.getComputedStyle(t);this.calculateOffsets(),this.initialYOffset=this.getYOffset(),this.lastYOffset=window.pageYOffset,this.lastListYOffset=this.listRef.current.scrollTop,this.setState({itemDragged:i,targetX:n.left-parseInt(o["margin-left"],10),targetY:n.top-parseInt(o["margin-top"],10),targetHeight:n.height,targetWidth:n.width,initialX:e,initialY:s})},this.onMouseMove=t=>{t.cancelable&&t.preventDefault(),this.onMove(t.clientX,t.clientY)},this.onTouchMove=t=>{t.cancelable&&t.preventDefault(),this.onMove(t.touches[0].clientX,t.touches[0].clientY)},this.onWheel=t=>{this.state.itemDragged<0||(this.lastScroll=this.listRef.current.scrollTop+=t.deltaY,this.moveOtherItems())},this.onMove=(t,e)=>{if(-1===this.state.itemDragged)return null;c(this.ghostRef.current,e-this.state.initialY,this.props.lockVertically?0:t-this.state.initialX),this.autoScrolling(e),this.moveOtherItems()},this.moveOtherItems=()=>{const t=this.ghostRef.current.getBoundingClientRect(),e=t.top+t.height/2,s=d(this.getChildren()[this.state.itemDragged]),i=this.getYOffset();this.initialYOffset!==i&&(this.topOffsets=this.topOffsets.map((t=>t-(i-this.initialYOffset))),this.initialYOffset=i),this.isDraggedItemOutOfBounds()&&this.props.removableByMove?this.afterIndex=this.topOffsets.length+1:this.afterIndex=function(t,e){let s,i=0,n=t.length-1;for(;i<=n;){if(s=Math.floor((n+i)/2),!t[s+1]||t[s]<=e&&t[s+1]>=e)return s;t[s]<e&&t[s+1]<e?i=s+1:n=s-1}return-1}(this.topOffsets,e),this.animateItems(-1===this.afterIndex?0:this.afterIndex,this.state.itemDragged,s)},this.autoScrolling=t=>{const{top:e,bottom:s,height:i}=this.listRef.current.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight;if(s>n&&n-t<m)this.setState({scrollingSpeed:Math.round((m-(n-t))/10),scrollWindow:!0});else if(e<0&&t<m)this.setState({scrollingSpeed:Math.round((m-t)/-10),scrollWindow:!0});else if(this.state.scrollWindow&&0!==this.state.scrollingSpeed&&this.setState({scrollingSpeed:0,scrollWindow:!1}),i+20<this.listRef.current.scrollHeight){let i=0;t-e<m?i=Math.round((m-(t-e))/-10):s-t<m&&(i=Math.round((m-(s-t))/10)),this.state.scrollingSpeed!==i&&this.setState({scrollingSpeed:i})}},this.animateItems=(t,e,s,i=!1)=>{this.getChildren().forEach(((n,o)=>{if(u(n,this.props.transitionDuration),e===o&&i){if(e===t)return c(n,null);c(n,e<t?this.itemTranslateOffsets.slice(e+1,t+1).reduce(((t,e)=>t+e),0):-1*this.itemTranslateOffsets.slice(t,e).reduce(((t,e)=>t+e),0))}else c(n,e<t&&o>e&&o<=t?-s:o<e&&e>t&&o>=t?s:null)}))},this.isDraggedItemOutOfBounds=()=>{const t=this.getChildren()[this.state.itemDragged].getBoundingClientRect(),e=this.ghostRef.current.getBoundingClientRect();return Math.abs(t.left-e.left)>e.width?(-1===this.state.itemDraggedOutOfBounds&&this.setState({itemDraggedOutOfBounds:this.state.itemDragged}),!0):(this.state.itemDraggedOutOfBounds>-1&&this.setState({itemDraggedOutOfBounds:-1}),!1)},this.onEnd=t=>{t.cancelable&&t.preventDefault(),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchup",this.schdOnEnd),document.removeEventListener("touchcancel",this.schdOnEnd);const e=this.props.removableByMove&&this.isDraggedItemOutOfBounds();!e&&this.props.transitionDuration>0&&-2!==this.afterIndex&&p((()=>{u(this.ghostRef.current,this.props.transitionDuration,"cubic-bezier(.2,1,.1,1)"),this.afterIndex<1&&0===this.state.itemDragged?c(this.ghostRef.current,0,0):c(this.ghostRef.current,-(window.pageYOffset-this.lastYOffset)-(this.listRef.current.scrollTop-this.lastListYOffset)+(this.state.itemDragged<this.afterIndex?this.itemTranslateOffsets.slice(this.state.itemDragged+1,this.afterIndex+1).reduce(((t,e)=>t+e),0):-1*this.itemTranslateOffsets.slice(this.afterIndex<0?0:this.afterIndex,this.state.itemDragged).reduce(((t,e)=>t+e),0)),0)}))(),this.dropTimeout=window.setTimeout(this.finishDrop,e||-2===this.afterIndex?0:this.props.transitionDuration)},this.finishDrop=()=>{const t=this.props.removableByMove&&this.isDraggedItemOutOfBounds();(t||this.afterIndex>-2&&this.state.itemDragged!==this.afterIndex)&&this.props.onChange({oldIndex:this.state.itemDragged,newIndex:t?-1:Math.max(this.afterIndex,0),targetRect:this.ghostRef.current.getBoundingClientRect()}),this.getChildren().forEach((t=>{u(t,0),c(t,null),t.style.touchAction=""})),this.setState({itemDragged:-1,scrollingSpeed:0}),this.afterIndex=-2,this.lastScroll>0&&(this.listRef.current.scrollTop=this.lastScroll,this.lastScroll=0)},this.onKeyDown=t=>{const e=this.state.selectedItem,s=this.getTargetIndex(t);if(!g(t.target,t.currentTarget)&&-1!==s){if(" "===t.key&&(t.preventDefault(),e===s?(e!==this.needle&&(this.getChildren().forEach((t=>{u(t,0),c(t,null)})),this.props.onChange({oldIndex:e,newIndex:this.needle,targetRect:this.getChildren()[this.needle].getBoundingClientRect()}),this.getChildren()[this.needle].focus()),this.setState({selectedItem:-1,liveText:this.props.voiceover.dropped(e+1,this.needle+1)}),this.needle=-1):(this.setState({selectedItem:s,liveText:this.props.voiceover.lifted(s+1)}),this.needle=s,this.calculateOffsets())),("ArrowDown"===t.key||"j"===t.key)&&e>-1&&this.needle<this.props.values.length-1){t.preventDefault();const s=d(this.getChildren()[e]);this.needle++,this.animateItems(this.needle,e,s,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!1)})}if(("ArrowUp"===t.key||"k"===t.key)&&e>-1&&this.needle>0){t.preventDefault();const s=d(this.getChildren()[e]);this.needle--,this.animateItems(this.needle,e,s,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!0)})}"Escape"===t.key&&e>-1&&(this.getChildren().forEach((t=>{u(t,0),c(t,null)})),this.setState({selectedItem:-1,liveText:this.props.voiceover.canceled(e+1)}),this.needle=-1),("Tab"===t.key||"Enter"===t.key)&&e>-1&&t.preventDefault()}},this.schdOnMouseMove=p(this.onMouseMove),this.schdOnTouchMove=p(this.onTouchMove),this.schdOnEnd=p(this.onEnd)}componentDidMount(){this.calculateOffsets(),document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1,capture:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart)}componentDidUpdate(t,e){e.scrollingSpeed!==this.state.scrollingSpeed&&0===e.scrollingSpeed&&this.doScrolling()}componentWillUnmount(){document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mousedown",this.onMouseOrTouchStart),this.dropTimeout&&window.clearTimeout(this.dropTimeout),this.schdOnMouseMove.cancel(),this.schdOnTouchMove.cancel(),this.schdOnEnd.cancel()}render(){const t={userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",boxSizing:"border-box",position:"relative"},e={...t,top:this.state.targetY,left:this.state.targetX,width:this.state.targetWidth,height:this.state.targetHeight,position:"fixed",marginTop:0};return l.createElement(l.Fragment,null,this.props.renderList({children:this.props.values.map(((e,s)=>{const i=s===this.state.itemDragged,n=s===this.state.selectedItem,o={key:s,tabIndex:this.props.values[s]&&this.props.values[s].disabled?-1:0,"aria-roledescription":this.props.voiceover.item(s+1),onKeyDown:this.onKeyDown,style:{...t,visibility:i?"hidden":void 0,zIndex:n?5e3:0}};return this.props.renderItem({value:e,props:o,index:s,isDragged:!1,isSelected:n,isOutOfBounds:!1})})),isDragged:this.state.itemDragged>-1,props:{ref:this.listRef}}),this.state.itemDragged>-1&&h.createPortal(this.props.renderItem({value:this.props.values[this.state.itemDragged],props:{ref:this.ghostRef,style:e,onWheel:this.onWheel},index:this.state.itemDragged,isDragged:!0,isSelected:!1,isOutOfBounds:this.state.itemDraggedOutOfBounds>-1}),this.props.container||document.body),l.createElement("div",{"aria-live":"assertive",role:"log","aria-atomic":"true",style:{position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0px",padding:"0px",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"}},this.state.liveText))}}f.defaultProps={transitionDuration:300,lockVertically:!1,removableByMove:!1,voiceover:{item:t=>`You are currently at a draggable item at position ${t}. Press space bar to lift.`,lifted:t=>`You have lifted item at position ${t}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,moved:(t,e)=>`You have moved the lifted item ${e?"up":"down"} to position ${t}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,dropped:(t,e)=>`You have dropped the item. It has moved from position ${t} to ${e}.`,canceled:t=>`You have cancelled the movement. The item has returned to its starting position of ${t}.`}};var v=f,w=window.prcComponents,O=window.wp.components,S={*getItems(){const t=(0,n.select)("core/editor").getEditedPostAttribute("meta"),{multiSectionReport:e}=t,s=t?.back_chapters;console.log("multiSectionReport?",t,e,s),null!==e&&(yield w.listStoreActions.seed(e))}},I={getItems(t){return t}};(0,w.registerListStore)("prc/multi-section-report",S,I);var x=window.prcHooks,D=window.wp.htmlEntities,E=window.wp.url;const{api:y}=window.wp;var T=({hocOnChange:s=!1})=>{const[i,n]=(0,t.useState)(!1),[o,r]=(0,t.useState)(!1),[a,l]=(0,t.useState)(),[h,d]=(0,t.useState)(),c=(0,x.useDebounce)(h,1e3),[u,p]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{console.log("postUrl",c),void 0!==c&&3<=c.length&&(t=>{const e=(0,E.getQueryArg)(t,"post");console.log("fetchPostByEditURL",t),new y.models.Post({id:e}).fetch().then((t=>{console.log("matched?",t),l(t.title.rendered),p(t),n(!0)})).always((()=>{r(!1)}))})(c)}),[c]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{style:{display:"flex",flexDirection:"row"}},(0,t.createElement)("div",{style:{flexGrow:"1"}},(0,t.createElement)(O.TextControl,{autoComplete:"off",onChange:t=>{r(!0),d(t)},placeholder:"Paste post's edit url..."})),(0,t.createElement)("div",null,o&&(0,t.createElement)(O.Spinner,null))),!0===i&&(0,t.createElement)(O.Modal,{title:(0,e.__)("Confirm Post","prc-platform-post-report-package"),onRequestClose:()=>{n(!1)}},(0,t.createElement)("p",null,"Add ",(0,t.createElement)("strong",null,(0,D.decodeEntities)(a))," post as child?"),(0,t.createElement)(O.ButtonGroup,null,(0,t.createElement)(O.Button,{variant:"secondary",onClick:()=>{d(""),p(!1)}},"No"),(0,t.createElement)(O.Button,{variant:"primary",onClick:()=>{const{id:t}=u;new y.models.Post({id:t}).fetch().then((t=>{t.id===u.id?(n(!1),p(!1),!1!==s&&s(t.id)):alert("Uhoh, somethings wrong here. The expected post id does not match the given id.")}))}},"Yes"))))},C=(0,O.withNotices)((function({noticeOperations:e,noticeUI:s}){const{postId:i}=(0,n.useSelect)((t=>({postId:t("core/editor").getCurrentPostId()})),[]),[o,r]=(0,a.useEntityProp)("postType","post","meta",i),{multiSectionReport:l}=o,[h,d]=(0,t.useState)(l);return(0,t.useEffect)((()=>{r({...o,multiSectionReport:h})}),[h]),(0,t.createElement)(O.PanelBody,{title:"Back Chapters"},(0,t.createElement)(v,{lockVertically:!0,values:h,onChange:({oldIndex:t,newIndex:e})=>((t,e)=>{const s=[...h],i=s[t];s.splice(t,1),s.splice(void 0,0,i),d(s)})({from:t,to:e}),renderList:({children:e,props:s})=>(0,t.createElement)("div",{...s},e),renderItem:({value:e,props:s,index:i})=>(0,t.createElement)("div",{...s},(0,t.createElement)(w.ListStoreItem,{key:e.key,defaultLabel:"Child Post",keyValue:e.postId,index:i,onRemove:()=>(t=>{const e=[...h];e.splice(t,1),d(e)})(i)},null===e.postId&&(0,t.createElement)(T,{hocOnChange:t=>setItemProp(i,"postId",t)})))}),(0,t.createElement)(O.Button,{variant:"primary",onClick:()=>{((t,e)=>{const s=[...h];s.push({key:t,termId:void 0}),d(s)})({key:`_${Math.random().toString(36).substr(2,9)}`,postId:null})}},"Add Post"))}));const M="prc-platform-post-report-package";(0,s.registerPlugin)(M,{render:function(){return(0,t.createElement)(i.PluginSidebar,{name:M,title:"Report Package",icon:r},(0,t.createElement)(C,null))}})}();
//# sourceMappingURL=index.js.map