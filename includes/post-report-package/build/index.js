(()=>{"use strict";const e=window.wp.element,t=(0,e.forwardRef)((function({icon:t,size:s=24,...i},n){return(0,e.cloneElement)(t,{width:s,height:s,...i,ref:n})})),s=window.React,i=window.wp.primitives,n=(0,s.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,s.createElement)(i.Path,{fillRule:"evenodd",d:"M8.95 11.25H4v1.5h4.95v4.5H13V18c0 1.1.9 2 2 2h3c1.1 0 2-.9 2-2v-3c0-1.1-.9-2-2-2h-3c-1.1 0-2 .9-2 2v.75h-2.55v-7.5H13V9c0 1.1.9 2 2 2h3c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3c-1.1 0-2 .9-2 2v.75H8.95v4.5ZM14.5 15v3c0 .3.2.5.5.5h3c.3 0 .5-.2.5-.5v-3c0-.3-.2-.5-.5-.5h-3c-.3 0-.5.2-.5.5Zm0-6V6c0-.3.2-.5.5-.5h3c.3 0 .5.2.5.5v3c0 .3-.2.5-.5.5h-3c-.3 0-.5-.2-.5-.5Z",clipRule:"evenodd"})),o=window.wp.i18n,r=window.wp.plugins,a=window.wp.editPost,l=window.wp.editor,d=window.wp.data,c=window.wp.components,h=window.prcHooks,p=window.wp.coreData,u=window.ReactJSXRuntime,m=(0,e.createContext)(),g=()=>(0,e.useContext)(m);function f({postId:t,postType:s,currentPostId:i,children:n}){const o=((t,s,i)=>{var n,o;const[r,a]=(0,p.useEntityProp)("postType",s,"meta",t),{canDelete:l,isResolving:d}=(0,p.useResourcePermissions)("posts",t),[c,u]=(0,e.useState)(null!==(n=r?.reportMaterials)&&void 0!==n?n:[]),[m,g]=(0,e.useState)(null!==(o=r?.multiSectionReport)&&void 0!==o?o:[]),f=(0,h.useDebounce)(c,500),v=(0,h.useDebounce)(m,500),x=(0,e.useMemo)((()=>!d&&!!l),[d,l]);(0,e.useEffect)((()=>{console.log("Materials...",t,r,c),x&&void 0!==r&&a({...r,reportMaterials:c})}),[f]),(0,e.useEffect)((()=>{console.log("Back Chapters...",m),x&&void 0!==r&&a({...r,multiSectionReport:m})}),[v]);const w=(e="materials")=>"materials"===e?[...c]:"backChapters"===e?[...m]:[];return{allowEditing:x,postId:t,currentPostId:i,postType:s,materials:c,backChapters:m,reorder:(e,t,s="materials")=>{if(!x)return;const i=w(s),n=i[e];i.splice(e,1),i.splice(t,0,n);let o=()=>console.log("reorder",e,t,s);"materials"===s?o=u:"backChapters"===s&&(o=g),o(i)},append:(e,t={},s="materials")=>{if(!x)return;const i=w(s),n={key:e};Object.assign(n,t),i.push(n);let o=()=>console.log("append",e,t,n,s);"materials"===s?o=u:"backChapters"===s&&(o=g),o(i)},remove:(e,t="materials")=>{if(!x)return;const s=w(t);s.splice(e,1);let i=()=>console.log("remove",e,t);"materials"===t?i=u:"backChapters"===t&&(i=g),i(s)},updateItem:(e,t,s,i="materials")=>{if(!x)return;console.log("updateItem",e,t,s,i,x,d,l);const n=w(i);n[e][t]=s;let o=()=>console.log("updateItem",e,t,s,i);"materials"===i?o=u:"backChapters"===i&&(o=g),o(n)}}})(t,s,i);return(0,u.jsx)(m.Provider,{value:o,children:n})}const v=window.ReactDOM;function x(e){const t=window.getComputedStyle(e);return Math.max(parseInt(t["margin-top"],10),parseInt(t["margin-bottom"],10))+e.getBoundingClientRect().height}function w(e,t=0,s=0){e&&(null!==t&&null!==s?e.style.transform=`translate(${s}px, ${t}px)`:e.style.removeProperty("transform"))}function b(e,t,s){e&&(e.style.transition=`transform ${t}ms${s?` ${s}`:""}`)}const C=e=>{let t=[],s=null;const i=(...i)=>{t=i,s||(s=requestAnimationFrame((()=>{s=null,e(...t)})))};return i.cancel=()=>{s&&cancelAnimationFrame(s)},i};function I(e,t){const s=["input","textarea","select","option","optgroup","video","audio","button","a"],i=["button","link","checkbox","tab"];for(;e!==t;){if(e.getAttribute("data-movable-handle"))return!1;if(s.includes(e.tagName.toLowerCase()))return!0;const t=e.getAttribute("role");if(t&&i.includes(t.toLowerCase()))return!0;if("label"===e.tagName.toLowerCase()&&e.hasAttribute("for"))return!0;e.tagName&&(e=e.parentElement)}return!1}const y=200,O=10,j=10;class S extends s.Component{constructor(e){super(e),this.listRef=s.createRef(),this.ghostRef=s.createRef(),this.topOffsets=[],this.itemTranslateOffsets=[],this.initialYOffset=0,this.lastScroll=0,this.lastYOffset=0,this.lastListYOffset=0,this.needle=-1,this.afterIndex=-2,this.state={itemDragged:-1,itemDraggedOutOfBounds:-1,selectedItem:-1,initialX:0,initialY:0,targetX:0,targetY:0,targetHeight:0,targetWidth:0,liveText:"",scrollingSpeed:0,scrollWindow:!1},this.doScrolling=()=>{const{scrollingSpeed:e,scrollWindow:t}=this.state,s=this.listRef.current;window.requestAnimationFrame((()=>{t?window.scrollTo(window.pageXOffset,window.pageYOffset+1.5*e):s.scrollTop+=e,0!==e&&this.doScrolling()}))},this.getChildren=()=>this.listRef&&this.listRef.current?Array.from(this.listRef.current.children):(console.warn("No items found in the List container. Did you forget to pass & spread the `props` param in renderList?"),[]),this.calculateOffsets=()=>{this.topOffsets=this.getChildren().map((e=>e.getBoundingClientRect().top)),this.itemTranslateOffsets=this.getChildren().map((e=>x(e)))},this.getTargetIndex=e=>this.getChildren().findIndex((t=>t===e.target||t.contains(e.target))),this.onMouseOrTouchStart=e=>{this.dropTimeout&&this.state.itemDragged>-1&&(window.clearTimeout(this.dropTimeout),this.finishDrop());const t=(s=e).touches&&s.touches.length||s.changedTouches&&s.changedTouches.length;var s;if(!t&&0!==e.button)return;const i=this.getTargetIndex(e);if(-1===i||this.props.values[i]&&this.props.values[i].disabled)return void(-1!==this.state.selectedItem&&(this.setState({selectedItem:-1}),this.finishDrop()));const n=this.getChildren()[i],o=n.querySelector("[data-movable-handle]");if((!o||o.contains(e.target))&&!I(e.target,n)){if(e.preventDefault(),this.props.beforeDrag&&this.props.beforeDrag({elements:this.getChildren(),index:i}),t){const e={passive:!1};n.style.touchAction="none",document.addEventListener("touchend",this.schdOnEnd,e),document.addEventListener("touchmove",this.schdOnTouchMove,e),document.addEventListener("touchcancel",this.schdOnEnd,e)}else{document.addEventListener("mousemove",this.schdOnMouseMove),document.addEventListener("mouseup",this.schdOnEnd);const e=this.getChildren()[this.state.itemDragged];e&&e.style&&(e.style.touchAction="")}this.onStart(n,t?e.touches[0].clientX:e.clientX,t?e.touches[0].clientY:e.clientY,i)}},this.getYOffset=()=>{const e=this.listRef.current?this.listRef.current.scrollTop:0;return window.pageYOffset+e},this.onStart=(e,t,s,i)=>{this.state.selectedItem>-1&&(this.setState({selectedItem:-1}),this.needle=-1);const n=e.getBoundingClientRect(),o=window.getComputedStyle(e);this.calculateOffsets(),this.initialYOffset=this.getYOffset(),this.lastYOffset=window.pageYOffset,this.lastListYOffset=this.listRef.current.scrollTop,this.setState({itemDragged:i,targetX:n.left-parseInt(o["margin-left"],10),targetY:n.top-parseInt(o["margin-top"],10),targetHeight:n.height,targetWidth:n.width,initialX:t,initialY:s})},this.onMouseMove=e=>{e.cancelable&&e.preventDefault(),this.onMove(e.clientX,e.clientY)},this.onTouchMove=e=>{e.cancelable&&e.preventDefault(),this.onMove(e.touches[0].clientX,e.touches[0].clientY)},this.onWheel=e=>{this.state.itemDragged<0||(this.lastScroll=this.listRef.current.scrollTop+=e.deltaY,this.moveOtherItems())},this.onMove=(e,t)=>{if(-1===this.state.itemDragged)return null;w(this.ghostRef.current,t-this.state.initialY,this.props.lockVertically?0:e-this.state.initialX),this.autoScrolling(t,t-this.state.initialY),this.moveOtherItems()},this.moveOtherItems=()=>{const e=this.ghostRef.current.getBoundingClientRect(),t=e.top+e.height/2,s=x(this.getChildren()[this.state.itemDragged]),i=this.getYOffset();this.initialYOffset!==i&&(this.topOffsets=this.topOffsets.map((e=>e-(i-this.initialYOffset))),this.initialYOffset=i),this.isDraggedItemOutOfBounds()&&this.props.removableByMove?this.afterIndex=this.topOffsets.length+1:this.afterIndex=function(e,t){let s,i=0,n=e.length-1;for(;i<=n;){if(s=Math.floor((n+i)/2),!e[s+1]||e[s]<=t&&e[s+1]>=t)return s;e[s]<t&&e[s+1]<t?i=s+1:n=s-1}return-1}(this.topOffsets,t),this.animateItems(-1===this.afterIndex?0:this.afterIndex,this.state.itemDragged,s)},this.autoScrolling=(e,t)=>{const{top:s,bottom:i,height:n}=this.listRef.current.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight;if(i>o&&o-e<y&&t>j)this.setState({scrollingSpeed:Math.min(Math.round((y-(o-e))/O),Math.round((t-j)/O)),scrollWindow:!0});else if(s<0&&e<y&&t<-10)this.setState({scrollingSpeed:Math.max(Math.round((y-e)/-10),Math.round((t+j)/O)),scrollWindow:!0});else if(this.state.scrollWindow&&0!==this.state.scrollingSpeed&&this.setState({scrollingSpeed:0,scrollWindow:!1}),n+20<this.listRef.current.scrollHeight){let n=0;e-s<y&&t<-10?n=Math.max(Math.round((y-(e-s))/-10),Math.round((t+j)/O)):i-e<y&&t>j&&(n=Math.min(Math.round((y-(i-e))/O),Math.round((t-j)/O))),this.state.scrollingSpeed!==n&&this.setState({scrollingSpeed:n})}},this.animateItems=(e,t,s,i=!1)=>{this.getChildren().forEach(((n,o)=>{if(b(n,this.props.transitionDuration),t===o&&i){if(t===e)return w(n,null);w(n,t<e?this.itemTranslateOffsets.slice(t+1,e+1).reduce(((e,t)=>e+t),0):-1*this.itemTranslateOffsets.slice(e,t).reduce(((e,t)=>e+t),0))}else w(n,t<e&&o>t&&o<=e?-s:o<t&&t>e&&o>=e?s:null)}))},this.isDraggedItemOutOfBounds=()=>{const e=this.getChildren()[this.state.itemDragged].getBoundingClientRect(),t=this.ghostRef.current.getBoundingClientRect();return Math.abs(e.left-t.left)>t.width?(-1===this.state.itemDraggedOutOfBounds&&this.setState({itemDraggedOutOfBounds:this.state.itemDragged}),!0):(this.state.itemDraggedOutOfBounds>-1&&this.setState({itemDraggedOutOfBounds:-1}),!1)},this.onEnd=e=>{e.cancelable&&e.preventDefault(),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchup",this.schdOnEnd),document.removeEventListener("touchcancel",this.schdOnEnd);const t=this.props.removableByMove&&this.isDraggedItemOutOfBounds();!t&&this.props.transitionDuration>0&&-2!==this.afterIndex&&C((()=>{b(this.ghostRef.current,this.props.transitionDuration,"cubic-bezier(.2,1,.1,1)"),this.afterIndex<1&&0===this.state.itemDragged?w(this.ghostRef.current,0,0):w(this.ghostRef.current,-(window.pageYOffset-this.lastYOffset)-(this.listRef.current.scrollTop-this.lastListYOffset)+(this.state.itemDragged<this.afterIndex?this.itemTranslateOffsets.slice(this.state.itemDragged+1,this.afterIndex+1).reduce(((e,t)=>e+t),0):-1*this.itemTranslateOffsets.slice(this.afterIndex<0?0:this.afterIndex,this.state.itemDragged).reduce(((e,t)=>e+t),0)),0)}))(),this.dropTimeout=window.setTimeout(this.finishDrop,t||-2===this.afterIndex?0:this.props.transitionDuration)},this.finishDrop=()=>{const e=this.props.removableByMove&&this.isDraggedItemOutOfBounds();(e||this.afterIndex>-2&&this.state.itemDragged!==this.afterIndex)&&this.props.onChange({oldIndex:this.state.itemDragged,newIndex:e?-1:Math.max(this.afterIndex,0),targetRect:this.ghostRef.current.getBoundingClientRect()}),this.getChildren().forEach((e=>{b(e,0),w(e,null),e.style.touchAction=""})),this.setState({itemDragged:-1,scrollingSpeed:0}),this.afterIndex=-2,this.lastScroll>0&&(this.listRef.current.scrollTop=this.lastScroll,this.lastScroll=0)},this.onKeyDown=e=>{const t=this.state.selectedItem,s=this.getTargetIndex(e);if(!I(e.target,e.currentTarget)&&-1!==s){if(" "===e.key&&(e.preventDefault(),t===s?(t!==this.needle&&(this.getChildren().forEach((e=>{b(e,0),w(e,null)})),this.props.onChange({oldIndex:t,newIndex:this.needle,targetRect:this.getChildren()[this.needle].getBoundingClientRect()}),this.getChildren()[this.needle].focus()),this.setState({selectedItem:-1,liveText:this.props.voiceover.dropped(t+1,this.needle+1)}),this.needle=-1):(this.setState({selectedItem:s,liveText:this.props.voiceover.lifted(s+1)}),this.needle=s,this.calculateOffsets())),("ArrowDown"===e.key||"j"===e.key)&&t>-1&&this.needle<this.props.values.length-1){e.preventDefault();const s=x(this.getChildren()[t]);this.needle++,this.animateItems(this.needle,t,s,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!1)})}if(("ArrowUp"===e.key||"k"===e.key)&&t>-1&&this.needle>0){e.preventDefault();const s=x(this.getChildren()[t]);this.needle--,this.animateItems(this.needle,t,s,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!0)})}"Escape"===e.key&&t>-1&&(this.getChildren().forEach((e=>{b(e,0),w(e,null)})),this.setState({selectedItem:-1,liveText:this.props.voiceover.canceled(t+1)}),this.needle=-1),("Tab"===e.key||"Enter"===e.key)&&t>-1&&e.preventDefault()}},this.schdOnMouseMove=C(this.onMouseMove),this.schdOnTouchMove=C(this.onTouchMove),this.schdOnEnd=C(this.onEnd)}componentDidMount(){this.calculateOffsets(),document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1,capture:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart)}componentDidUpdate(e,t){t.scrollingSpeed!==this.state.scrollingSpeed&&0===t.scrollingSpeed&&this.doScrolling()}componentWillUnmount(){document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mousedown",this.onMouseOrTouchStart),this.dropTimeout&&window.clearTimeout(this.dropTimeout),this.schdOnMouseMove.cancel(),this.schdOnTouchMove.cancel(),this.schdOnEnd.cancel()}render(){const e={userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",boxSizing:"border-box",position:"relative"},t={...e,top:this.state.targetY,left:this.state.targetX,width:this.state.targetWidth,height:this.state.targetHeight,position:"fixed",marginTop:0};return s.createElement(s.Fragment,null,this.props.renderList({children:this.props.values.map(((t,s)=>{const i=s===this.state.itemDragged,n=s===this.state.selectedItem,o={key:s,tabIndex:this.props.values[s]&&this.props.values[s].disabled?-1:0,"aria-roledescription":this.props.voiceover.item(s+1),onKeyDown:this.onKeyDown,style:{...e,visibility:i?"hidden":void 0,zIndex:n?5e3:0}};return this.props.renderItem({value:t,props:o,index:s,isDragged:!1,isSelected:n,isOutOfBounds:!1})})),isDragged:this.state.itemDragged>-1,props:{ref:this.listRef}}),this.state.itemDragged>-1&&v.createPortal(this.props.renderItem({value:this.props.values[this.state.itemDragged],props:{ref:this.ghostRef,style:t,onWheel:this.onWheel},index:this.state.itemDragged,isDragged:!0,isSelected:!1,isOutOfBounds:this.state.itemDraggedOutOfBounds>-1}),this.props.container||document.body),s.createElement("div",{"aria-live":"assertive",role:"log","aria-atomic":"true",style:{position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0px",padding:"0px",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"}},this.state.liveText))}}S.defaultProps={transitionDuration:300,lockVertically:!1,removableByMove:!1,voiceover:{item:e=>`You are currently at a draggable item at position ${e}. Press space bar to lift.`,lifted:e=>`You have lifted item at position ${e}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,moved:(e,t)=>`You have moved the lifted item ${t?"up":"down"} to position ${e}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,dropped:(e,t)=>`You have dropped the item. It has moved from position ${e} to ${t}.`,canceled:e=>`You have cancelled the movement. The item has returned to its starting position of ${e}.`}};const T=S;function D(){return`_${Math.random().toString(36).substr(2,9)}`}const k=window.wp.htmlEntities,R=(0,s.createElement)(i.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,s.createElement)(i.Path,{d:"M8 7h2V5H8v2zm0 6h2v-2H8v2zm0 6h2v-2H8v2zm6-14v2h2V5h-2zm0 8h2v-2h-2v2zm0 6h2v-2h-2v2z"}));function E({label:t,defaultLabel:s,keyValue:i,index:n,children:o,onRemove:r=!1,lastItem:a=!1,icon:l=!1}){const[d]=(0,p.useEntityProp)("postType","post","title",i),h=(0,e.useMemo)((()=>void 0===t&&void 0!==d&&""!==d?(0,k.decodeEntities)(d):void 0!==t&&""!==t?t:s),[d,t,s]);return(0,u.jsxs)("div",{style:{background:"white",paddingBottom:"1em",marginBottom:"1em",borderBottom:a?"none":"1px solid #EAEAEA"},children:[(0,u.jsxs)("div",{style:{display:"flex",flexDirection:"row",width:"100%",alignItems:"center"},children:[(0,u.jsx)("div",{style:{display:"flex"},children:(0,u.jsx)(c.Icon,{icon:R})}),(0,u.jsxs)("div",{style:{display:"flex",flexGrow:"1",paddingLeft:"1em"},children:[!1!==l&&{icon:l},(0,u.jsx)("span",{children:h})]}),(0,u.jsx)("div",{style:{display:"flex"},children:(0,u.jsx)(c.IconButton,{icon:"no-alt",onClick:()=>{!1!==r&&"function"==typeof r&&r()}})})]}),o]})}const M=(0,s.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,s.createElement)(i.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),B=(0,s.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,s.createElement)(i.Path,{d:"M19.5 4.5h-7V6h4.44l-5.97 5.97 1.06 1.06L18 7.06v4.44h1.5v-7Zm-13 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3H17v3a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h3V5.5h-3Z"}));function P({postId:e,currentPostId:t}){if(e===t)return null;const s=`/wp-admin/post.php?post=${e}&action=edit`,i=`/?p=${e}&preview=true`;return(0,u.jsxs)(c.ButtonGroup,{children:[(0,u.jsx)(c.Button,{variant:"link",size:"compact",href:s,target:"_blank",icon:M,label:(0,o.__)("Edit back chapter; opens in new tab"),showTooltip:!0,children:"Edit"}),(0,u.jsx)(c.Button,{variant:"link",size:"compact",href:i,target:"_blank",icon:B,label:(0,o.__)("Preview back chapter; opens in new tab"),showTooltip:!0,children:"Preview"})]})}const L=window.wp.url;function Y({toggleAddChildModal:e,parentTitle:t,childTitle:s,onDeny:i,onConfirm:n}){return(0,u.jsxs)(c.Modal,{title:(0,o.__)("Confirm Linking Child Post","prc-platform-post-report-package"),onRequestClose:()=>{e(!1)},children:[(0,u.jsxs)("p",{children:["Link ",(0,u.jsx)("strong",{children:(0,k.decodeEntities)(s)})," post to"," ",(0,u.jsx)("strong",{children:(0,k.decodeEntities)(t)}),"?"]}),(0,u.jsxs)(c.ButtonGroup,{children:[(0,u.jsx)(c.Button,{variant:"secondary",onClick:i,children:"No"}),(0,u.jsx)(c.Button,{variant:"primary",onClick:n,children:"Yes"})]})]})}function A({parentTitle:t,parentId:s,onDeny:i,onConfirm:n}){const{saveEntityRecord:r}=(0,d.useDispatch)(p.store),[a,l]=(0,e.useState)("");return(0,u.jsxs)(c.Modal,{title:(0,o.__)("Create New Draft Back Chapter","prc-platform-post-report-package"),onRequestClose:()=>{i()},children:[(0,u.jsxs)("p",{children:["Create a new draft back chapter for"," ",(0,u.jsx)("strong",{children:(0,k.decodeEntities)(t)}),"?"]}),(0,u.jsx)(c.TextControl,{label:(0,o.__)("Back Chapter Title","prc-platform-post-report-package"),value:a,onChange:l}),(0,u.jsxs)(c.ButtonGroup,{children:[(0,u.jsx)(c.Button,{variant:"secondary",onClick:i,children:"Cancel"}),(0,u.jsx)(c.Button,{variant:"primary",onClick:async()=>{const e=await r("postType","post",{title:a,status:"draft"});e&&(console.log("newDraftPost",e),n(e?.id))},disabled:3>a.length,children:"Create Draft"})]})]})}const _=({hocOnChange:t=!1})=>{const{parentTitle:s,parentId:i,getEntityRecord:n}=(0,d.useSelect)((e=>({parentTitle:e("core/editor").getEditedPostAttribute("title"),parentId:e("core/editor").getCurrentPostId(),getEntityRecord:e("core").getEntityRecord}))),[r,a]=(0,e.useState)(null),{record:l,isResolving:m}=(0,p.useEntityRecord)("postType","post",r,{enabled:null!==r}),[g,f]=(0,e.useState)(!1),[v,x]=(0,e.useState)(!1),[w,b]=(0,e.useState)(!1),[C,I]=(0,e.useState)(),[y,O]=(0,e.useState)(),[j,S]=(0,e.useState)(),T=(0,h.useDebounce)(y,1e3),[D,k]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{if(void 0!==T&&3<=T.length){console.log("postUrl",T);const e=(0,L.getQueryArg)(T,"post");a(e)}}),[T]),(0,e.useEffect)((()=>{void 0!==l&&!1===m&&(I(l?.title?.rendered),k(l),f(!0))}),[l,m]),(0,u.jsxs)(e.Fragment,{children:[(0,u.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,u.jsx)("div",{style:{flexGrow:"1"},children:(0,u.jsx)(c.SearchControl,{value:y,onChange:e=>{b(!0),O(e)},placeholder:(0,o.__)("Paste Back Chatper's edit (…/wp-admin/post.php?post=) url…","prc-platform-post-report-package"),autoComplete:"off"})}),(0,u.jsx)("div",{children:w&&(0,u.jsx)(c.Spinner,{})})]}),(0,u.jsx)(c.Button,{variant:"tertiary",onClick:()=>{x(!0)},children:(0,o.__)("Create New Draft","prc-platform-post-report-package")}),!0===v&&(0,u.jsx)(A,{parentTitle:s,parentId:i,onConfirm:e=>{console.log("CREATE DRAFT!",e),!1!==t&&t(e)},onDeny:()=>{x(!1)}}),!0===g&&(0,u.jsx)(Y,{toggleAddChildModal:f,parentTitle:s,childTitle:C,onConfirm:()=>{const{id:e}=D;f(!1),k(!1),!1!==t&&t(e)},onDeny:()=>{O(""),k(!1)}})]})};function V(){const t="backChapters",{backChapters:s,reorder:i,append:n,remove:o,updateItem:r,currentPostId:a}=g(),[l,d]=(0,e.useState)(!1);return(0,u.jsxs)(c.PanelBody,{title:"Back Chapters",children:[(0,u.jsx)(T,{lockVertically:!0,values:null!=s?s:[],onChange:({oldIndex:e,newIndex:s})=>i(e,s,t),renderList:({children:e,props:t})=>(0,u.jsx)("div",{...t,children:e}),renderItem:({value:e,props:s,index:i})=>(0,u.jsx)("div",{...s,children:(0,u.jsxs)(E,{defaultLabel:"Child Post",keyValue:e.postId,index:i,onRemove:()=>o(i,t),children:[null===e.postId&&(0,u.jsx)(_,{hocOnChange:e=>r(i,"postId",e,t)}),null!==e.postId&&(0,u.jsx)(P,{postId:e.postId,currentPostId:a})]},e.key)})}),(0,u.jsx)(c.Button,{variant:"primary",onClick:()=>n(D(),{postId:null},t),children:"Add Back Chapter"})]})}const $=window.wp.blockEditor,U=JSON.parse('{"options":[{"label":"--","value":null},{"label":"Detailed Table","value":"detailedTable"},{"label":"Link","value":"link"},{"label":"Presentation","value":"presentation"},{"label":"Press Release","value":"pressRelease"},{"label":"Promo","value":"promo"},{"label":"Q & A","value":"qA"},{"label":"Questionnaire","value":"questionnaire"},{"label":"Report PDF","value":"report"},{"label":"Supplemental","value":"supplemental"},{"label":"Topline","value":"topline"}]}'),H=({type:e=null,onChange:t,toggleVisibility:s})=>{const{options:i}=U;return(0,u.jsx)(c.Popover,{className:"prc-report-material-popover",noArrow:!1,placement:"left-start",onFocusOutside:()=>{s(!1)},children:(0,u.jsx)("div",{style:{padding:"0.6em",minWidth:"140px"},children:(0,u.jsx)(c.SelectControl,{label:"Type",value:e,options:i,onChange:t})})})},W=e=>{const{options:t}=U,s=t.find((t=>t.value===e));return void 0!==s?s.label:""},z=["image","application/pdf","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],F=({type:t,url:s,attachmentId:i,label:n,icon:r,index:a})=>{const l="materials",{allowEditing:d,updateItem:h,remove:p}=g(),[m,f]=(0,e.useState)(!1),v=({title:e,value:t})=>(0,u.jsx)($.MediaUploadCheck,{children:(0,u.jsx)($.MediaUpload,{title:(0,o.__)(""===t?`Upload ${e}`:`Change ${e}`),allowedTypes:z,value:t,onSelect:e=>{h(a,"url",e.url,l),h(a,"attachmentId",e.id,l)},render:({open:e})=>(0,u.jsx)(c.Button,{variant:"secondary",disabled:!d,onClick:e,children:(0,o.__)(null===t?"Upload File":"Change File")})})}),x=({title:e,value:t})=>(0,u.jsx)($.MediaUploadCheck,{children:(0,u.jsx)($.MediaUpload,{title:(0,o.__)(null===t?`Upload ${e}`:`Change ${e}`),value:t,onSelect:e=>{h(a,"icon",e.url,l),h(a,"attachmentId",e.id,l)},render:({open:e})=>(0,u.jsx)(c.Button,{variant:"secondary",disabled:!d,onClick:e,children:(0,o.__)(null===t?"Upload Icon":"Change Icon")})})});return(0,u.jsx)(E,{label:W(t),index:a,onRemove:()=>p(a,l),children:(0,u.jsxs)("div",{style:{paddingTop:"10px"},children:[["presentation","pressRelease"].includes(t)&&(0,u.jsx)(c.TextControl,{autoComplete:!1,label:"URL",value:s,onChange:e=>h(a,"url",e,l),disabled:!d}),["link","promo","qA","supplemental"].includes(t)&&(0,u.jsxs)(e.Fragment,{children:[(0,u.jsx)(c.TextControl,{autoComplete:!1,label:"Label",value:n,onChange:e=>h(a,"label",e,l),disabled:!d}),(0,u.jsx)(c.TextControl,{autoComplete:!1,label:"URL",value:s,onChange:e=>h(a,"url",e,l),disabled:!d}),"link"===t&&(0,u.jsx)(c.SelectControl,{label:"Icon",value:r,options:U?.options||[],onChange:e=>{console.log(e),h(a,"icon",e,l)},disabled:!d})]}),(0,u.jsxs)(c.ButtonGroup,{children:[["report","questionnaire","detailedTable","powerpoint","presentation","pressRelease","topline"].includes(t)&&(0,u.jsx)(v,{title:W(t),value:i}),"promo"===t&&(0,u.jsx)(x,{title:W(t),value:i}),(0,u.jsx)(c.Button,{variant:"secondary",onClick:()=>{f(!0)},disabled:!d,children:"Change Type"}),m&&(0,u.jsx)(H,{type:t,onChange:e=>{h(a,"type",e,l),["report","questionnaire","detailedTable","powerpoint","presentation","pressRelease","topline","pormo"].includes(e)&&h(a,"attachmentId",null,l),h(a,"url","",l),h(a,"label","",l),h(a,"icon","",l),f(!1)},toggleVisibility:f})]})]})})},X=function(){const[t,s]=(0,e.useState)(!1),i="materials",{materials:n,reorder:r,append:a,remove:l,updateItem:d,isResolving:h}=g();return(0,u.jsxs)(c.PanelBody,{title:"Materials",children:[(0,u.jsx)(T,{lockVertically:!0,values:null!=n?n:[],onChange:({oldIndex:e,newIndex:t})=>r(e,t,i),renderList:({children:e,props:t})=>(0,u.jsx)("div",{...t,children:e}),renderItem:({value:e,props:t,index:s})=>(0,u.jsx)("div",{...t,children:(0,u.jsx)(F,{type:e.type,url:e?.url,label:e?.label,icon:e?.icon,attachmentId:e?.attachmentId,index:s},e.key)})}),(0,u.jsx)(c.Button,{variant:"primary",onClick:()=>{s(!0)},children:(0,o.__)("Add Report Material")}),t&&(0,u.jsx)(H,{onChange:e=>{const t={type:e,url:"",label:W(e),icon:""};["report","questionnaire","detailedTable","powerpoint","presentation","pressRelease","topline","pormo"].includes(e)&&(t.attachmentId=null),a(D(),t,i),s(!1)},toggleVisibility:s})]})},q="prc-platform-post-report-package";(0,r.registerPlugin)(q,{render:function(){const{postType:s,postId:i,parentId:o,isChildPost:r}=(0,d.useSelect)((e=>{const t=e(l.store).getEditedPostAttribute("post_parent"),s=e(l.store).getCurrentPostType(),i=e(l.store).getCurrentPostId();return{postType:s,postId:i,parentId:0!==t?t:i,isChildPost:0!==t}}),[]);return(0,u.jsxs)(e.Fragment,{children:[(0,u.jsx)(a.PluginSidebar,{name:q,title:"Report Package",icon:(0,u.jsx)(t,{icon:n,size:16}),children:(0,u.jsxs)(f,{postType:s,postId:o,currentPostId:i,children:[(0,u.jsx)(X,{}),(0,u.jsx)(V,{})]})}),!r&&(0,u.jsx)(a.PluginPrePublishPanel,{children:(0,u.jsxs)(f,{postType:s,postId:o,currentPostId:i,children:[(0,u.jsx)("p",{children:"Please review the attached report materials:"}),(0,u.jsx)(X,{}),(0,u.jsx)("p",{children:"Please review the attached back chapter posts. These post's status will be updated to match the parent post on publish."}),(0,u.jsx)(V,{})]})})]})}})})();
//# sourceMappingURL=index.js.map