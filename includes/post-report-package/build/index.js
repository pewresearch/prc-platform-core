!function(){"use strict";var e=window.wp.element,t=window.wp.i18n,n=window.wp.plugins,s=window.wp.editPost,i=window.wp.editor,o=window.wp.data,r=window.wp.coreData;const a=(0,e.createContext)(),l=()=>(0,e.useContext)(a);function c({postId:t,postType:n,currentPostId:s,children:i}){const o=((t,n,s)=>{const[i,o]=(0,r.useEntityProp)("postType",n,"meta",t),{canDelete:a,isResolving:l}=(0,r.useResourcePermissions)("posts",t),c=(0,e.useMemo)((()=>!l&&!!a),[l,a]),{materials:d,setMaterials:h,backChapters:p,setBackChapters:u}=(0,e.useMemo)((()=>({materials:i?.reportMaterials,setMaterials(e){o({...i,reportMaterials:e})},backChapters:i?.multiSectionReport,setBackChapters(e){o({...i,multiSectionReport:e})}})),[i]),m=(e="materials")=>"materials"===e?[...d]:"backChapters"===e?[...p]:[];return{allowEditing:c,postId:t,currentPostId:s,postType:n,materials:d,backChapters:p,reorder:(e,t,n="materials")=>{if(!c)return;const s=m(n),i=s[e];s.splice(e,1),s.splice(t,0,i);let o=()=>console.log("reorder",e,t,n);"materials"===n?o=h:"backChapters"===n&&(o=u),o(s)},append:(e,t={},n="materials")=>{if(!c)return;const s=m(n),i={key:e};Object.assign(i,t),s.push(i);let o=()=>console.log("append",e,t,i,n);"materials"===n?o=h:"backChapters"===n&&(o=u),o(s)},remove:(e,t="materials")=>{if(!c)return;const n=m(t);n.splice(e,1);let s=()=>console.log("remove",e,t);"materials"===t?s=h:"backChapters"===t&&(s=u),s(n)},updateItem:(e,t,n,s="materials")=>{if(!c)return;const i=m(s);i[e][t]=n;let o=()=>console.log("updateItem",e,t,n,s);"materials"===s?o=h:"backChapters"===s&&(o=u),o(i)}}})(t,n,s);return(0,e.createElement)(a.Provider,{value:o},i)}var d=window.React,h=window.ReactDOM;function p(e){const t=window.getComputedStyle(e);return Math.max(parseInt(t["margin-top"],10),parseInt(t["margin-bottom"],10))+e.getBoundingClientRect().height}function u(e,t=0,n=0){e&&(null!==t&&null!==n?e.style.transform=`translate(${n}px, ${t}px)`:e.style.removeProperty("transform"))}function m(e,t,n){e&&(e.style.transition=`transform ${t}ms${n?` ${n}`:""}`)}const g=e=>{let t=[],n=null;const s=(...s)=>{t=s,n||(n=requestAnimationFrame((()=>{n=null,e(...t)})))};return s.cancel=()=>{n&&cancelAnimationFrame(n)},s};function f(e,t){const n=["input","textarea","select","option","optgroup","video","audio","button","a"],s=["button","link","checkbox","tab"];for(;e!==t;){if(e.getAttribute("data-movable-handle"))return!1;if(n.includes(e.tagName.toLowerCase()))return!0;const t=e.getAttribute("role");if(t&&s.includes(t.toLowerCase()))return!0;if("label"===e.tagName.toLowerCase()&&e.hasAttribute("for"))return!0;e.tagName&&(e=e.parentElement)}return!1}const v=200;class E extends d.Component{constructor(e){super(e),this.listRef=d.createRef(),this.ghostRef=d.createRef(),this.topOffsets=[],this.itemTranslateOffsets=[],this.initialYOffset=0,this.lastScroll=0,this.lastYOffset=0,this.lastListYOffset=0,this.needle=-1,this.afterIndex=-2,this.state={itemDragged:-1,itemDraggedOutOfBounds:-1,selectedItem:-1,initialX:0,initialY:0,targetX:0,targetY:0,targetHeight:0,targetWidth:0,liveText:"",scrollingSpeed:0,scrollWindow:!1},this.doScrolling=()=>{const{scrollingSpeed:e,scrollWindow:t}=this.state,n=this.listRef.current;window.requestAnimationFrame((()=>{t?window.scrollTo(window.pageXOffset,window.pageYOffset+1.5*e):n.scrollTop+=e,0!==e&&this.doScrolling()}))},this.getChildren=()=>this.listRef&&this.listRef.current?Array.from(this.listRef.current.children):(console.warn("No items found in the List container. Did you forget to pass & spread the `props` param in renderList?"),[]),this.calculateOffsets=()=>{this.topOffsets=this.getChildren().map((e=>e.getBoundingClientRect().top)),this.itemTranslateOffsets=this.getChildren().map((e=>p(e)))},this.getTargetIndex=e=>this.getChildren().findIndex((t=>t===e.target||t.contains(e.target))),this.onMouseOrTouchStart=e=>{this.dropTimeout&&this.state.itemDragged>-1&&(window.clearTimeout(this.dropTimeout),this.finishDrop());const t=(n=e).touches&&n.touches.length||n.changedTouches&&n.changedTouches.length;var n;if(!t&&0!==e.button)return;const s=this.getTargetIndex(e);if(-1===s||this.props.values[s]&&this.props.values[s].disabled)return void(-1!==this.state.selectedItem&&(this.setState({selectedItem:-1}),this.finishDrop()));const i=this.getChildren()[s],o=i.querySelector("[data-movable-handle]");if((!o||o.contains(e.target))&&!f(e.target,i)){if(e.preventDefault(),this.props.beforeDrag&&this.props.beforeDrag({elements:this.getChildren(),index:s}),t){const e={passive:!1};i.style.touchAction="none",document.addEventListener("touchend",this.schdOnEnd,e),document.addEventListener("touchmove",this.schdOnTouchMove,e),document.addEventListener("touchcancel",this.schdOnEnd,e)}else{document.addEventListener("mousemove",this.schdOnMouseMove),document.addEventListener("mouseup",this.schdOnEnd);const e=this.getChildren()[this.state.itemDragged];e&&e.style&&(e.style.touchAction="")}this.onStart(i,t?e.touches[0].clientX:e.clientX,t?e.touches[0].clientY:e.clientY,s)}},this.getYOffset=()=>{const e=this.listRef.current?this.listRef.current.scrollTop:0;return window.pageYOffset+e},this.onStart=(e,t,n,s)=>{this.state.selectedItem>-1&&(this.setState({selectedItem:-1}),this.needle=-1);const i=e.getBoundingClientRect(),o=window.getComputedStyle(e);this.calculateOffsets(),this.initialYOffset=this.getYOffset(),this.lastYOffset=window.pageYOffset,this.lastListYOffset=this.listRef.current.scrollTop,this.setState({itemDragged:s,targetX:i.left-parseInt(o["margin-left"],10),targetY:i.top-parseInt(o["margin-top"],10),targetHeight:i.height,targetWidth:i.width,initialX:t,initialY:n})},this.onMouseMove=e=>{e.cancelable&&e.preventDefault(),this.onMove(e.clientX,e.clientY)},this.onTouchMove=e=>{e.cancelable&&e.preventDefault(),this.onMove(e.touches[0].clientX,e.touches[0].clientY)},this.onWheel=e=>{this.state.itemDragged<0||(this.lastScroll=this.listRef.current.scrollTop+=e.deltaY,this.moveOtherItems())},this.onMove=(e,t)=>{if(-1===this.state.itemDragged)return null;u(this.ghostRef.current,t-this.state.initialY,this.props.lockVertically?0:e-this.state.initialX),this.autoScrolling(t),this.moveOtherItems()},this.moveOtherItems=()=>{const e=this.ghostRef.current.getBoundingClientRect(),t=e.top+e.height/2,n=p(this.getChildren()[this.state.itemDragged]),s=this.getYOffset();this.initialYOffset!==s&&(this.topOffsets=this.topOffsets.map((e=>e-(s-this.initialYOffset))),this.initialYOffset=s),this.isDraggedItemOutOfBounds()&&this.props.removableByMove?this.afterIndex=this.topOffsets.length+1:this.afterIndex=function(e,t){let n,s=0,i=e.length-1;for(;s<=i;){if(n=Math.floor((i+s)/2),!e[n+1]||e[n]<=t&&e[n+1]>=t)return n;e[n]<t&&e[n+1]<t?s=n+1:i=n-1}return-1}(this.topOffsets,t),this.animateItems(-1===this.afterIndex?0:this.afterIndex,this.state.itemDragged,n)},this.autoScrolling=e=>{const{top:t,bottom:n,height:s}=this.listRef.current.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight;if(n>i&&i-e<v)this.setState({scrollingSpeed:Math.round((v-(i-e))/10),scrollWindow:!0});else if(t<0&&e<v)this.setState({scrollingSpeed:Math.round((v-e)/-10),scrollWindow:!0});else if(this.state.scrollWindow&&0!==this.state.scrollingSpeed&&this.setState({scrollingSpeed:0,scrollWindow:!1}),s+20<this.listRef.current.scrollHeight){let s=0;e-t<v?s=Math.round((v-(e-t))/-10):n-e<v&&(s=Math.round((v-(n-e))/10)),this.state.scrollingSpeed!==s&&this.setState({scrollingSpeed:s})}},this.animateItems=(e,t,n,s=!1)=>{this.getChildren().forEach(((i,o)=>{if(m(i,this.props.transitionDuration),t===o&&s){if(t===e)return u(i,null);u(i,t<e?this.itemTranslateOffsets.slice(t+1,e+1).reduce(((e,t)=>e+t),0):-1*this.itemTranslateOffsets.slice(e,t).reduce(((e,t)=>e+t),0))}else u(i,t<e&&o>t&&o<=e?-n:o<t&&t>e&&o>=e?n:null)}))},this.isDraggedItemOutOfBounds=()=>{const e=this.getChildren()[this.state.itemDragged].getBoundingClientRect(),t=this.ghostRef.current.getBoundingClientRect();return Math.abs(e.left-t.left)>t.width?(-1===this.state.itemDraggedOutOfBounds&&this.setState({itemDraggedOutOfBounds:this.state.itemDragged}),!0):(this.state.itemDraggedOutOfBounds>-1&&this.setState({itemDraggedOutOfBounds:-1}),!1)},this.onEnd=e=>{e.cancelable&&e.preventDefault(),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchup",this.schdOnEnd),document.removeEventListener("touchcancel",this.schdOnEnd);const t=this.props.removableByMove&&this.isDraggedItemOutOfBounds();!t&&this.props.transitionDuration>0&&-2!==this.afterIndex&&g((()=>{m(this.ghostRef.current,this.props.transitionDuration,"cubic-bezier(.2,1,.1,1)"),this.afterIndex<1&&0===this.state.itemDragged?u(this.ghostRef.current,0,0):u(this.ghostRef.current,-(window.pageYOffset-this.lastYOffset)-(this.listRef.current.scrollTop-this.lastListYOffset)+(this.state.itemDragged<this.afterIndex?this.itemTranslateOffsets.slice(this.state.itemDragged+1,this.afterIndex+1).reduce(((e,t)=>e+t),0):-1*this.itemTranslateOffsets.slice(this.afterIndex<0?0:this.afterIndex,this.state.itemDragged).reduce(((e,t)=>e+t),0)),0)}))(),this.dropTimeout=window.setTimeout(this.finishDrop,t||-2===this.afterIndex?0:this.props.transitionDuration)},this.finishDrop=()=>{const e=this.props.removableByMove&&this.isDraggedItemOutOfBounds();(e||this.afterIndex>-2&&this.state.itemDragged!==this.afterIndex)&&this.props.onChange({oldIndex:this.state.itemDragged,newIndex:e?-1:Math.max(this.afterIndex,0),targetRect:this.ghostRef.current.getBoundingClientRect()}),this.getChildren().forEach((e=>{m(e,0),u(e,null),e.style.touchAction=""})),this.setState({itemDragged:-1,scrollingSpeed:0}),this.afterIndex=-2,this.lastScroll>0&&(this.listRef.current.scrollTop=this.lastScroll,this.lastScroll=0)},this.onKeyDown=e=>{const t=this.state.selectedItem,n=this.getTargetIndex(e);if(!f(e.target,e.currentTarget)&&-1!==n){if(" "===e.key&&(e.preventDefault(),t===n?(t!==this.needle&&(this.getChildren().forEach((e=>{m(e,0),u(e,null)})),this.props.onChange({oldIndex:t,newIndex:this.needle,targetRect:this.getChildren()[this.needle].getBoundingClientRect()}),this.getChildren()[this.needle].focus()),this.setState({selectedItem:-1,liveText:this.props.voiceover.dropped(t+1,this.needle+1)}),this.needle=-1):(this.setState({selectedItem:n,liveText:this.props.voiceover.lifted(n+1)}),this.needle=n,this.calculateOffsets())),("ArrowDown"===e.key||"j"===e.key)&&t>-1&&this.needle<this.props.values.length-1){e.preventDefault();const n=p(this.getChildren()[t]);this.needle++,this.animateItems(this.needle,t,n,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!1)})}if(("ArrowUp"===e.key||"k"===e.key)&&t>-1&&this.needle>0){e.preventDefault();const n=p(this.getChildren()[t]);this.needle--,this.animateItems(this.needle,t,n,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!0)})}"Escape"===e.key&&t>-1&&(this.getChildren().forEach((e=>{m(e,0),u(e,null)})),this.setState({selectedItem:-1,liveText:this.props.voiceover.canceled(t+1)}),this.needle=-1),("Tab"===e.key||"Enter"===e.key)&&t>-1&&e.preventDefault()}},this.schdOnMouseMove=g(this.onMouseMove),this.schdOnTouchMove=g(this.onTouchMove),this.schdOnEnd=g(this.onEnd)}componentDidMount(){this.calculateOffsets(),document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1,capture:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart)}componentDidUpdate(e,t){t.scrollingSpeed!==this.state.scrollingSpeed&&0===t.scrollingSpeed&&this.doScrolling()}componentWillUnmount(){document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mousedown",this.onMouseOrTouchStart),this.dropTimeout&&window.clearTimeout(this.dropTimeout),this.schdOnMouseMove.cancel(),this.schdOnTouchMove.cancel(),this.schdOnEnd.cancel()}render(){const e={userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",boxSizing:"border-box",position:"relative"},t={...e,top:this.state.targetY,left:this.state.targetX,width:this.state.targetWidth,height:this.state.targetHeight,position:"fixed",marginTop:0};return d.createElement(d.Fragment,null,this.props.renderList({children:this.props.values.map(((t,n)=>{const s=n===this.state.itemDragged,i=n===this.state.selectedItem,o={key:n,tabIndex:this.props.values[n]&&this.props.values[n].disabled?-1:0,"aria-roledescription":this.props.voiceover.item(n+1),onKeyDown:this.onKeyDown,style:{...e,visibility:s?"hidden":void 0,zIndex:i?5e3:0}};return this.props.renderItem({value:t,props:o,index:n,isDragged:!1,isSelected:i,isOutOfBounds:!1})})),isDragged:this.state.itemDragged>-1,props:{ref:this.listRef}}),this.state.itemDragged>-1&&h.createPortal(this.props.renderItem({value:this.props.values[this.state.itemDragged],props:{ref:this.ghostRef,style:t,onWheel:this.onWheel},index:this.state.itemDragged,isDragged:!0,isSelected:!1,isOutOfBounds:this.state.itemDraggedOutOfBounds>-1}),this.props.container||document.body),d.createElement("div",{"aria-live":"assertive",role:"log","aria-atomic":"true",style:{position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0px",padding:"0px",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"}},this.state.liveText))}}E.defaultProps={transitionDuration:300,lockVertically:!1,removableByMove:!1,voiceover:{item:e=>`You are currently at a draggable item at position ${e}. Press space bar to lift.`,lifted:e=>`You have lifted item at position ${e}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,moved:(e,t)=>`You have moved the lifted item ${t?"up":"down"} to position ${e}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,dropped:(e,t)=>`You have dropped the item. It has moved from position ${e} to ${t}.`,canceled:e=>`You have cancelled the movement. The item has returned to its starting position of ${e}.`}};var w=E,C=window.wp.components;function b(){return`_${Math.random().toString(36).substr(2,9)}`}var y=window.wp.htmlEntities,I=window.wp.primitives,x=(0,e.createElement)(I.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(I.Path,{d:"M8 7h2V5H8v2zm0 6h2v-2H8v2zm0 6h2v-2H8v2zm6-14v2h2V5h-2zm0 8h2v-2h-2v2zm0 6h2v-2h-2v2z"}));function O({label:t,defaultLabel:n,keyValue:s,index:i,children:o,onRemove:a=!1,lastItem:l=!1,icon:c=!1}){const[d]=(0,r.useEntityProp)("postType","post","title",s),h=(0,e.useMemo)((()=>void 0===t&&void 0!==d&&""!==d?(0,y.decodeEntities)(d):void 0!==t&&""!==t?t:n),[d,t,n]);return(0,e.createElement)("div",{style:{background:"white",paddingBottom:"1em",marginBottom:"1em",borderBottom:l?"none":"1px solid #EAEAEA"}},(0,e.createElement)("div",{style:{display:"flex",flexDirection:"row",width:"100%",alignItems:"center"}},(0,e.createElement)("div",{style:{display:"flex"}},(0,e.createElement)(C.Icon,{icon:x})),(0,e.createElement)("div",{style:{display:"flex",flexGrow:"1",paddingLeft:"1em"}},!1!==c&&{icon:c},(0,e.createElement)("span",null,h)),(0,e.createElement)("div",{style:{display:"flex"}},(0,e.createElement)(C.IconButton,{icon:"no-alt",onClick:()=>{!1!==a&&"function"==typeof a&&a()}}))),o)}var T=window.prcHooks,S=window.wp.url;function k({toggleAddChildModal:n,parentTitle:s,childTitle:i,onDeny:o,onConfirm:r}){return(0,e.createElement)(C.Modal,{title:(0,t.__)("Confirm Linking Child Post","prc-platform-post-report-package"),onRequestClose:()=>{n(!1)}},(0,e.createElement)("p",null,"Link ",(0,e.createElement)("strong",null,(0,y.decodeEntities)(i))," post to ",(0,e.createElement)("strong",null,(0,y.decodeEntities)(s)),"?"),(0,e.createElement)(C.ButtonGroup,null,(0,e.createElement)(C.Button,{variant:"secondary",onClick:o},"No"),(0,e.createElement)(C.Button,{variant:"primary",onClick:r},"Yes")))}function D({parentTitle:n,parentId:s,onDeny:i,onConfirm:a}){const{saveEntityRecord:l}=(0,o.useDispatch)(r.store),[c,d]=(0,e.useState)("");return(0,e.createElement)(C.Modal,{title:(0,t.__)("Create New Draft Back Chapter","prc-platform-post-report-package"),onRequestClose:()=>{i()}},(0,e.createElement)("p",null,"Create a new draft back chapter for ",(0,e.createElement)("strong",null,(0,y.decodeEntities)(n)),"?"),(0,e.createElement)(C.TextControl,{label:(0,t.__)("Back Chapter Title","prc-platform-post-report-package"),value:c,onChange:d}),(0,e.createElement)(C.ButtonGroup,null,(0,e.createElement)(C.Button,{variant:"secondary",onClick:i},"Cancel"),(0,e.createElement)(C.Button,{variant:"primary",onClick:async()=>{const e=await l("postType","post",{title:c,status:"draft"});e&&(console.log("newDraftPost",e),a(e?.id))},disabled:3>c.length},"Create Draft")))}var R=({hocOnChange:n=!1})=>{const{parentTitle:s,parentId:i,getEntityRecord:a}=(0,o.useSelect)((e=>({parentTitle:e("core/editor").getEditedPostAttribute("title"),parentId:e("core/editor").getCurrentPostId(),getEntityRecord:e("core").getEntityRecord}))),[l,c]=(0,e.useState)(null),{record:d,isResolving:h}=(0,r.useEntityRecord)("postType","post",l,{enabled:null!==l}),[p,u]=(0,e.useState)(!1),[m,g]=(0,e.useState)(!1),[f,v]=(0,e.useState)(!1),[E,w]=(0,e.useState)(),[b,y]=(0,e.useState)(),[I,x]=(0,e.useState)(),O=(0,T.useDebounce)(b,1e3),[R,M]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{if(void 0!==O&&3<=O.length){console.log("postUrl",O);const e=(0,S.getQueryArg)(O,"post");c(e)}}),[O]),(0,e.useEffect)((()=>{void 0!==d&&!1===h&&(w(d?.title?.rendered),M(d),u(!0))}),[d,h]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.createElement)("div",{style:{flexGrow:"1"}},(0,e.createElement)(C.SearchControl,{value:b,onChange:e=>{v(!0),y(e)},placeholder:(0,t.__)("Paste Back Chatper's edit (.../wp-admin/post.php?post=) url...","prc-platform-post-report-package"),autoComplete:"off"})),(0,e.createElement)("div",null,f&&(0,e.createElement)(C.Spinner,null))),(0,e.createElement)(C.Button,{variant:"tertiary",onClick:()=>{g(!0)}},(0,t.__)("Create New Draft","prc-platform-post-report-package")),!0===m&&(0,e.createElement)(D,{parentTitle:s,parentId:i,onConfirm:e=>{console.log("CREATE DRAFT!",e),!1!==n&&n(e)},onDeny:()=>{g(!1)}}),!0===p&&(0,e.createElement)(k,{toggleAddChildModal:u,parentTitle:s,childTitle:E,onConfirm:()=>{const{id:e}=R;u(!1),M(!1),!1!==n&&n(e)},onDeny:()=>{}}))},M=(0,e.createElement)(I.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(I.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),B=(0,e.createElement)(I.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(I.Path,{d:"M18.2 17c0 .7-.6 1.2-1.2 1.2H7c-.7 0-1.2-.6-1.2-1.2V7c0-.7.6-1.2 1.2-1.2h3.2V4.2H7C5.5 4.2 4.2 5.5 4.2 7v10c0 1.5 1.2 2.8 2.8 2.8h10c1.5 0 2.8-1.2 2.8-2.8v-3.6h-1.5V17zM14.9 3v1.5h3.7l-6.4 6.4 1.1 1.1 6.4-6.4v3.7h1.5V3h-6.3z"}));function P({postId:n,currentPostId:s}){return console.log("ExistingBackChapterToolbar",n,s),n===s?null:(0,e.createElement)(C.ButtonGroup,null,(0,e.createElement)(C.Button,{variant:"link",size:"compact",href:`/pewresearch-org/wp-admin/post.php?post=${n}&action=edit`,target:"_blank",icon:M,label:(0,t.__)("Edit back chapter; opens in new tab"),showTooltip:!0,shortcut:"e"},"Edit"),(0,e.createElement)(C.Button,{variant:"link",size:"compact",href:"www.google.com",target:"_blank",icon:B,label:(0,t.__)("Preview back chapter; opens in new tab"),showTooltip:!0,shortcut:"p"},"Preview"))}function L(){const t="backChapters",{backChapters:n,reorder:s,append:i,remove:o,updateItem:r,currentPostId:a}=l();return(0,e.createElement)(C.PanelBody,{title:"Back Chapters"},(0,e.createElement)(w,{lockVertically:!0,values:null!=n?n:[],onChange:({oldIndex:e,newIndex:n})=>s(e,n,t),renderList:({children:t,props:n})=>(0,e.createElement)("div",{...n},t),renderItem:({value:n,props:s,index:i})=>(0,e.createElement)("div",{...s},(0,e.createElement)(O,{key:n.key,defaultLabel:"Child Post",keyValue:n.postId,index:i,onRemove:()=>o(i,t)},null===n.postId&&(0,e.createElement)(R,{hocOnChange:e=>r(i,"postId",e,t)}),null!==n.postId&&(0,e.createElement)(P,{postId:n.postId,currentPostId:a})))}),(0,e.createElement)(C.Button,{variant:"primary",onClick:()=>i(b(),{postId:null},t)},"Add Back Chapter"))}var Y=window.wp.blockEditor,A=JSON.parse('{"options":[{"label":"--","value":null},{"label":"Detailed Table","value":"detailedTable"},{"label":"Link","value":"link"},{"label":"Presentation","value":"presentation"},{"label":"Press Release","value":"pressRelease"},{"label":"Promo","value":"promo"},{"label":"Q & A","value":"qA"},{"label":"Questionnaire","value":"questionnaire"},{"label":"Report PDF","value":"report"},{"label":"Supplemental","value":"supplemental"},{"label":"Topline","value":"topline"}]}');const _=({type:t=null,onChange:n,toggleVisibility:s})=>{const{options:i}=A;return(0,e.createElement)(C.Popover,{className:"prc-report-material-popover",noArrow:!1,placement:"left-start",onFocusOutside:()=>{s(!1)}},(0,e.createElement)("div",{style:{padding:"0.6em",minWidth:"140px"}},(0,e.createElement)(C.SelectControl,{label:"Type",value:t,options:i,onChange:n})))},V=e=>{const{options:t}=A,n=t.find((t=>t.value===e));return void 0!==n?n.label:""},$=["image","application/pdf","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];var U=({type:n,url:s,attachmentId:i,label:o,icon:r,index:a})=>{const c="materials",{allowEditing:d,updateItem:h,remove:p}=l(),[u,m]=(0,e.useState)(!1);return(0,e.createElement)(O,{label:V(n),index:a,onRemove:()=>p(a,c)},(0,e.createElement)("div",{style:{paddingTop:"10px"}},["presentation","pressRelease"].includes(n)&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(C.TextControl,{autoComplete:!1,label:"URL",value:s,onChange:e=>h(a,"url",e,c),disabled:!d})),["link","promo","qA","supplemental"].includes(n)&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(C.TextControl,{autoComplete:!1,label:"Label",value:o,onChange:e=>h(a,"label",e,c),disabled:!d}),(0,e.createElement)(C.TextControl,{autoComplete:!1,label:"URL",value:s,onChange:e=>h(a,"url",e,c),disabled:!d}),"link"===n&&(0,e.createElement)(C.SelectControl,{label:"Icon",value:r,options:A?.options||[],onChange:e=>{console.log(e),h(a,"icon",e,c)},disabled:!d})),(0,e.createElement)(C.ButtonGroup,null,["report","questionnaire","detailedTable","powerpoint","presentation","pressRelease","topline"].includes(n)&&(0,e.createElement)((({title:n,value:s})=>(0,e.createElement)(Y.MediaUploadCheck,null,(0,e.createElement)(Y.MediaUpload,{title:(0,t.__)(null===s?`Upload ${n}`:`Change ${n}`),allowedTypes:$,value:s,onSelect:e=>{h(a,"url",e.url,c),h(a,"attachmentId",e.id,c)},render:({open:n})=>(0,e.createElement)(C.Button,{variant:"secondary",disabled:!d,onClick:n},(0,t.__)(null===s?"Upload File":"Change File"))}))),{title:V(n),value:i}),"promo"===n&&(0,e.createElement)((({title:n,value:s})=>(0,e.createElement)(Y.MediaUploadCheck,null,(0,e.createElement)(Y.MediaUpload,{title:(0,t.__)(null===s?`Upload ${n}`:`Change ${n}`),value:s,onSelect:e=>{h(a,"icon",e.url,c),h(a,"attachmentId",e.id,c)},render:({open:n})=>(0,e.createElement)(C.Button,{variant:"secondary",disabled:!d,onClick:n},(0,t.__)(null===s?"Upload Icon":"Change Icon"))}))),{title:V(n),value:i}),(0,e.createElement)(C.Button,{variant:"secondary",onClick:()=>{m(!0)},disabled:!d},"Change Type"),u&&(0,e.createElement)(_,{type:n,onChange:e=>{h(a,"type",e,c),h(a,"attachmentId",null,c),h(a,"url","",c),h(a,"label","",c),h(a,"icon","",c),m(!1)},toggleVisibility:m}))))},W=function(){const[n,s]=(0,e.useState)(!1),i="materials",{materials:o,reorder:r,append:a,remove:c,updateItem:d,isResolving:h}=l();return(0,e.createElement)(C.PanelBody,{title:"Materials"},(0,e.createElement)(w,{lockVertically:!0,values:null!=o?o:[],onChange:({oldIndex:e,newIndex:t})=>r(e,t,i),renderList:({children:t,props:n})=>(0,e.createElement)("div",{...n},t),renderItem:({value:t,props:n,index:s})=>(0,e.createElement)("div",{...n},(0,e.createElement)(U,{key:t.key,type:t.type,url:t.url,label:t.label,icon:t.icon,attachmentId:t.attachmentId,index:s}))}),(0,e.createElement)(C.Button,{variant:"primary",onClick:()=>{s(!0)}},(0,t.__)("Add Report Material")),n&&(0,e.createElement)(_,{onChange:e=>{a(b(),{type:e,url:"",attachmentId:null,label:"",icon:""},i),s(!1)},toggleVisibility:s}))};window.prcIcons;const z="prc-platform-post-report-package";(0,n.registerPlugin)(z,{render:function(){const{postType:t,postId:n,parentId:r,isChildPost:a}=(0,o.useSelect)((e=>{const t=e(i.store).getEditedPostAttribute("post_parent"),n=e(i.store).getCurrentPostType(),s=e(i.store).getCurrentPostId();return{postType:n,postId:s,parentId:0!==t?t:s,isChildPost:0!==t}}),[]);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s.PluginSidebar,{name:z,title:"Report Package"},(0,e.createElement)(c,{postType:t,postId:r,currentPostId:n},(0,e.createElement)(W,null),(0,e.createElement)(L,null))),!a&&(0,e.createElement)(s.PluginPrePublishPanel,null,(0,e.createElement)(c,{postType:t,postId:r,currentPostId:n},(0,e.createElement)("p",null,"Please review the attached report materials:"),(0,e.createElement)(W,null),(0,e.createElement)("p",null,"Please review the attached back chapter posts. These post's status will be updated to match the parent post on publish."),(0,e.createElement)(L,null))))}})}();
//# sourceMappingURL=index.js.map