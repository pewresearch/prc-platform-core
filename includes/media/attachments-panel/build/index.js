(()=>{"use strict";var e,t={540:(e,t,n)=>{const o=window.React,a=window.wp.plugins,r=window.wp.element,l=window.wp.components,i=window.wp.editPost,s=window.prcHooks,c=window.wp.apiFetch;var d=n.n(c);const p=window.wp.editor,m=window.wp.blockEditor,u=window.wp.blocks,g=window.wp.data,h=window.wp.coreData,w=window.wp.mediaUtils,b=(0,r.createContext)(),{media:f}=window.wp,v=()=>(0,r.useContext)(b);function E({children:e}){const t=function(){const{postId:e,postType:t,imageBlocks:n=[],coverBlocks:o=[],chartBlocks:a=[],videoBlocks:l=[],getBlockInsertionPoint:i}=(0,g.useSelect)((e=>({postType:e(p.store).getCurrentPostType(),postId:e(p.store).getCurrentPostId(),imageBlocks:e(m.store).getBlocks().filter((e=>"core/image"===e.name)),coverBlocks:e(m.store).getBlocks().filter((e=>"core/cover"===e.name&&"image"===e.attributes.backgroundType)),getBlockInsertionPoint:e(m.store).getBlockInsertionPoint})),[]),{insertBlock:c}=(0,g.useDispatch)(m.store),[b,v]=(0,r.useState)([]),[E,k]=(0,r.useState)(""),I=(0,s.useDebounce)(E,500),[C,_]=(0,r.useState)(!1),[y,S]=(0,r.useState)(!0),[T,B]=(0,h.useEntityProp)("postType",t,"meta"),D=()=>{"number"==typeof e&&!1===C&&(_(!0),d()({path:`/prc-api/v3/attachments-panel/?postId=${e}`}).then((e=>{console.log("Objects found in attachments rest request...",e),v([...e]),_(!1)})))},P=f({title:"Edit Media Attachments",button:{text:"Update"},library:{uploadedTo:e}});P.on("close",(()=>{D()}));const O=(0,r.useMemo)((()=>{console.log("mergeBlocksAndReturnIdClientPairs for insertedImageIds...",o,n);const e={};0!==n.length&&n.forEach((t=>{e[t.attributes.id]={clientId:t.clientId}}));const t={};return 0!==o.length&&o.forEach((e=>{t[e.attributes.id]={clientId:e.clientId}})),{...e,...t}}),[o,n]),j=(0,r.useMemo)((()=>{if(console.log("insertedImageIds has changed"),0<b.length){const e=b.map((e=>e.id)),t=Object.keys(O);return 0<e.filter((e=>!t.includes(e.toString()))).length}return!1}),[b,O]);return(0,r.useEffect)((()=>{console.log("attachments' effect..."),D()}),[e]),(0,r.useEffect)((()=>{0<b.length?S(!1):S(!0)}),[b]),{postId:e,postType:t,insertedImageIds:O,attachments:b,loading:y,flashPrePublishWarning:j,searchTerm:E,debouncedSearchTerm:I,setSearchTerm:k,onDropImage:t=>{console.log("onDropImage",t,e),(0,w.uploadMedia)({allowedTypes:["image"],filesList:t,additionalData:{post:e},onFileChange(e){console.log("onFileChange",e),D()},onError(e){console.error(e)},wpAllowedMimeTypes:{png:"image/png","jpg|jpeg|jpe":"image/jpeg",webp:"image/webp"}})},handleImageInsertion:(e,t,n)=>{const o=i().index,a=(0,u.createBlock)("core/image",{id:e,url:t,sizeSlug:n});c(a,o)},mediaEditor:P}}();return(0,o.createElement)(b.Provider,{value:t},e)}const k=window.wp.i18n,I=function(){const{onDropImage:e}=v();return(0,o.createElement)(m.MediaUploadCheck,{fallback:(0,k.__)("Fallback Instructions Should Go Here")},(0,o.createElement)(l.DropZone,{onFilesDrop:t=>e(t),onHTMLDrop:e=>console.log("onHTMLDrop...",e),onDrop:e=>console.log("onDrop...",e)}))},C=window.classnames;var _=n.n(C);const y=[{label:"200 Wide",value:"200-wide"},{label:"200 Wide",value:"200-wide"},{label:"260 Wide",value:"260-wide"},{label:"310 Wide",value:"310-wide"},{label:"420 Wide",value:"420-wide"},{label:"640 Wide",value:"640-wide"},{label:"740 Wide",value:"740-wide"},{label:"1400 Wide",value:"1400-wide"}],S=function({id:e,url:t,title:n,type:a}){const{insertedImageIds:i,handleImageInsertion:c}=v(),{selectBlock:d}=(0,g.useDispatch)(m.store),p=Object.keys(i).includes(e.toString()),[u,h]=(0,r.useState)(!1),w=(0,s.useKeyPress)("Shift");return(0,o.createElement)(l.BaseControl,null,(0,o.createElement)("button",{type:"button",key:e,className:_()("prc-attachments-list__image",{"prc-attachments-list__image--in-use":p}),onClick:()=>{p?d(i[e].clientId):w?c(e,t,"640-wide"):h(!0)}},(0,o.createElement)("img",{src:t,alt:"A attachment in the editor"}),(0,o.createElement)("div",null,n)),u&&(0,o.createElement)(l.Modal,{title:(0,k.__)("Insert Image Into Editor","prc-block-plugins"),onRequestClose:()=>h(!1)},(0,o.createElement)(l.SelectControl,{label:"Select Image Size",value:null,options:y,onChange:n=>c(e,t,n)})))},T=function(){const{attachments:e,loading:t,searchTerm:n,debouncedSearchTerm:a,setSearchTerm:i,mediaEditor:s}=v(),c=e.sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:e.title.toLowerCase()>t.title.toLowerCase()?1:0)).filter((e=>""===a||e.title.toLowerCase().includes(a.toLowerCase())));return(0,o.createElement)(l.PanelBody,{title:(0,k.__)("Attached Images"),initialOpen:!0,className:"prc-attachments-list"},(0,o.createElement)(l.BaseControl,{id:"prc-media-zone",label:(0,k.__)('Drag and drop images to attach them to the post. Click on an image to select the image size to insert into the editor, or "shift + click" an image to insert at 640-wide.',"prc-block-plugins")},0<e.length&&(0,o.createElement)(r.Fragment,null,(0,o.createElement)(l.Button,{variant:"secondary",onClick:()=>s.open()},"Edit Attachments"),(0,o.createElement)(l.CardDivider,null)),(0,o.createElement)(l.TextControl,{label:(0,k.__)("Search"),value:n,onChange:e=>i(e)}),(0,o.createElement)(l.CardDivider,null),(0,o.createElement)(I,null),t?(0,o.createElement)(l.Spinner,null):c.map((e=>(0,o.createElement)(S,{...e})))))},B=(0,l.withFilters)("prc-platform/attachments-panel")((()=>(0,o.createElement)(r.Fragment,null,(0,o.createElement)(i.PluginSidebar,{name:"prc-attachments-panel",title:"Attachments",icon:"admin-media"},(0,o.createElement)(E,null,(0,o.createElement)(T,null))))));(0,a.registerPlugin)("prc-platform-attachment-panel",{render:()=>(0,o.createElement)(B,null),icon:"admin-media"})}},n={};function o(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,o),r.exports}o.m=t,e=[],o.O=(t,n,a,r)=>{if(!n){var l=1/0;for(d=0;d<e.length;d++){for(var[n,a,r]=e[d],i=!0,s=0;s<n.length;s++)(!1&r||l>=r)&&Object.keys(o.O).every((e=>o.O[e](n[s])))?n.splice(s--,1):(i=!1,r<l&&(l=r));if(i){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,a,r]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var a,r,[l,i,s]=n,c=0;if(l.some((t=>0!==e[t]))){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(s)var d=s(o)}for(t&&t(n);c<l.length;c++)r=l[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},n=globalThis.webpackChunk_pewresearch_prc_platform_attachments_panel=globalThis.webpackChunk_pewresearch_prc_platform_attachments_panel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=o.O(void 0,[350],(()=>o(540)));a=o.O(a)})();
//# sourceMappingURL=index.js.map