(()=>{"use strict";var e,t={801:(e,t,n)=>{const l=window.React,o=window.wp.plugins,a=window.wp.element,r=window.wp.components,i=window.wp.editPost,s=window.prcHooks,c=window.wp.apiFetch;var d=n.n(c);const m=window.wp.editor,p=window.wp.blockEditor,u=window.wp.blocks,g=window.wp.data,h=window.wp.coreData,w=window.wp.mediaUtils,f=(0,a.createContext)(),{media:b}=window.wp,k=()=>(0,a.useContext)(f);function E({children:e}){const t=function(){const{postId:e,postType:t,imageBlocks:n=[],coverBlocks:l=[],chartBlocks:o=[],videoBlocks:r=[],getBlockInsertionPoint:i,selectedBlockClientId:c,selectedBlockIsImageBlock:f,selectedBlockAttrs:k}=(0,g.useSelect)((e=>({postType:e(m.store).getCurrentPostType(),postId:e(m.store).getCurrentPostId(),imageBlocks:e(p.store).getBlocks().filter((e=>"core/image"===e.name)),coverBlocks:e(p.store).getBlocks().filter((e=>"core/cover"===e.name&&"image"===e.attributes.backgroundType)),getBlockInsertionPoint:e(p.store).getBlockInsertionPoint,selectedBlockClientId:e(p.store).getSelectedBlockClientId(),selectedBlockIsImageBlock:"core/image"===e(p.store).getSelectedBlock()?.name,selectedBlockAttrs:e(p.store).getSelectedBlock()?.attributes})),[]),{insertBlock:E,replaceBlock:v}=(0,g.useDispatch)(p.store),[I,C]=(0,a.useState)(null),[y,_]=(0,a.useState)([]),[B,S]=(0,a.useState)(""),P=(0,s.useDebounce)(B,500),[T,L]=(0,a.useState)(!1),[O,D]=(0,a.useState)(!0),[A,M]=(0,h.useEntityProp)("postType",t,"meta"),j=()=>{"number"==typeof e&&!1===T&&(L(!0),d()({path:`/prc-api/v3/attachments-panel/?postId=${e}`}).then((e=>{console.log("Objects found in attachments rest request...",e),_([...e]),L(!1)})))},W=(0,a.useMemo)((()=>b({title:"Edit Attachments",button:{text:"Update"},library:{uploadedTo:e,selected:[I]}})),[e,I]);W.on("close",(()=>{j()}));const x=(0,a.useMemo)((()=>{console.log("mergeBlocksAndReturnIdClientPairs for insertedImageIds...",l,n);const e={};0!==n.length&&n.forEach((t=>{e[t.attributes.id]={clientId:t.clientId}}));const t={};return 0!==l.length&&l.forEach((e=>{t[e.attributes.id]={clientId:e.clientId}})),{...e,...t}}),[l,n]),F=(0,a.useMemo)((()=>{if(console.log("insertedImageIds has changed"),0<y.length){const e=y.map((e=>e.id)),t=Object.keys(x);return 0<e.filter((e=>!t.includes(e.toString()))).length}return!1}),[y,x]);return(0,a.useEffect)((()=>{console.log("attachments' effect..."),j()}),[e]),(0,a.useEffect)((()=>{0<y.length?D(!1):D(!0)}),[y]),{postId:e,postType:t,insertedImageIds:x,attachments:y,loading:O,flashPrePublishWarning:F,searchTerm:B,debouncedSearchTerm:P,setSearchTerm:S,onDropImage:t=>{console.log("onDropImage",t,e),(0,w.uploadMedia)({allowedTypes:["image"],filesList:t,additionalData:{post:e},onFileChange(e){console.log("onFileChange",e),j()},onError(e){console.error(e)},wpAllowedMimeTypes:{png:"image/png","jpg|jpeg|jpe":"image/jpeg",webp:"image/webp"}})},handleImageInsertion:(e,t,n)=>{const l=i().index,o=(0,u.createBlock)("core/image",{id:e,url:t,sizeSlug:n});E(o,l)},handleImageReplacement:(e,t,n)=>{if(f){const l=k.sizeSlug||"310-wide",o=k;o.id=e,o.url=t,o.sizeSlug=l,n&&(o.href=n);const a=(0,u.createBlock)("core/image",{...o});v(c,a)}},mediaEditor:W,openMediaLibrary:(e=null)=>{C(e),W.open(),W.on("close",(()=>{C(null)}))}}}();return(0,l.createElement)(f.Provider,{value:t},e)}const v=window.wp.i18n,I=function(){const{onDropImage:e}=k();return(0,l.createElement)(p.MediaUploadCheck,{fallback:(0,v.__)("Drag and drop your files here and they will be attached to this post.")},(0,l.createElement)(r.DropZone,{onFilesDrop:t=>e(t),onHTMLDrop:e=>console.log("onHTMLDrop...",e),onDrop:e=>console.log("onDrop...",e)}))},C=window.classnames;var y=n.n(C);const _=[{label:"200 Wide",value:"200-wide"},{label:"200 Wide",value:"200-wide"},{label:"260 Wide",value:"260-wide"},{label:"310 Wide",value:"310-wide"},{label:"420 Wide",value:"420-wide"},{label:"640 Wide",value:"640-wide"},{label:"740 Wide",value:"740-wide"},{label:"1400 Wide",value:"1400-wide"}],B=function({id:e,url:t,title:n,type:o,filename:i,editLink:c,attachmentLink:d}){const{insertedImageIds:m,handleImageInsertion:u,handleImageReplacement:h}=k(),{selectBlock:w}=(0,g.useDispatch)(p.store),f=Object.keys(m).includes(e.toString()),[b,E]=(0,a.useState)(!1),I=(0,s.useKeyPress)("Shift"),C=(0,s.useKeyPress)("Alt"),B=(0,s.useKeyPress)("metaKey");return(0,l.createElement)(r.BaseControl,null,(0,l.createElement)("button",{type:"button",key:e,className:y()("prc-attachments-list__image",{"prc-attachments-list__image--in-use":f}),onClick:()=>{f?w(m[e].clientId):I?u(e,t,"640-wide"):C?h(e,t,d):B?window.open(c,"_blank"):E(!0)}},(0,l.createElement)("img",{src:t,alt:"A attachment in the editor"}),(0,l.createElement)("div",null,n)),b&&(0,l.createElement)(r.Modal,{title:(0,v.__)("Insert Image Into Editor","prc-block-plugins"),onRequestClose:()=>E(!1)},(0,l.createElement)(r.SelectControl,{label:"Select Image Size",value:null,options:_,onChange:n=>u(e,t,n)})))},S=function({id:e,url:t,title:n,type:o}){const{openMediaLibrary:a}=k();return(0,l.createElement)(r.BaseControl,null,(0,l.createElement)("button",{type:"button",key:e,className:y()("prc-attachments-list__file"),onClick:()=>{a(e)}},(0,l.createElement)("div",null,n)))};function P(){const{attachments:e,loading:t,debouncedSearchTerm:n}=k(),o=e.filter((e=>e.type.startsWith("image/"))).sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:e.title.toLowerCase()>t.title.toLowerCase()?1:0)).filter((e=>""===n||e.title.toLowerCase().includes(n.toLowerCase())));return(0,l.createElement)("div",null,t?(0,l.createElement)(r.Spinner,null):o.map((e=>(0,l.createElement)(B,{...e}))))}function T(){const{attachments:e,loading:t,debouncedSearchTerm:n}=k(),o=e.filter((e=>e.type.startsWith("application/"))).sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:e.title.toLowerCase()>t.title.toLowerCase()?1:0)).filter((e=>""===n||e.title.toLowerCase().includes(n.toLowerCase())||e.name.toLowerCase().includes(n.toLowerCase())));return(0,l.createElement)("div",null,t?(0,l.createElement)(r.Spinner,null):o.map((e=>(0,l.createElement)(S,{...e}))))}const L=function(){const{attachments:e,searchTerm:t,setSearchTerm:n,mediaEditor:o}=k();return(0,g.useSelect)((e=>e("core/editor").getCurrentPostId())),(0,l.createElement)(a.Fragment,null,(0,l.createElement)(r.PanelBody,{title:(0,v.__)("Attachments"),initialOpen:!0,className:"prc-attachments-list"},(0,l.createElement)(r.BaseControl,{id:"prc-media-zone",label:(0,v.__)('Drag and drop images to attach them to the post. Click on an image to select the desired size to insert into the editor. Alternatively, press "Shift + Click" an image to insert it at 640 pixels wide. To replace your selected image block, press "Opt + Click" on the desired image.',"prc-block-plugins")},0<e.length&&(0,l.createElement)(a.Fragment,null,(0,l.createElement)(r.Button,{variant:"secondary",onClick:()=>o.open()},"Edit Attachments"),(0,l.createElement)(r.CardDivider,null)),(0,l.createElement)(r.TextControl,{label:(0,v.__)("Filter Attachments"),value:t,onChange:e=>n(e)}),(0,l.createElement)(I,null))),(0,l.createElement)(r.PanelBody,{title:(0,v.__)("Images"),initialOpen:e.length>0,className:"prc-attachments-list__images"},(0,l.createElement)(P,null)),(0,l.createElement)(r.PanelBody,{title:(0,v.__)("Files"),className:"prc-attachments-list__files",initialOpen:!1},(0,l.createElement)(T,null)))},O=(0,r.withFilters)("prc-platform/attachments-panel")((()=>(0,l.createElement)(a.Fragment,null,(0,l.createElement)(i.PluginSidebar,{name:"prc-attachments-panel",title:"Attachments",icon:"admin-media"},(0,l.createElement)(E,null,(0,l.createElement)(L,null))))));(0,o.registerPlugin)("prc-platform-attachment-panel",{render:()=>(0,l.createElement)(O,null),icon:"admin-media"})}},n={};function l(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,l),a.exports}l.m=t,e=[],l.O=(t,n,o,a)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,o,a]=e[d],i=!0,s=0;s<n.length;s++)(!1&a||r>=a)&&Object.keys(l.O).every((e=>l.O[e](n[s])))?n.splice(s--,1):(i=!1,a<r&&(r=a));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,o,a]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};l.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[r,i,s]=n,c=0;if(r.some((t=>0!==e[t]))){for(o in i)l.o(i,o)&&(l.m[o]=i[o]);if(s)var d=s(l)}for(t&&t(n);c<r.length;c++)a=r[c],l.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return l.O(d)},n=globalThis.webpackChunk_pewresearch_prc_platform_attachments_panel=globalThis.webpackChunk_pewresearch_prc_platform_attachments_panel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=l.O(void 0,[350],(()=>l(801)));o=l.O(o)})();
//# sourceMappingURL=index.js.map