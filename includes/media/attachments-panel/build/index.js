(()=>{"use strict";var e,t={801:(e,t,n)=>{const o=window.React,a=window.wp.plugins,l=window.wp.element,r=window.wp.components,i=window.wp.editPost,s=window.prcHooks,c=window.wp.apiFetch;var d=n.n(c);const m=window.wp.editor,p=window.wp.blockEditor,u=window.wp.blocks,g=window.wp.data,h=window.wp.coreData,w=window.wp.mediaUtils,f=(0,l.createContext)(),{media:b}=window.wp,E=()=>(0,l.useContext)(f);function v({children:e}){const t=function(){const{postId:e,postType:t,imageBlocks:n=[],coverBlocks:o=[],chartBlocks:a=[],videoBlocks:r=[],getBlockInsertionPoint:i}=(0,g.useSelect)((e=>({postType:e(m.store).getCurrentPostType(),postId:e(m.store).getCurrentPostId(),imageBlocks:e(p.store).getBlocks().filter((e=>"core/image"===e.name)),coverBlocks:e(p.store).getBlocks().filter((e=>"core/cover"===e.name&&"image"===e.attributes.backgroundType)),getBlockInsertionPoint:e(p.store).getBlockInsertionPoint})),[]),{insertBlock:c}=(0,g.useDispatch)(p.store),[f,E]=(0,l.useState)(null),[v,_]=(0,l.useState)([]),[y,k]=(0,l.useState)(""),C=(0,s.useDebounce)(y,500),[I,S]=(0,l.useState)(!1),[B,P]=(0,l.useState)(!0),[T,D]=(0,h.useEntityProp)("postType",t,"meta"),O=()=>{"number"==typeof e&&!1===I&&(S(!0),d()({path:`/prc-api/v3/attachments-panel/?postId=${e}`}).then((e=>{console.log("Objects found in attachments rest request...",e),_([...e]),S(!1)})))},L=(0,l.useMemo)((()=>b({title:"Edit Attachments",button:{text:"Update"},library:{uploadedTo:e,selected:[f]}})),[e,f]);L.on("close",(()=>{O()}));const A=(0,l.useMemo)((()=>{console.log("mergeBlocksAndReturnIdClientPairs for insertedImageIds...",o,n);const e={};0!==n.length&&n.forEach((t=>{e[t.attributes.id]={clientId:t.clientId}}));const t={};return 0!==o.length&&o.forEach((e=>{t[e.attributes.id]={clientId:e.clientId}})),{...e,...t}}),[o,n]),j=(0,l.useMemo)((()=>{if(console.log("insertedImageIds has changed"),0<v.length){const e=v.map((e=>e.id)),t=Object.keys(A);return 0<e.filter((e=>!t.includes(e.toString()))).length}return!1}),[v,A]);return(0,l.useEffect)((()=>{console.log("attachments' effect..."),O()}),[e]),(0,l.useEffect)((()=>{0<v.length?P(!1):P(!0)}),[v]),{postId:e,postType:t,insertedImageIds:A,attachments:v,loading:B,flashPrePublishWarning:j,searchTerm:y,debouncedSearchTerm:C,setSearchTerm:k,onDropImage:t=>{console.log("onDropImage",t,e),(0,w.uploadMedia)({allowedTypes:["image"],filesList:t,additionalData:{post:e},onFileChange(e){console.log("onFileChange",e),O()},onError(e){console.error(e)},wpAllowedMimeTypes:{png:"image/png","jpg|jpeg|jpe":"image/jpeg",webp:"image/webp"}})},handleImageInsertion:(e,t,n)=>{const o=i().index,a=(0,u.createBlock)("core/image",{id:e,url:t,sizeSlug:n});c(a,o)},mediaEditor:L,openMediaLibrary:(e=null)=>{E(e),L.open(),L.on("close",(()=>{E(null)}))}}}();return(0,o.createElement)(f.Provider,{value:t},e)}const _=window.wp.i18n,y=function(){const{onDropImage:e}=E();return(0,o.createElement)(p.MediaUploadCheck,{fallback:(0,_.__)("Drag and drop your files here and they will be attached to this post.")},(0,o.createElement)(r.DropZone,{onFilesDrop:t=>e(t),onHTMLDrop:e=>console.log("onHTMLDrop...",e),onDrop:e=>console.log("onDrop...",e)}))},k=window.classnames;var C=n.n(k);const I=[{label:"200 Wide",value:"200-wide"},{label:"200 Wide",value:"200-wide"},{label:"260 Wide",value:"260-wide"},{label:"310 Wide",value:"310-wide"},{label:"420 Wide",value:"420-wide"},{label:"640 Wide",value:"640-wide"},{label:"740 Wide",value:"740-wide"},{label:"1400 Wide",value:"1400-wide"}],S=function({id:e,url:t,title:n,type:a}){const{insertedImageIds:i,handleImageInsertion:c}=E(),{selectBlock:d}=(0,g.useDispatch)(p.store),m=Object.keys(i).includes(e.toString()),[u,h]=(0,l.useState)(!1),w=(0,s.useKeyPress)("Shift");return(0,o.createElement)(r.BaseControl,null,(0,o.createElement)("button",{type:"button",key:e,className:C()("prc-attachments-list__image",{"prc-attachments-list__image--in-use":m}),onClick:()=>{m?d(i[e].clientId):w?c(e,t,"640-wide"):h(!0)}},(0,o.createElement)("img",{src:t,alt:"A attachment in the editor"}),(0,o.createElement)("div",null,n)),u&&(0,o.createElement)(r.Modal,{title:(0,_.__)("Insert Image Into Editor","prc-block-plugins"),onRequestClose:()=>h(!1)},(0,o.createElement)(r.SelectControl,{label:"Select Image Size",value:null,options:I,onChange:n=>c(e,t,n)})))},B=function({id:e,url:t,title:n,type:a}){const{openMediaLibrary:l}=E();return(0,o.createElement)(r.BaseControl,null,(0,o.createElement)("button",{type:"button",key:e,className:C()("prc-attachments-list__file"),onClick:()=>{l(e)}},(0,o.createElement)("div",null,n)))};function P(){const{attachments:e,loading:t,debouncedSearchTerm:n}=E(),a=e.filter((e=>e.type.startsWith("image/"))).sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:e.title.toLowerCase()>t.title.toLowerCase()?1:0)).filter((e=>""===n||e.title.toLowerCase().includes(n.toLowerCase())));return(0,o.createElement)("div",null,t?(0,o.createElement)(r.Spinner,null):a.map((e=>(0,o.createElement)(S,{...e}))))}function T(){const{attachments:e,loading:t,debouncedSearchTerm:n}=E(),a=e.filter((e=>e.type.startsWith("application/"))).sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:e.title.toLowerCase()>t.title.toLowerCase()?1:0)).filter((e=>""===n||e.title.toLowerCase().includes(n.toLowerCase())));return(0,o.createElement)("div",null,t?(0,o.createElement)(r.Spinner,null):a.map((e=>(0,o.createElement)(B,{...e}))))}const D=function(){const{attachments:e,searchTerm:t,setSearchTerm:n,mediaEditor:a}=E(),i=(0,g.useSelect)((e=>e("core/editor").getCurrentPostId()));return(0,o.createElement)(l.Fragment,null,(0,o.createElement)(r.PanelBody,{title:(0,_.__)("Attachments"),initialOpen:!0,className:"prc-attachments-list"},(0,o.createElement)(r.BaseControl,{id:"prc-media-zone",label:(0,_.__)('Drag and drop images to attach them to the post. Click on an image to select the image size to insert into the editor, or "shift + click" an image to insert at 640-wide.',"prc-block-plugins")},0<e.length&&(0,o.createElement)(l.Fragment,null,(0,o.createElement)(r.Button,{variant:"secondary",onClick:()=>a.open()},"Edit Attachments"),(0,o.createElement)(r.CardDivider,null)),(0,o.createElement)(r.TextControl,{label:(0,_.__)("Filter Attachments"),value:t,onChange:e=>n(e)}),(0,o.createElement)(y,null))),(0,o.createElement)(r.PanelBody,{title:(0,_.__)("Images"),initialOpen:e.length>0,className:"prc-attachments-list__images"},(0,o.createElement)(P,null)),(0,o.createElement)(r.PanelBody,{title:(0,_.__)("Files"),className:"prc-attachments-list__files",initialOpen:!1},(0,o.createElement)(T,null)),(0,o.createElement)(r.PanelBody,{title:(0,_.__)("Danger Zone"),className:"prc-attachments-list__danger-zone",initialOpen:!1},(0,o.createElement)(r.Button,{isDestructive:!0,onClick:()=>{((e,t="post")=>{let n=0,o=0;const a=(0,g.select)("core").getEntityRecord("postType",t,e);a&&(console.log("post...",a.meta?.dt_original_post_id),n=a.meta?.dt_original_post_id,a.meta),fetch(`https://prc-platform.vipdev.lndo.site/religion/wp-json/wp/v2/posts/${n}?_fields=content`).then((e=>e.json())).then((t=>{const n=[],o=t.content.rendered;(new DOMParser).parseFromString(o,"text/html").querySelectorAll("figure").forEach((e=>{const t=e.querySelector("img");if(t){const o=t.getAttribute("src"),a=e.getAttribute("class"),l=e.querySelector("a");let r;const i=/wp-image-(\d+)/,s=a.match(i);if(s)r=s[1];else{const e=l?l.getAttribute("rel"):null,t=/wp-att-(\d+)/,n=e?e.match(t):null;n&&(r=n[1])}r&&n.push({src:o,id:r})}})),console.log("images inside content...",n),0<n.length&&((e,t,n=(()=>{}))=>(console.log("imagesArray...",e.map((e=>e.src))),new Promise(((n,o)=>{d()({path:"/prc-api/v3/migration-tools/migrate-attachments",method:"POST",data:{urls:e.map((e=>e.src)),postId:t}}).then((e=>{n(e)})).catch((e=>{o(e)}))}))))(n,e).then((e=>console.log("success",e))).catch((e=>console.error("error",e)))})).catch((e=>console.error(e)))})(i)}},"Copy Attachments From Legacy")))},O=(0,r.withFilters)("prc-platform/attachments-panel")((()=>(0,o.createElement)(l.Fragment,null,(0,o.createElement)(i.PluginSidebar,{name:"prc-attachments-panel",title:"Attachments",icon:"admin-media"},(0,o.createElement)(v,null,(0,o.createElement)(D,null))))));(0,a.registerPlugin)("prc-platform-attachment-panel",{render:()=>(0,o.createElement)(O,null),icon:"admin-media"})}},n={};function o(e){var a=n[e];if(void 0!==a)return a.exports;var l=n[e]={exports:{}};return t[e](l,l.exports,o),l.exports}o.m=t,e=[],o.O=(t,n,a,l)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,a,l]=e[d],i=!0,s=0;s<n.length;s++)(!1&l||r>=l)&&Object.keys(o.O).every((e=>o.O[e](n[s])))?n.splice(s--,1):(i=!1,l<r&&(r=l));if(i){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[n,a,l]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var a,l,[r,i,s]=n,c=0;if(r.some((t=>0!==e[t]))){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(s)var d=s(o)}for(t&&t(n);c<r.length;c++)l=r[c],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(d)},n=globalThis.webpackChunk_pewresearch_prc_platform_attachments_panel=globalThis.webpackChunk_pewresearch_prc_platform_attachments_panel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=o.O(void 0,[350],(()=>o(801)));a=o.O(a)})();
//# sourceMappingURL=index.js.map