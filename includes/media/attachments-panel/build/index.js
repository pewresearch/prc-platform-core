(()=>{"use strict";var e,t={519:(e,t,n)=>{const o=window.wp.plugins,i=window.wp.element,s=window.wp.components,a=window.wp.editPost,l=window.prcHooks,r=window.wp.apiFetch;var c=n.n(r);const d=window.wp.editor,p=window.wp.blockEditor,u=window.wp.blocks,m=window.wp.data,h=window.wp.coreData,g=window.wp.mediaUtils,w=window.ReactJSXRuntime,f=(0,i.createContext)(),{media:b}=window.wp,k=()=>(0,i.useContext)(f);function j({children:e}){const t=function(){const{postId:e,postType:t,imageBlocks:n=[],coverBlocks:o=[],chartBlocks:s=[],videoBlocks:a=[],getBlockInsertionPoint:r,selectedBlockClientId:w,selectedBlockIsImageBlock:f,selectedBlockAttrs:k}=(0,m.useSelect)((e=>({postType:e(d.store).getCurrentPostType(),postId:e(d.store).getCurrentPostId(),imageBlocks:e(p.store).getBlocks().filter((e=>"core/image"===e.name)),coverBlocks:e(p.store).getBlocks().filter((e=>"core/cover"===e.name&&"image"===e.attributes.backgroundType)),getBlockInsertionPoint:e(p.store).getBlockInsertionPoint,selectedBlockClientId:e(p.store).getSelectedBlockClientId(),selectedBlockIsImageBlock:"core/image"===e(p.store).getSelectedBlock()?.name,selectedBlockAttrs:e(p.store).getSelectedBlock()?.attributes})),[]),{insertBlock:j,replaceBlock:v}=(0,m.useDispatch)(p.store),[x,C]=(0,i.useState)(null),[I,y]=(0,i.useState)([]),[_,B]=(0,i.useState)(""),S=(0,l.useDebounce)(_,500),[L,P]=(0,i.useState)(!1),[T,D]=(0,i.useState)(!0),[O,E]=(0,h.useEntityProp)("postType",t,"meta"),M=()=>{"number"==typeof e&&!1===L&&(P(!0),c()({path:`/prc-api/v3/attachments-panel/get/${e}`}).then((e=>{console.log("Objects found in attachments rest request...",e),y([...e]),P(!1)})))},A=(0,i.useMemo)((()=>b({title:"Edit Attachments",button:{text:"Update"},library:{uploadedTo:e,selected:[x]}})),[e,x]);A.on("close",(()=>{M()}));const W=(0,i.useMemo)((()=>{console.log("mergeBlocksAndReturnIdClientPairs for insertedImageIds...",o,n);const e={};0!==n.length&&n.forEach((t=>{e[t.attributes.id]={clientId:t.clientId}}));const t={};return 0!==o.length&&o.forEach((e=>{t[e.attributes.id]={clientId:e.clientId}})),{...e,...t}}),[o,n]),F=(0,i.useMemo)((()=>{if(console.log("insertedImageIds has changed"),0<I.length){const e=I.map((e=>e.id)),t=Object.keys(W);return 0<e.filter((e=>!t.includes(e.toString()))).length}return!1}),[I,W]);return(0,i.useEffect)((()=>{console.log("attachments' effect..."),M()}),[e]),(0,i.useEffect)((()=>{0<I.length?D(!1):D(!0)}),[I]),{postId:e,postType:t,insertedImageIds:W,attachments:I,loading:T,flashPrePublishWarning:F,searchTerm:_,debouncedSearchTerm:S,setSearchTerm:B,onDropImage:t=>{console.log("onDropImage",t,e),(0,g.uploadMedia)({allowedTypes:["image"],filesList:t,additionalData:{post:e},onFileChange(e){console.log("onFileChange",e),M()},onError(e){console.error(e)},wpAllowedMimeTypes:{png:"image/png","jpg|jpeg|jpe":"image/jpeg",webp:"image/webp"}})},handleImageInsertion:(e,t,n,o,i)=>{const s=r().index,a=(0,u.createBlock)("core/image",{id:e,url:t,sizeSlug:n,alt:o,caption:i});j(a,s)},handleImageReplacement:(e,t,n,o,i)=>{if(f){const s=k.sizeSlug||"310-wide",a=k;a.id=e,a.url=t,a.sizeSlug=s,a.alt=o,a.caption=i,n&&(a.href=n);const l=(0,u.createBlock)("core/image",{...a});v(w,l)}},mediaEditor:A,openMediaLibrary:(e=null)=>{C(e),A.open(),A.on("close",(()=>{C(null)}))}}}();return(0,w.jsx)(f.Provider,{value:t,children:e})}const v=window.wp.i18n,x=function(){const{onDropImage:e}=k();return(0,w.jsx)(p.MediaUploadCheck,{fallback:(0,v.__)("Drag and drop your files here and they will be attached to this post."),children:(0,w.jsx)(s.DropZone,{onFilesDrop:t=>e(t),onHTMLDrop:e=>console.log("onHTMLDrop...",e),onDrop:e=>console.log("onDrop...",e)})})},C=window.classnames;var I=n.n(C);const y=[{label:"200 Wide",value:"200-wide"},{label:"200 Wide",value:"200-wide"},{label:"260 Wide",value:"260-wide"},{label:"310 Wide",value:"310-wide"},{label:"420 Wide",value:"420-wide"},{label:"640 Wide",value:"640-wide"},{label:"740 Wide",value:"740-wide"},{label:"1400 Wide",value:"1400-wide"}],_=function({id:e,url:t,title:n,type:o,filename:a,alt:r,caption:c,editLink:d,attachmentLink:u}){const{insertedImageIds:h,handleImageInsertion:g,handleImageReplacement:f}=k(),{selectBlock:b}=(0,m.useDispatch)(p.store),j=Object.keys(h).includes(e.toString()),[x,C]=(0,i.useState)(!1),_=(0,l.useKeyPress)("Shift"),B=(0,l.useKeyPress)("Alt"),S=(0,l.useKeyPress)("Meta");return(0,w.jsxs)(s.BaseControl,{children:[(0,w.jsxs)("button",{type:"button",className:I()("prc-attachments-list__image",{"prc-attachments-list__image--in-use":j}),onClick:()=>{j?b(h[e].clientId):_?g(e,t,"640-wide",r,c):B?f(e,t,u):S?window.open(d,"_blank"):C(!0)},children:[(0,w.jsx)("img",{src:t,alt:"A attachment in the editor"}),(0,w.jsx)("div",{children:n})]},e),x&&(0,w.jsx)(s.Modal,{title:(0,v.__)("Insert Image Into Editor","prc-block-plugins"),onRequestClose:()=>C(!1),children:(0,w.jsx)(s.SelectControl,{label:"Select Image Size",value:null,options:y,onChange:n=>{g(e,t,n,r,c),C(!1)}})})]})},B=function({id:e,url:t,title:n,type:o}){const{openMediaLibrary:i}=k();return(0,w.jsx)(s.BaseControl,{children:(0,w.jsx)("button",{type:"button",className:I()("prc-attachments-list__file"),onClick:()=>{i(e)},children:(0,w.jsx)("div",{children:n})},e)})};function S(){const{attachments:e,loading:t,debouncedSearchTerm:n}=k(),o=e.filter((e=>e.type.startsWith("image/"))).sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:e.title.toLowerCase()>t.title.toLowerCase()?1:0)).filter((e=>""===n||e.title.toLowerCase().includes(n.toLowerCase())));return console.log({filteredAttachments:o}),(0,w.jsx)("div",{children:t?(0,w.jsx)(s.Spinner,{}):o.map((e=>(0,w.jsx)(_,{...e})))})}function L(){const{attachments:e,loading:t,debouncedSearchTerm:n}=k(),o=e.filter((e=>e.type.startsWith("application/"))).sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:e.title.toLowerCase()>t.title.toLowerCase()?1:0)).filter((e=>""===n||e.title.toLowerCase().includes(n.toLowerCase())||e.name.toLowerCase().includes(n.toLowerCase())));return(0,w.jsx)("div",{children:t?(0,w.jsx)(s.Spinner,{}):o.map((e=>(0,w.jsx)(B,{...e})))})}const P=function(){const{attachments:e,searchTerm:t,setSearchTerm:n,mediaEditor:o}=k();return(0,w.jsxs)(i.Fragment,{children:[(0,w.jsx)("div",{style:{position:"relative",padding:"1em"},children:(0,w.jsxs)(s.BaseControl,{id:"prc-media-zone",label:(0,v.__)("Drag and drop files to attach them to this post or manage existing attachments.","prc-block-plugins"),help:(0,v.__)('Click on an image to select the desired size to insert into the editor. Alternatively, press "Shift + Click" an image to insert it at 640 pixels wide. To replace your selected image block, press "Opt + Click" on the desired image.'),children:[0<e.length&&(0,w.jsxs)(i.Fragment,{children:[(0,w.jsx)(s.Button,{variant:"secondary",onClick:()=>o.open(),children:"Edit Attachments"}),(0,w.jsx)(s.CardDivider,{})]}),(0,w.jsx)(s.TextControl,{label:(0,v.__)("Filter Attachments"),value:t,onChange:e=>n(e)}),(0,w.jsx)(x,{})]})}),(0,w.jsx)(s.PanelBody,{title:(0,v.__)("Images"),initialOpen:e.length>0,className:"prc-attachments-list__images",children:(0,w.jsx)(S,{})}),(0,w.jsx)(s.PanelBody,{title:(0,v.__)("Files"),className:"prc-attachments-list__files",initialOpen:!1,children:(0,w.jsx)(L,{})})]})};function T(){return(0,w.jsx)(j,{children:(0,w.jsx)(P,{})})}function D(){const e=(0,s.withFilters)("prc-platform.attachments-panel")(T);return(0,w.jsx)(a.PluginSidebar,{name:"prc-platform-attachments-panel",title:"Attachments",icon:"admin-media",children:(0,w.jsx)(e,{})})}(0,o.registerPlugin)("prc-platform-attachment-panel",{render:()=>(0,w.jsx)(D,{}),icon:"admin-media"})}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,o),s.exports}o.m=t,e=[],o.O=(t,n,i,s)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){n=e[d][0],i=e[d][1],s=e[d][2];for(var l=!0,r=0;r<n.length;r++)(!1&s||a>=s)&&Object.keys(o.O).every((e=>o.O[e](n[r])))?n.splice(r--,1):(l=!1,s<a&&(a=s));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,i,s]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var i,s,a=n[0],l=n[1],r=n[2],c=0;if(a.some((t=>0!==e[t]))){for(i in l)o.o(l,i)&&(o.m[i]=l[i]);if(r)var d=r(o)}for(t&&t(n);c<a.length;c++)s=a[c],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(d)},n=self.webpackChunk_pewresearch_prc_platform_attachments_panel=self.webpackChunk_pewresearch_prc_platform_attachments_panel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=o.O(void 0,[350],(()=>o(519)));i=o.O(i)})();
//# sourceMappingURL=index.js.map