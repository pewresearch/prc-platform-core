import*as e from"@wordpress/interactivity";var t={d:(e,o)=>{for(var s in o)t.o(o,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const o=(r={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store},a={},t.d(a,r),a),{state:s,actions:n}=(0,o.store)("prc-platform/dataset-download",{actions:{downloadDataset:(e,t,o,s,n)=>{window?.wp?.apiFetch({path:`/prc-api/v3/datasets/get-download/?dataset_id=${e}`,method:"POST",data:{uid:t,userToken:o,NONCE:s}}).then((e=>{e?.file_url&&(n.isProcessing=!1,n.isSuccess=!0,window.open(e.file_url,"_blank"))})).catch((e=>{n.isProcessing=!1,n.isError=!0,console.error(e)}))},async checkATP(e,t,s,r){const{ref:a}=(0,o.getElement)(),c=(0,o.getContext)(),i=await(window?.wp?.apiFetch({path:"/prc-api/v3/datasets/check-atp/",method:"POST",data:{uid:e,userToken:t,NONCE:r}}));if(console.log("User has accepted ATP legal agreement: ",i),!0===i&&n.downloadDataset(s,e,t,r,c),!1===i){const e=a.parentElement.parentElement.parentElement.getAttribute("id"),{actions:t,state:s}=(0,o.store)("prc-block/popup-controller");t.open(null,e)}},onButtonClick:e=>{e.preventDefault();const t=(0,o.getContext)(),{datasetId:s,isProcessing:r,isATP:a,NONCE:c}=t;t.isProcessing=!0;const{state:i}=(0,o.store)("prc-user-accounts/content-gate"),{token:l,uid:d}=i;a?n.checkATP(d,l,s,c):n.downloadDataset(s,d,l,c,t)}},callbacks:{isProcessing:()=>{const e=(0,o.getContext)(),{ref:t}=(0,o.getElement)(),{isProcessing:n}=e,r=t.querySelector(".wp-element-button").id;s[r].isProcessing=n},isError:()=>{const e=(0,o.getContext)(),{ref:t}=(0,o.getElement)(),{isError:n}=e,r=t.querySelector(".wp-element-button").id;s[r].isError=n},isSuccess:()=>{const e=(0,o.getContext)(),{ref:t}=(0,o.getElement)(),{isSuccess:n}=e,r=t.querySelector(".wp-element-button").id;s[r].isSuccess=n}}});var r,a;
//# sourceMappingURL=view.js.map