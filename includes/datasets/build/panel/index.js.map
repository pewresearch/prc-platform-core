{"version":3,"file":"panel/index.js","mappings":"mBACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,IACzBH,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,ICAlF,MAAM,EAA+BI,OAAW,GAAc,WCAxD,EAA+BA,OAAwB,gBCY7D,GAP8B,SAAK,EAAAC,IAAK,CACtCC,MAAO,6BACPC,QAAS,YACTC,UAAuB,SAAK,EAAAC,KAAM,CAChCpB,EAAG,uGCTD,EAA+Be,OAAW,GAAW,QC6B3D,GAAe,IAAAM,aAZf,UAAc,KACZC,EAAI,KACJC,EAAO,MACJC,GACFC,GACD,OAAO,IAAAC,cAAaJ,EAAM,CACxBK,MAAOJ,EACPK,OAAQL,KACLC,EACHC,OAEJ,IC5BM,EAA+BV,OAAsB,cCArD,EAA+BA,OAAW,GAAQ,KCAlD,EAA+BA,OAAc,MCA7C,EAA+BA,OAAW,GAAW,QCArD,EAA+BA,OAAW,GAAU,OCApD,EAA+BA,OAAW,GAAQ,KCAlD,EAA+BA,OAAW,GAAY,SCAtD,EAA+BA,OAAW,GAAc,WCAxD,EAA+BA,OAAW,GAAY,S,aCgC5D,MAAMc,EAAc,8BACdC,EAAgB,CAAC,kBAAmB,oBA0J1CC,EAAAA,EAAAA,gBAAeF,EAAa,CAC3BG,OAlID,WACC,MAAM,SAAEC,EAAQ,OAAEC,IAAWC,EAAAA,EAAAA,YAAWC,IAGhC,CACNH,SAHuBG,EAAOC,EAAAA,OAAaC,qBAI3CJ,OAHqBE,EAAOC,EAAAA,OAAaE,sBAKxC,KAEIC,EAAMC,IAAWC,EAAAA,EAAAA,eAAc,WAAYT,EAAU,OAAQC,IAE9D,aAAES,EAAY,MAAEC,EAAK,cAAEC,IAAkBC,EAAAA,EAAAA,UAAQ,KAC/C,CACNH,aAAcH,EAAKO,0BAA2B,EAC9CH,MAAOJ,EAAKQ,SAAU,EACtBH,cAAeL,EAAKS,gBAAkB,MAErC,CAACT,IAEEU,EA1CP,SAAyBhB,GACxB,MAAOiB,EAAOC,IAAYC,EAAAA,EAAAA,UAAS,MAkBnC,OAhBAC,EAAAA,EAAAA,YAAU,KACTC,IAAS,CACRC,KAAM,kDAAkDtB,IACxDuB,OAAQ,QAEPC,MAAMC,IACNP,EAAS,CACRQ,SAAS,KACND,GACF,IAEFE,OAAOC,IACPC,QAAQD,MAAM,CAAEA,SAAQ,GACvB,GACD,CAAC5B,IAEGiB,CACR,CAsBsBa,CAAgB9B,GAErC,OACC+B,EAAAA,EAAAA,MAACC,EAAAA,SAAQ,CAAA/C,SAAA,EACRgD,EAAAA,EAAAA,KAACC,EAAAA,0BAAyB,CAACC,OAAQxC,EAAaP,KAAMA,EAAKH,UACzDmD,EAAAA,EAAAA,IAAG,sBAELL,EAAAA,EAAAA,MAACM,EAAAA,cAAa,CACbC,KAAM3C,EACN4C,MAAM,kBACNnD,MAAM6C,EAAAA,EAAAA,KAACO,EAAI,CAACpD,KAAMA,EAAMC,KAAM,KAAOJ,SAAA,EAErC8C,EAAAA,EAAAA,MAACU,EAAAA,UAAS,CAACF,MAAM,eAActD,SAAA,EAC9BgD,EAAAA,EAAAA,KAACS,EAAAA,cAAa,CAEZjC,eACAkC,UAAU,EACVC,SAAWC,IACVtC,EAAQ,IACJD,EACHO,wBAAyBgC,EAAWC,IACnC,EAEHC,iBAAiBX,EAAAA,EAAAA,IAAG,qBACpBY,SAAS,EACTC,aAAcrD,EACdsD,OAAOd,EAAAA,EAAAA,IAAG,oCACVe,eAAef,EAAAA,EAAAA,IAAG,cAGpBH,EAAAA,EAAAA,KAACmB,EAAAA,YAAW,KACZnB,EAAAA,EAAAA,KAACoB,EAAAA,cAAa,CACbH,MAAM,cACNI,KAAK,mEACLC,QAAS7C,EACT8C,SAAWC,IACVlD,EAAQ,IACJD,EACHQ,OAAQ2C,GACP,QAILxB,EAAAA,EAAAA,KAACQ,EAAAA,UAAS,CAACF,MAAM,iBAAgBtD,UAChCgD,EAAAA,EAAAA,KAACyB,EAAAA,gBAAe,CACfR,MAAM,iBACNO,MAAO9C,EACP6C,SAAWC,IACVlD,EAAQ,IACJD,EACHS,eAAgB0C,GACf,MAIJzC,GAAcU,UACdK,EAAAA,EAAAA,MAACU,EAAAA,UAAS,CAACF,MAAM,yBAAwBtD,SAAA,EACxC8C,EAAAA,EAAAA,MAAA,KAAA9C,SAAA,EACCgD,EAAAA,EAAAA,KAAA,UAAAhD,SAAQ,qBAA0B,IACjC+B,GAAc2C,UAEhB1B,EAAAA,EAAAA,KAACyB,EAAAA,gBAAe,CACff,UAAQ,EACRO,MAAM,yBACNO,MAAOG,KAAKC,UAAU7C,GAAc8C,IAAK,KAAM,YAQnD7B,EAAAA,EAAAA,KAAC8B,EAAAA,sBAAqB,CAAA9E,UACrB8C,EAAAA,EAAAA,MAACU,EAAAA,UAAS,CAACF,MAAM,yBAAwBtD,SAAA,EACxCgD,EAAAA,EAAAA,KAACS,EAAAA,cAAa,CAEZjC,eACAkC,UAAU,EACVC,SAAWC,IACVtC,EAAQ,IACJD,EACHO,wBAAyBgC,EAAWC,IACnC,EAEHC,iBAAiBX,EAAAA,EAAAA,IAAG,qBACpBY,SAAS,EACTC,aAAcrD,EACdsD,OAAOd,EAAAA,EAAAA,IAAG,oCACVe,eAAef,EAAAA,EAAAA,IAAG,cAGpBH,EAAAA,EAAAA,KAACmB,EAAAA,YAAW,KACZnB,EAAAA,EAAAA,KAACoB,EAAAA,cAAa,CACbH,MAAM,cACNI,KAAK,mEACLC,QAAS7C,EACT8C,SAAWC,IACVlD,EAAQ,IACJD,EACHQ,OAAQ2C,GACP,WAOT,G","sources":["webpack://@pewresearch/prc-platform-datasets/webpack/bootstrap","webpack://@pewresearch/prc-platform-datasets/webpack/runtime/compat get default export","webpack://@pewresearch/prc-platform-datasets/webpack/runtime/define property getters","webpack://@pewresearch/prc-platform-datasets/webpack/runtime/hasOwnProperty shorthand","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"primitives\"]","webpack://@pewresearch/prc-platform-datasets/external window \"ReactJSXRuntime\"","webpack://@pewresearch/prc-platform-datasets/./node_modules/@wordpress/icons/build-module/library/download.js","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"element\"]","webpack://@pewresearch/prc-platform-datasets/./node_modules/@wordpress/icons/build-module/icon/index.js","webpack://@pewresearch/prc-platform-datasets/external window \"prcComponents\"","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"i18n\"]","webpack://@pewresearch/prc-platform-datasets/external window \"React\"","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"plugins\"]","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"editor\"]","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"data\"]","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"coreData\"]","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"components\"]","webpack://@pewresearch/prc-platform-datasets/external window [\"wp\",\"apiFetch\"]","webpack://@pewresearch/prc-platform-datasets/./src/panel/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"primitives\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"ReactJSXRuntime\"];","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst download = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M18 11.3l-1-1.1-4 4V3h-1.5v11.3L7 10.2l-1 1.1 6.2 5.8 5.8-5.8zm.5 3.7v3.5h-13V15H4v5h16v-5h-1.5z\"\n  })\n});\nexport default download;\n//# sourceMappingURL=download.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"element\"];","/**\n * WordPress dependencies\n */\nimport { cloneElement, forwardRef } from '@wordpress/element';\n\n/** @typedef {{icon: JSX.Element, size?: number} & import('@wordpress/primitives').SVGProps} IconProps */\n\n/**\n * Return an SVG icon.\n *\n * @param {IconProps}                                 props icon is the SVG component to render\n *                                                          size is a number specifying the icon size in pixels\n *                                                          Other props will be passed to wrapped SVG component\n * @param {import('react').ForwardedRef<HTMLElement>} ref   The forwarded ref to the SVG element.\n *\n * @return {JSX.Element}  Icon component\n */\nfunction Icon({\n  icon,\n  size = 24,\n  ...props\n}, ref) {\n  return cloneElement(icon, {\n    width: size,\n    height: size,\n    ...props,\n    ref\n  });\n}\nexport default forwardRef(Icon);\n//# sourceMappingURL=index.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"prcComponents\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"i18n\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"React\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"plugins\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"editor\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"data\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"coreData\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"components\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"apiFetch\"];","/**\n * External Dependencies\n */\nimport { Icon, download as icon } from '@wordpress/icons';\nimport { MediaDropZone } from '@prc/components';\n\n/**\n * WordPress Dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Fragment, useMemo, useState, useEffect } from 'react';\nimport { registerPlugin } from '@wordpress/plugins';\nimport {\n\tPluginSidebar,\n\tPluginSidebarMoreMenuItem,\n\tPluginPrePublishPanel,\n\tstore as editorStore,\n} from '@wordpress/editor';\nimport { useSelect } from '@wordpress/data';\nimport { useEntityProp } from '@wordpress/core-data';\nimport {\n\tButton,\n\tCardDivider,\n\tPanelBody,\n\tTextareaControl,\n\tToggleControl,\n} from '@wordpress/components';\nimport apiFetch from '@wordpress/api-fetch';\n/**\n * Internal Dependencies\n */\n\nconst PLUGIN_NAME = 'prc-platform-datasets-panel';\nconst ALLOWED_TYPES = ['application/zip', 'application/pdf'];\n\n// Custom hook for fetching dataset stats\nfunction useDatasetStats(postId) {\n\tconst [stats, setStats] = useState(null);\n\n\tuseEffect(() => {\n\t\tapiFetch({\n\t\t\tpath: `/prc-api/v3/datasets/download-stats?dataset_id=${postId}`,\n\t\t\tmethod: 'GET',\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tsetStats({\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\t...response,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error({ error });\n\t\t\t});\n\t}, [postId]);\n\n\treturn stats;\n}\n\nfunction DatasetOptionsPanel() {\n\tconst { postType, postId } = useSelect((select) => {\n\t\tconst currentPostType = select(editorStore).getCurrentPostType();\n\t\tconst currentPostId = select(editorStore).getCurrentPostId();\n\t\treturn {\n\t\t\tpostType: currentPostType,\n\t\t\tpostId: currentPostId,\n\t\t};\n\t}, []);\n\n\tconst [meta, setMeta] = useEntityProp('postType', postType, 'meta', postId);\n\n\tconst { attachmentId, isAtp, datasetSchema } = useMemo(() => {\n\t\treturn {\n\t\t\tattachmentId: meta._download_attachment_id || false,\n\t\t\tisAtp: meta.is_atp || false,\n\t\t\tdatasetSchema: meta.dataset_schema || '',\n\t\t};\n\t}, [meta]);\n\n\tconst datasetStats = useDatasetStats(postId);\n\n\treturn (\n\t\t<Fragment>\n\t\t\t<PluginSidebarMoreMenuItem target={PLUGIN_NAME} icon={icon}>\n\t\t\t\t{__('Dataset Options')}\n\t\t\t</PluginSidebarMoreMenuItem>\n\t\t\t<PluginSidebar\n\t\t\t\tname={PLUGIN_NAME}\n\t\t\t\ttitle=\"Dataset Options\"\n\t\t\t\ticon={<Icon icon={icon} size={16} />}\n\t\t\t>\n\t\t\t\t<PanelBody title=\"Dataset File\">\n\t\t\t\t\t<MediaDropZone\n\t\t\t\t\t\t{...{\n\t\t\t\t\t\t\tattachmentId,\n\t\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\t\tonUpdate: (attachment) => {\n\t\t\t\t\t\t\t\tsetMeta({\n\t\t\t\t\t\t\t\t\t...meta,\n\t\t\t\t\t\t\t\t\t_download_attachment_id: attachment.id,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\teditButtonLabel: __('Edit Dataset File'),\n\t\t\t\t\t\t\tonClear: false,\n\t\t\t\t\t\t\tallowedTypes: ALLOWED_TYPES,\n\t\t\t\t\t\t\tlabel: __('Upload Dataset File (zip or pdf)'),\n\t\t\t\t\t\t\tsingularLabel: __('dataset'),\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t\t<CardDivider />\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel=\"ATP Dataset\"\n\t\t\t\t\t\thelp=\"ATP datasets are bound by an opt-in to the ATP Terms of Service.\"\n\t\t\t\t\t\tchecked={isAtp}\n\t\t\t\t\t\tonChange={(value) => {\n\t\t\t\t\t\t\tsetMeta({\n\t\t\t\t\t\t\t\t...meta,\n\t\t\t\t\t\t\t\tis_atp: value,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody title=\"Dataset Schema\">\n\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\tlabel=\"Dataset Schema\"\n\t\t\t\t\t\tvalue={datasetSchema}\n\t\t\t\t\t\tonChange={(value) => {\n\t\t\t\t\t\t\tsetMeta({\n\t\t\t\t\t\t\t\t...meta,\n\t\t\t\t\t\t\t\tdataset_schema: value,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t\t{datasetStats?.success && (\n\t\t\t\t\t<PanelBody title=\"Dataset Download Stats\">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<strong>Total Downloads:</strong>{' '}\n\t\t\t\t\t\t\t{datasetStats?.total}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\t\tdisabled\n\t\t\t\t\t\t\tlabel=\"Monthly Download Stats\"\n\t\t\t\t\t\t\tvalue={JSON.stringify(datasetStats?.log, null, 2)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t)}\n\t\t\t\t{/* @TODO: WIP, Eventually I'd like to get all entities that reference this dataset, but we'll wait for the Supra-Block-Data-Store <PanelBody title=\"Dataset Posts\">\n\t\t\t\t\t<p>A list of posts that are calling this dataset...</p>\n\t\t\t\t</PanelBody> */}\n\t\t\t</PluginSidebar>\n\t\t\t<PluginPrePublishPanel>\n\t\t\t\t<PanelBody title=\"Review Dataset Options\">\n\t\t\t\t\t<MediaDropZone\n\t\t\t\t\t\t{...{\n\t\t\t\t\t\t\tattachmentId,\n\t\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\t\tonUpdate: (attachment) => {\n\t\t\t\t\t\t\t\tsetMeta({\n\t\t\t\t\t\t\t\t\t...meta,\n\t\t\t\t\t\t\t\t\t_download_attachment_id: attachment.id,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\teditButtonLabel: __('Edit Dataset File'),\n\t\t\t\t\t\t\tonClear: false,\n\t\t\t\t\t\t\tallowedTypes: ALLOWED_TYPES,\n\t\t\t\t\t\t\tlabel: __('Upload Dataset File (zip or pdf)'),\n\t\t\t\t\t\t\tsingularLabel: __('dataset'),\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t\t<CardDivider />\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel=\"ATP Dataset\"\n\t\t\t\t\t\thelp=\"ATP datasets are bound by an opt-in to the ATP Terms of Service.\"\n\t\t\t\t\t\tchecked={isAtp}\n\t\t\t\t\t\tonChange={(value) => {\n\t\t\t\t\t\t\tsetMeta({\n\t\t\t\t\t\t\t\t...meta,\n\t\t\t\t\t\t\t\tis_atp: value,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</PluginPrePublishPanel>\n\t\t</Fragment>\n\t);\n}\n\nregisterPlugin(PLUGIN_NAME, {\n\trender: DatasetOptionsPanel,\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","window","SVG","xmlns","viewBox","children","Path","forwardRef","icon","size","props","ref","cloneElement","width","height","PLUGIN_NAME","ALLOWED_TYPES","registerPlugin","render","postType","postId","useSelect","select","editorStore","getCurrentPostType","getCurrentPostId","meta","setMeta","useEntityProp","attachmentId","isAtp","datasetSchema","useMemo","_download_attachment_id","is_atp","dataset_schema","datasetStats","stats","setStats","useState","useEffect","apiFetch","path","method","then","response","success","catch","error","console","useDatasetStats","_jsxs","Fragment","_jsx","PluginSidebarMoreMenuItem","target","__","PluginSidebar","name","title","Icon","PanelBody","MediaDropZone","disabled","onUpdate","attachment","id","editButtonLabel","onClear","allowedTypes","label","singularLabel","CardDivider","ToggleControl","help","checked","onChange","value","TextareaControl","total","JSON","stringify","log","PluginPrePublishPanel"],"sourceRoot":""}