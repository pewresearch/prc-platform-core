!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.wp.primitives,a=(0,t.createElement)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(n.Path,{d:"M14.103 7.128l2.26-2.26a4 4 0 00-5.207 4.804L5.828 15a2 2 0 102.828 2.828l5.329-5.328a4 4 0 004.804-5.208l-2.261 2.26-1.912-.512-.513-1.912zm-7.214 9.64a.5.5 0 11.707-.707.5.5 0 01-.707.707z"})),l=window.wp.blocks,r=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"prc-platform/interactive-loader","version":"0.1.0","title":"Interactive Loader","description":"Load a interactive\'s JS and CSS files.","category":"media","keywords":["interactive","loader"],"attributes":{"slug":{"type":"string"},"dataAttachmentId":{"type":"integer"},"interactivePropType":{"type":"string"},"legacyWpackIo":{"type":"object","properties":{"appName":{"type":"string"},"path":{"type":"string"},"deps":{"type":"array","items":{"type":"string"}}}},"legacyAssetsS3":{"type":"object","properties":{"path":{"type":"string"},"react":{"type":"string"},"libraries":{"type":"string"},"styles":{"type":"string"}}}},"supports":{"anchor":true,"html":false},"usesContext":["queryId","query","queryContext","templateSlug","previewPostType","postId","postType"],"textdomain":"prc-platform-interactive-loader","editorScript":"file:./index.js"}'),c=window.wp.i18n,i=window.wp.components,o=window.wp.element,s=window.wp.blockEditor,u=window.wp.apiFetch,p=e.n(u),d=window.prcComponents;function m({id:e,setNewId:n,disabled:a=!1,children:l}){return(0,t.createElement)(o.Fragment,null,(0,t.createElement)(d.MediaDropZone,{attachmentId:e,disabled:a,onUpdate:e=>{"function"==typeof n&&n(e.id)},onClear:()=>{"function"==typeof n&&n(null)},mediaType:["text/csv","application/json"],label:(0,c.__)("Drop or Select a Data File (CSV or JSON)"),singularLabel:(0,c.__)("Data File")},(0,t.createElement)(i.Button,{variant:"primary"},"Modify Data File")),e&&l)}function h(e,t){for(const n in e)if("object"==typeof e[n]){const a=h(e[n],t);if(a)return a}else if(e.hasOwnProperty("slug")&&e.slug===t)return e;return null}const v="prc-platform/interactive-loader";function g({id:e,appName:t,path:n,deps:a,version:r}){return(0,l.createBlock)(v,{slug:e,legacyWpackIo:{appName:t,path:n,deps:a}})}function y({id:e,path:t,react:n,libraries:a,styles:r}){return(0,l.createBlock)(v,{slug:e,legacyAssetsS3:{path:t,react:n,libraries:a,styles:r}})}function f(e){console.log("converTextRaw()",e);const t=null!==e.match(/\[load_interactive/),n=null!==e.match(/\[js_interactive/),a=e.match(/id="([^"]+)"/),l=e.match(/appName="([^"]+)"/),r=e.match(/path="([^"]+)"/),c=e.match(/deps="([^"]+)"/),i=e.match(/version="([^"]+)"/),o=e.match(/react="([^"]+)"/),s=e.match(/libraries="([^"]+)"/),u=e.match(/styles="([^"]+)"/);return console.log("isLoadInteractive",t),console.log("isJsInteractive",n),console.log(e),t?g({id:null!==a?a[1]:null,appName:null!==l?l[1]:null,path:null!==r?r[1]:null,deps:null!==c?c[1]:"",version:null!==i?i[1]:null}):n?y({id:null!==a?a[1]:null,path:null!==r?r[1]:null,react:null!==o?o[1]:null,libraries:null!==s?s[1]:null,styles:null!==u?u[1]:null}):void 0}var b={from:[{type:"shortcode",tag:"load_interactive",transform({named:{id:e,appName:t,path:n,deps:a,version:l}}){return console.log("name",named),g({id:e,appName:t,path:n,deps:a,version:l})},isMatch({named:{id:e,appName:t,path:n}}){return!!e&&!!t&&!!n}},{type:"shortcode",tag:"js_interactive",transform({named:{id:e,path:t,libraries:n,styles:a,react:l}}){return console.log("name",named),y({id:e,path:t,react:l,libraries:n,styles:a})},isMatch({named:{path:e,react:t}}){return t}},{type:"block",blocks:["core/shortcode"],transform:({text:e})=>f(e)},{type:"block",blocks:["core/html"],transform:({content:e})=>f(e)}]};const{name:w}=r,E={icon:a,edit:function({attributes:e,setAttributes:n,clientId:l,context:r}){const{postId:u}=r,d=(0,s.useBlockProps)(),[v,g]=(0,o.useState)(null),[y,f]=(0,o.useState)(null),[b,w]=(0,o.useState)(!1),{slug:E,dataAttachmentId:S,legacyWpackIo:I,legacyAssetsS3:k}=e,x=(0,o.useMemo)((()=>I||k),[I,k]),{interactives:C}=function(e,t){const[n,a]=(0,o.useState)([]);return(0,o.useEffect)((()=>{p()({path:"/prc-api/v3/interactives/get-assets"}).then((e=>{a(e)}))}),[]),{interactives:n}}(),j=(0,o.useMemo)((()=>C&&E?h(C,E):null),[C,E]),A=(0,o.useMemo)((()=>j?.title||(0,c.__)("Select Interactive")),[j]),M=(0,o.useMemo)((()=>{const e=[{label:"Select Research Area",value:null}];return C&&Object.keys(C).forEach((t=>{const n=t.charAt(0).toUpperCase()+t.slice(1);e.push({label:n,value:t})})),e}),[C]),N=(0,o.useMemo)((()=>{const e=[{label:"Select Year",value:null}];return C&&v&&Object.keys(C[v]).forEach((t=>{e.push({label:t,value:t})})),e}),[C,v]),_=(0,o.useMemo)((()=>{const e={label:"Select Interactive",value:null};if(null===v||null===y)return[e];const t=C?.[v]?.[y];if(!t)return[e];const n=t.map((e=>({label:e.title,value:e.slug})));return n.unshift(e),n}),[C,v,y]);return(0,t.createElement)("div",{...d},x&&(0,t.createElement)(s.Warning,null,(0,t.createElement)("p",null,"This interactive is being loaded via legacy means: ",(0,t.createElement)("strong",null,void 0!==I?"WPackIo":"Assets S3"),"."),(0,t.createElement)("p",null,"Please update this interactive's code and bring it into ",(0,t.createElement)("i",null,"/interactives")," and up to ",(0,t.createElement)("i",null,"@wordpress/scripts")," build and loading compliance at earliest convenience"),(0,t.createElement)(i.Button,{isDestructive:!0,variant:"primary",onClick:()=>n({slug:null,legacyAssetsS3:null,legacyWpackIo:null}),text:"Reset Interactive Selection"})),!x&&(0,t.createElement)(i.Placeholder,{label:A,icon:a},null===j&&(0,t.createElement)(i.Flex,{gap:"5px"},(0,t.createElement)(i.FlexItem,null,(0,t.createElement)(i.SelectControl,{label:"Select Research Area",value:v,options:M,onChange:e=>{g(e)}})),(0,t.createElement)(i.FlexItem,null,(0,t.createElement)(i.SelectControl,{label:"Select Year",value:y,options:N,onChange:e=>{f(e)}})),(0,t.createElement)(i.FlexBlock,null,(0,t.createElement)(i.SelectControl,{label:"Select Interactive",value:E,disabled:0===_.length,options:_,onChange:e=>{n({slug:e})}}))),j&&(0,t.createElement)("div",null,(0,t.createElement)(i.Button,{variant:"secondary",onClick:()=>n({slug:null}),text:"Reset Interactive Selection"}),(0,t.createElement)(m,{id:S,setNewId:e=>{n({dataAttachmentId:e})}},(0,t.createElement)("p",null,"Data accessible via Rest API:"),(0,t.createElement)("p",null,(0,t.createElement)("pre",null,"/wp-json/prc-api/v3/interactives/get-data/",`${S}`))))))},transforms:b};(0,l.registerBlockType)(w,{...r,...E})}();
//# sourceMappingURL=index.js.map