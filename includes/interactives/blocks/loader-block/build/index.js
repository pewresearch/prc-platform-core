(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var l in a)e.o(a,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:a[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.primitives,l=(0,t.createElement)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(a.Path,{d:"M14.103 7.128l2.26-2.26a4 4 0 00-5.207 4.804L5.828 15a2 2 0 102.828 2.828l5.329-5.328a4 4 0 004.804-5.208l-2.261 2.26-1.912-.512-.513-1.912zm-7.214 9.64a.5.5 0 11.707-.707.5.5 0 01-.707.707z"})),n=window.wp.blocks,r=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"prc-platform/interactive-loader","version":"0.1.0","title":"Interactive Loader","description":"Load a interactive\'s JS and CSS files.","category":"media","keywords":["interactive","loader"],"attributes":{"slug":{"type":"string"},"dataAttachmentId":{"type":"integer"},"interactivePropType":{"type":"string"},"legacyWpackIo":{"type":"object","properties":{"appName":{"type":"string"},"path":{"type":"string"},"deps":{"type":"array","items":{"type":"string"}}}},"legacyAssetsS3":{"type":"object","properties":{"path":{"type":"string"},"react":{"type":"string"},"libraries":{"type":"string"},"styles":{"type":"string"}}}},"supports":{"anchor":true,"html":false},"usesContext":["queryId","query","queryContext","templateSlug","previewPostType","postId","postType"],"textdomain":"prc-platform-interactive-loader","editorScript":"file:./index.js"}'),s=window.wp.i18n,c=window.wp.components,o=window.wp.element,i=window.wp.blockEditor,p=window.wp.apiFetch;var u=e.n(p);const d=window.prcComponents;function m({id:e,setNewId:a,disabled:l=!1,children:n}){return(0,t.createElement)(o.Fragment,null,(0,t.createElement)(d.MediaDropZone,{attachmentId:e,disabled:l,onUpdate:e=>{"function"==typeof a&&a(e.id)},onClear:()=>{"function"==typeof a&&a(null)},mediaType:["text/csv","application/json"],label:(0,s.__)("Drop or Select a Data File (CSV or JSON)"),singularLabel:(0,s.__)("Data File")},(0,t.createElement)(c.Button,{variant:"primary"},"Modify Data File")),e&&n)}function h(e,t){for(const a in e)if("object"==typeof e[a]){const l=h(e[a],t);if(l)return l}else if(e.hasOwnProperty("slug")&&e.slug===t)return e;return null}const v="prc-platform/interactive-loader";function g({id:e,appName:t,path:a,deps:l,version:r}){return(0,n.createBlock)(v,{slug:e,legacyWpackIo:{appName:t,path:a,deps:l}})}function y({id:e,path:t,react:a,libraries:l,styles:r}){return(0,n.createBlock)(v,{slug:e,legacyAssetsS3:{path:t,react:a,libraries:l,styles:r}})}function b(e){console.log("converTextRaw()",e);const t=null!==e.match(/\[load_interactive/),a=null!==e.match(/\[js_interactive/),l=e.match(/id="([^"]+)"/),n=e.match(/appName="([^"]+)"/),r=e.match(/path="([^"]+)"/),s=e.match(/deps="([^"]+)"/),c=e.match(/version="([^"]+)"/),o=e.match(/react="([^"]+)"/),i=e.match(/libraries="([^"]+)"/),p=e.match(/styles="([^"]+)"/);return console.log("isLoadInteractive",t),console.log("isJsInteractive",a),console.log(e),t?g({id:null!==l?l[1]:null,appName:null!==n?n[1]:null,path:null!==r?r[1]:null,deps:null!==s?s[1]:"",version:null!==c?c[1]:null}):a?y({id:null!==l?l[1]:null,path:null!==r?r[1]:null,react:null!==o?o[1]:null,libraries:null!==i?i[1]:null,styles:null!==p?p[1]:null}):void 0}const w={from:[{type:"shortcode",tag:"load_interactive",transform:({named:{id:e,appName:t,path:a,deps:l,version:n}})=>(console.log("name",named),g({id:e,appName:t,path:a,deps:l,version:n})),isMatch:({named:{id:e,appName:t,path:a}})=>!!e&&!!t&&!!a},{type:"shortcode",tag:"js_interactive",transform:({named:{id:e,path:t,libraries:a,styles:l,react:n}})=>(console.log("name",named),y({id:e,path:t,react:n,libraries:a,styles:l})),isMatch:({named:{path:e,react:t}})=>t},{type:"block",blocks:["core/shortcode"],transform:({text:e})=>b(e)},{type:"block",blocks:["core/html"],transform:({content:e})=>b(e)}]},{name:f}=r,E={icon:l,edit:function({attributes:e,setAttributes:a,clientId:n,context:r}){const{postId:p}=r,d=(0,i.useBlockProps)(),[v,g]=(0,o.useState)(null),[y,b]=(0,o.useState)(null),[w,f]=(0,o.useState)(!1),{slug:E,dataAttachmentId:S,legacyWpackIo:I,legacyAssetsS3:k}=e,x=(0,o.useMemo)((()=>I||k),[I,k]),{interactives:C}=function(e,t){const[a,l]=(0,o.useState)([]);return(0,o.useEffect)((()=>{u()({path:"/prc-api/v3/interactives/get-assets"}).then((e=>{l(e)}))}),[]),{interactives:a}}(),j=(0,o.useMemo)((()=>C&&E?h(C,E):null),[C,E]),A=(0,o.useMemo)((()=>j?.title||(0,s.__)("Select Interactive")),[j]),M=(0,o.useMemo)((()=>{const e=[{label:"Select Research Area",value:null}];return C&&Object.keys(C).forEach((t=>{const a=t.charAt(0).toUpperCase()+t.slice(1);e.push({label:a,value:t})})),e}),[C]),N=(0,o.useMemo)((()=>{const e=[{label:"Select Year",value:null}];return C&&v&&Object.keys(C[v]).forEach((t=>{e.push({label:t,value:t})})),e}),[C,v]),_=(0,o.useMemo)((()=>{const e={label:"Select Interactive",value:null};if(null===v||null===y)return[e];const t=C?.[v]?.[y];if(!t)return[e];const a=t.map((e=>({label:e.title,value:e.slug})));return a.unshift(e),a}),[C,v,y]);return(0,t.createElement)("div",{...d},x&&(0,t.createElement)(i.Warning,null,(0,t.createElement)("p",null,"This interactive is being loaded via legacy means: ",(0,t.createElement)("strong",null,void 0!==I?"WPackIo":"Assets S3"),"."),(0,t.createElement)("p",null,"Please update this interactive's code and bring it into ",(0,t.createElement)("i",null,"/interactives")," and up to ",(0,t.createElement)("i",null,"@wordpress/scripts")," build and loading compliance at earliest convenience"),(0,t.createElement)(c.Button,{isDestructive:!0,variant:"primary",onClick:()=>a({slug:null,legacyAssetsS3:null,legacyWpackIo:null}),text:"Reset Interactive Selection"})),!x&&(0,t.createElement)(c.Placeholder,{label:A,icon:l},null===j&&(0,t.createElement)(c.Flex,{gap:"5px"},(0,t.createElement)(c.FlexItem,null,(0,t.createElement)(c.SelectControl,{label:"Select Research Area",value:v,options:M,onChange:e=>{g(e)}})),(0,t.createElement)(c.FlexItem,null,(0,t.createElement)(c.SelectControl,{label:"Select Year",value:y,options:N,onChange:e=>{b(e)}})),(0,t.createElement)(c.FlexBlock,null,(0,t.createElement)(c.SelectControl,{label:"Select Interactive",value:E,disabled:0===_.length,options:_,onChange:e=>{a({slug:e})}}))),j&&(0,t.createElement)("div",null,(0,t.createElement)(c.Button,{variant:"secondary",onClick:()=>a({slug:null}),text:"Reset Interactive Selection"}),(0,t.createElement)(m,{id:S,setNewId:e=>{a({dataAttachmentId:e})}},(0,t.createElement)("p",null,"Data accessible via Rest API:"),(0,t.createElement)("p",null,(0,t.createElement)("pre",null,"/wp-json/prc-api/v3/interactives/get-data/",`${S}`))))))},transforms:w};(0,n.registerBlockType)(f,{...r,...E})})();
//# sourceMappingURL=index.js.map