(()=>{"use strict";var e,t={200:(e,t,a)=>{const l=window.React,n=window.wp.primitives,r=(0,l.createElement)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(n.Path,{d:"M14.103 7.128l2.26-2.26a4 4 0 00-5.207 4.804L5.828 15a2 2 0 102.828 2.828l5.329-5.328a4 4 0 004.804-5.208l-2.261 2.26-1.912-.512-.513-1.912zm-7.214 9.64a.5.5 0 11.707-.707.5.5 0 01-.707.707z"})),o=window.wp.blocks,i=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"prc-platform/interactive-loader","version":"0.1.0","title":"Interactive Loader","description":"Load a interactive\'s JS and CSS files.","category":"media","keywords":["interactive","loader"],"attributes":{"slug":{"type":"string"},"dataAttachmentId":{"type":"integer"},"interactivePropType":{"type":"string"},"legacyWpackIo":{"type":"object","properties":{"appName":{"type":"string"},"path":{"type":"string"},"deps":{"type":"string"}}},"legacyS3":{"type":"object","properties":{"libraries":{"type":"string"},"path":{"type":"string"},"styles":{"type":"string"},"react":{"type":"boolean"}}}},"supports":{"anchor":true,"html":false},"usesContext":["queryId","query","queryContext","templateSlug","previewPostType","postId","postType"],"textdomain":"prc-platform-interactive-loader","editorScript":"file:./index.js","style":"file:./style-index.css"}'),s=window.wp.i18n,c=window.wp.components,p=window.wp.element,u=window.wp.blockEditor,d=window.wp.apiFetch;var m=a.n(d);const v=window.prcComponents;function h({id:e,setNewId:t,disabled:a=!1,children:n}){return(0,l.createElement)(p.Fragment,null,(0,l.createElement)(v.MediaDropZone,{attachmentId:e,disabled:a,onUpdate:e=>{"function"==typeof t&&t(e.id)},onClear:()=>{"function"==typeof t&&t(null)},mediaType:["text/csv","application/json"],label:(0,s.__)("Drop or Select a Data File (CSV or JSON)"),singularLabel:(0,s.__)("Data File")},(0,l.createElement)(c.Button,{variant:"primary"},"Modify Data File")),e&&n)}function g(e,t){for(const a in e)if("object"==typeof e[a]){const l=g(e[a],t);if(l)return l}else if(e.hasOwnProperty("slug")&&e.slug===t)return e;return null}const y="prc-platform/interactive-loader";function f({id:e,appName:t,path:a,deps:l,version:n}){return(0,o.createBlock)(y,{slug:e,legacyWpackIo:{appName:t,path:a,deps:l}})}function b({id:e,path:t,react:a,libraries:l,styles:n}){return(0,o.createBlock)(y,{slug:e,legacyAssetsS3:{path:t,react:a,libraries:l,styles:n}})}function w(e){console.log("converTextRaw()",e);const t=null!==e.match(/\[load_interactive/),a=null!==e.match(/\[js_interactive/),l=e.match(/id="([^"]+)"/),n=e.match(/appName="([^"]+)"/),r=e.match(/path="([^"]+)"/),o=e.match(/deps="([^"]+)"/),i=e.match(/version="([^"]+)"/),s=e.match(/react="([^"]+)"/),c=e.match(/libraries="([^"]+)"/),p=e.match(/styles="([^"]+)"/);return console.log("isLoadInteractive",t),console.log("isJsInteractive",a),console.log(e),t?f({id:null!==l?l[1]:null,appName:null!==n?n[1]:null,path:null!==r?r[1]:null,deps:null!==o?o[1]:"",version:null!==i?i[1]:null}):a?b({id:null!==l?l[1]:null,path:null!==r?r[1]:null,react:null!==s?s[1]:null,libraries:null!==c?c[1]:null,styles:null!==p?p[1]:null}):void 0}const E={from:[{type:"shortcode",tag:"load_interactive",transform:({named:{id:e,appName:t,path:a,deps:l,version:n}})=>(console.log("name",named),f({id:e,appName:t,path:a,deps:l,version:n})),isMatch:({named:{id:e,appName:t,path:a}})=>!!e&&!!t&&!!a},{type:"shortcode",tag:"js_interactive",transform:({named:{id:e,path:t,libraries:a,styles:l,react:n}})=>(console.log("name",named),b({id:e,path:t,react:n,libraries:a,styles:l})),isMatch:({named:{path:e,react:t}})=>t},{type:"block",blocks:["core/shortcode"],transform:({text:e})=>w(e)},{type:"block",blocks:["core/html"],transform:({content:e})=>w(e)}]},{name:S}=i,k={icon:r,edit:function({attributes:e,setAttributes:t,clientId:a,context:n}){const{postId:o}=n,i=(0,u.useBlockProps)(),[d,v]=(0,p.useState)(null),[y,f]=(0,p.useState)(null),[b,w]=(0,p.useState)(!1),{slug:E,dataAttachmentId:S,legacyWpackIo:k,legacyAssetsS3:I}=e,x=(0,p.useMemo)((()=>k||I),[k,I]),{interactives:_}=function(e,t){const[a,l]=(0,p.useState)([]);return(0,p.useEffect)((()=>{m()({path:"/prc-api/v3/interactive/get-assets"}).then((e=>{l(e)}))}),[]),{interactives:a}}(),C=(0,p.useMemo)((()=>_&&E?g(_,E):null),[_,E]),O=(0,p.useMemo)((()=>C?.title||(0,s.__)("Select Interactive")),[C]),j=(0,p.useMemo)((()=>{const e=[{label:"Select Research Area",value:null}];return _&&Object.keys(_).forEach((t=>{const a=t.charAt(0).toUpperCase()+t.slice(1);e.push({label:a,value:t})})),e}),[_]),A=(0,p.useMemo)((()=>{const e=[{label:"Select Year",value:null}];return _&&d&&Object.keys(_[d]).forEach((t=>{e.push({label:t,value:t})})),e}),[_,d]),M=(0,p.useMemo)((()=>{const e={label:"Select Interactive",value:null};if(null===d||null===y)return[e];const t=_?.[d]?.[y];if(!t)return[e];const a=t.map((e=>({label:e.title,value:e.slug})));return a.unshift(e),a}),[_,d,y]);return(0,l.createElement)("div",{...i},x&&(0,l.createElement)(u.Warning,null,(0,l.createElement)("p",null,"This interactive is being loaded via legacy means:"," ",(0,l.createElement)("strong",null,void 0!==k?"WPackIo":"Assets S3"),"."),(0,l.createElement)("p",null,"Please update this interactive's code and bring it into"," ",(0,l.createElement)("i",null,"/interactives")," and up to ",(0,l.createElement)("i",null,"@wordpress/scripts")," ","build and loading compliance at earliest convenience"),(0,l.createElement)(c.Button,{isDestructive:!0,variant:"primary",onClick:()=>t({slug:null,legacyAssetsS3:null,legacyWpackIo:null}),text:"Reset Interactive Selection"})),!x&&(0,l.createElement)(c.Placeholder,{label:O,icon:r},null===C&&(0,l.createElement)(c.Flex,{gap:"5px"},(0,l.createElement)(c.FlexItem,null,(0,l.createElement)(c.SelectControl,{label:"Select Research Area",value:d,options:j,onChange:e=>{v(e)}})),(0,l.createElement)(c.FlexItem,null,(0,l.createElement)(c.SelectControl,{label:"Select Year",value:y,options:A,onChange:e=>{f(e)}})),(0,l.createElement)(c.FlexBlock,null,(0,l.createElement)(c.SelectControl,{label:"Select Interactive",value:E,disabled:0===M.length,options:M,onChange:e=>{t({slug:e})}}))),C&&(0,l.createElement)("div",null,(0,l.createElement)(c.Button,{variant:"secondary",onClick:()=>t({slug:null}),text:"Reset Interactive Selection"}),(0,l.createElement)(h,{id:S,setNewId:e=>{t({dataAttachmentId:e})}},(0,l.createElement)("p",null,"Data accessible via Rest API:"),(0,l.createElement)("p",null,(0,l.createElement)("pre",null,"/wp-json/prc-api/v3/interactive/get-data/",`${S}`))))))},transforms:E};(0,o.registerBlockType)(S,{...i,...k})}},a={};function l(e){var n=a[e];if(void 0!==n)return n.exports;var r=a[e]={exports:{}};return t[e](r,r.exports,l),r.exports}l.m=t,e=[],l.O=(t,a,n,r)=>{if(!a){var o=1/0;for(p=0;p<e.length;p++){for(var[a,n,r]=e[p],i=!0,s=0;s<a.length;s++)(!1&r||o>=r)&&Object.keys(l.O).every((e=>l.O[e](a[s])))?a.splice(s--,1):(i=!1,r<o&&(o=r));if(i){e.splice(p--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var p=e.length;p>0&&e[p-1][2]>r;p--)e[p]=e[p-1];e[p]=[a,n,r]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};l.O.j=t=>0===e[t];var t=(t,a)=>{var n,r,[o,i,s]=a,c=0;if(o.some((t=>0!==e[t]))){for(n in i)l.o(i,n)&&(l.m[n]=i[n]);if(s)var p=s(l)}for(t&&t(a);c<o.length;c++)r=o[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(p)},a=globalThis.webpackChunk_pewresearch_prc_platform_interactives_loader=globalThis.webpackChunk_pewresearch_prc_platform_interactives_loader||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var n=l.O(void 0,[350],(()=>l(200)));n=l.O(n)})();
//# sourceMappingURL=index.js.map